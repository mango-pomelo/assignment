{"ast":null,"code":"import { Draggable, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport { setRowsInTbody, resetRowIndex } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport * as literals from '../base/string-literals'; // eslint-disable-next-line valid-jsdoc\n\n/**\n *\n * Reorder module is used to handle row reordering.\n *\n * @hidden\n */\n\nvar RowDD =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid print module\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @hidden\n   */\n  function RowDD(parent) {\n    var _this = this;\n\n    this.selectedRows = [];\n    this.isOverflowBorder = true;\n    this.selectedRowColls = [];\n    this.isRefresh = true;\n    this.isReplaceDragEle = true;\n    this.istargetGrid = false; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n    this.helper = function (e) {\n      var gObj = _this.parent;\n      var target = _this.draggable.currentStateTarget;\n\n      var visualElement = _this.parent.createElement('div', {\n        className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n        styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n      });\n\n      var table = _this.parent.createElement('table', {\n        styles: 'width:' + gObj.element.offsetWidth\n      });\n\n      var tbody = _this.parent.createElement(literals.tbody);\n\n      if (document.getElementsByClassName('e-griddragarea').length || gObj.rowDropSettings.targetID && (!target.classList.contains('e-selectionbackground') && gObj.selectionSettings.type !== 'Single' || !parentsUntil(target, 'e-rowcell')) || !gObj.rowDropSettings.targetID && !parentsUntil(target, 'e-rowdragdrop')) {\n        return false;\n      }\n\n      if (gObj.rowDropSettings.targetID && gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n        gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute(literals.ariaRowIndex), 10));\n      }\n\n      _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n\n      var frzCols = _this.parent.isFrozenGrid();\n\n      if (frzCols) {\n        var rowIndex = parseInt(closestElement(target, 'tr').getAttribute(literals.ariaRowIndex), 10);\n        _this.startedRow.innerHTML = '';\n        _this.startedRow.innerHTML += gObj.getRowByIndex(rowIndex).innerHTML;\n        _this.startedRow.innerHTML += gObj.getMovableRowByIndex(rowIndex).innerHTML;\n\n        if (gObj.getFrozenMode() === literals.leftRight) {\n          _this.startedRow.innerHTML += gObj.getFrozenRightRowByIndex(rowIndex).innerHTML;\n        }\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        selectedRow: _this.rows,\n        dragelement: target,\n        cloneElement: visualElement,\n        cancel: false,\n        data: _this.rowData\n      };\n      var selectedRows = gObj.getSelectedRows();\n      gObj.trigger(events.rowDragStartHelper, args);\n      var cancel = 'cancel';\n\n      if (args[cancel]) {\n        return false;\n      }\n\n      removeElement(_this.startedRow, '.e-indentcell');\n      removeElement(_this.startedRow, '.e-detailrowcollapse');\n      removeElement(_this.startedRow, '.e-detailrowexpand');\n\n      _this.removeCell(_this.startedRow, literals.gridChkBox);\n\n      var exp = new RegExp('e-active', 'g'); //high contrast issue\n\n      _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n      tbody.appendChild(_this.startedRow);\n\n      if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n        var index = gObj.getFrozenMode() === literals.leftRight ? 3 : 2;\n\n        var dropCountEle = _this.parent.createElement('span', {\n          className: 'e-dropitemscount',\n          innerHTML: frzCols ? '' + selectedRows.length / index : '' + selectedRows.length\n        });\n\n        visualElement.appendChild(dropCountEle);\n      }\n\n      var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n\n      if (ele) {\n        ele.classList.add('e-dragstartrow');\n      }\n\n      table.appendChild(tbody);\n      visualElement.appendChild(table);\n      gObj.element.appendChild(visualElement);\n      return visualElement;\n    };\n\n    this.dragStart = function (e) {\n      var gObj = _this.parent;\n\n      if (document.getElementsByClassName('e-griddragarea').length) {\n        return;\n      }\n\n      var target = e.target;\n\n      var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n\n      if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n        spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table').offsetWidth - 5 + 'px';\n      }\n\n      _this.processArgs(target);\n\n      gObj.trigger(events.rowDragStart, {\n        rows: _this.rows,\n        target: e.target,\n        draggableType: 'rows',\n        fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10),\n        data: Object.keys(_this.rowData[0]).length > 0 ? _this.rowData : _this.currentViewData()\n      });\n      _this.dragStartData = _this.rowData;\n      var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances && dropElem.ej2_instances[0].getModuleName() === 'grid') {\n        dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n      }\n    };\n\n    this.drag = function (e) {\n      var gObj = _this.parent;\n      _this.isDropGrid = _this.parent;\n      _this.istargetGrid = false;\n\n      if (_this.parent.rowDropSettings.targetID) {\n        var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n        _this.isDropGrid = dropElement.ej2_instances[0];\n\n        if (parentsUntil(e.target, 'e-grid')) {\n          _this.istargetGrid = _this.parent.rowDropSettings.targetID === parentsUntil(e.target, 'e-grid').id;\n        }\n      }\n\n      var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n\n      var target = _this.getElementFromPosition(cloneElement, e.event);\n\n      classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n      _this.isOverflowBorder = true;\n      _this.hoverState = gObj.enableHover;\n      var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n      gObj.enableHover = false;\n\n      if (!e.target) {\n        return;\n      }\n\n      _this.processArgs(target);\n\n      var args = {\n        rows: _this.rows,\n        target: target,\n        draggableType: 'rows',\n        data: _this.rowData,\n        originalEvent: e,\n        cancel: false\n      };\n      gObj.trigger(events.rowDrag, args);\n\n      _this.stopTimer();\n\n      if (args.cancel) {\n        return;\n      }\n\n      gObj.element.classList.add('e-rowdrag');\n      _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ? parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) : parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n\n      if (gObj.rowDropSettings.targetID) {\n        if (!parentsUntil(target, 'e-grid') || parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n          classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n        }\n      } else {\n        var elem = parentsUntil(target, 'e-grid');\n\n        if (elem && elem.id === cloneElement.parentElement.id) {\n          classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n        } else {\n          classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n        }\n      }\n\n      if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n        if ((!_this.isDropGrid.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground')) && !_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n          if (parentsUntil(target, 'e-grid') && parentsUntil(target, 'e-grid').id === _this.isDropGrid.element.id) {\n            _this.updateScrollPostion(e.event);\n          }\n\n          if ((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) && (parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) !== _this.dragTarget || _this.istargetGrid) || _this.istargetGrid && trElement && _this.isDropGrid.getRowByIndex(_this.isDropGrid.getCurrentViewRecords().length - 1).getAttribute('data-uid') === trElement.getAttribute('data-uid')) {\n            _this.moveDragRows(e, _this.startedRow, trElement);\n          } else {\n            var islastRowIndex = void 0;\n\n            if (_this.parent.enableVirtualization) {\n              islastRowIndex = trElement && parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) === _this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n            } else {\n              var lastRowUid = _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid');\n\n              islastRowIndex = trElement && lastRowUid === trElement.getAttribute('data-uid') && lastRowUid !== _this.startedRow.getAttribute('data-uid');\n            }\n\n            if (islastRowIndex && !_this.parent.rowDropSettings.targetID) {\n              var bottomborder = _this.parent.createElement('div', {\n                className: 'e-lastrow-dragborder'\n              });\n\n              var gridcontentEle = _this.parent.getContent();\n\n              bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n\n              if (!gridcontentEle.getElementsByClassName('e-lastrow-dragborder').length) {\n                gridcontentEle.classList.add('e-grid-relative');\n                gridcontentEle.appendChild(bottomborder);\n                bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n              }\n            }\n\n            _this.removeBorder(trElement);\n          }\n        }\n\n        if (target && target.classList.contains(literals.content) && !_this.isDropGrid.element.querySelector('.e-emptyrow') && _this.istargetGrid) {\n          _this.removeBorder(trElement);\n\n          var rowIndex = _this.isDropGrid.getCurrentViewRecords().length - 1;\n          var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n          var rowElement = [];\n          rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector));\n\n          if (_this.isDropGrid.isFrozenGrid()) {\n            rowElement = _this.borderRowElement(rowIndex, selector);\n          }\n\n          if (rowElement.length > 0) {\n            addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n          }\n        }\n      }\n    };\n\n    this.dragStop = function (e) {\n      if (isActionPrevent(_this.parent)) {\n        _this.parent.notify(events.preventBatch, {\n          instance: _this,\n          handler: _this.processDragStop,\n          arg1: e\n        });\n      } else {\n        _this.processDragStop(e);\n      }\n    };\n\n    this.processDragStop = function (e) {\n      var gObj = _this.parent;\n\n      if (_this.parent.isDestroyed) {\n        return;\n      }\n\n      var targetEle = _this.getElementFromPosition(e.helper, e.event);\n\n      var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ? targetEle : e.target;\n      gObj.element.classList.remove('e-rowdrag');\n      var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n\n      if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances && dropElement.ej2_instances[0].getModuleName() === 'grid') {\n        dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n      }\n\n      if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n        _this.stopTimer();\n\n        _this.isDropGrid.enableHover = _this.hoverState;\n\n        _this.isDropGrid.getContent().classList.remove('e-grid-relative');\n\n        _this.removeBorder(targetEle);\n\n        var stRow = _this.isDropGrid.element.querySelector('.e-dragstartrow');\n\n        if (stRow) {\n          stRow.classList.remove('e-dragstartrow');\n        }\n      }\n\n      _this.processArgs(target);\n\n      if (_this.parent.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n        _this.dragTarget = null;\n        remove(e.helper);\n        return;\n      }\n\n      var args = {\n        target: target,\n        draggableType: 'rows',\n        cancel: false,\n        fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10),\n        dropIndex: _this.dragTarget,\n        rows: _this.rows,\n        data: Object.keys(_this.dragStartData[0]).length > 0 ? _this.dragStartData : _this.currentViewData()\n      };\n      gObj.trigger(events.rowDrop, args, function () {\n        if (!(parentsUntil(target, literals.row) || parentsUntil(target, 'e-emptyrow') || parentsUntil(target, literals.gridContent)) || args.cancel) {\n          _this.dragTarget = null;\n          remove(e.helper);\n          return;\n        }\n\n        _this.isRefresh = false;\n\n        var selectedIndexes = _this.parent.getSelectedRowIndexes();\n\n        if (gObj.isRowDragable()) {\n          if (!_this.parent.rowDropSettings.targetID && _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 && selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n            _this.reorderRows(selectedIndexes, args.dropIndex);\n          } else {\n            _this.reorderRows([parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10)], _this.dragTarget);\n          }\n\n          _this.dragTarget = null;\n\n          if (!gObj.rowDropSettings.targetID) {\n            remove(e.helper);\n\n            if (gObj.frozenRows && gObj.enableVirtualization) {\n              gObj.refresh();\n            } else {\n              _this.rowOrder(args);\n            }\n          }\n        }\n\n        _this.isRefresh = true;\n      });\n    };\n\n    this.removeCell = function (targetRow, className) {\n      return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n        if (cell.classList.contains(className)) {\n          targetRow.deleteCell(cell.cellIndex);\n        }\n      });\n    };\n\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.initialEnd, this.initializeDrag, this);\n    this.parent.on(events.columnDrop, this.columnDrop, this);\n    this.onDataBoundFn = this.onDataBound.bind(this);\n    this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n  }\n\n  RowDD.prototype.refreshRow = function (args, tbody, mtbody, frTbody, target, mTarget, frTarget) {\n    var gObj = this.parent;\n    var frzCols = gObj.isFrozenGrid();\n    var isLeftRight = gObj.getFrozenMode() === literals.leftRight;\n    var tbodyMovableHeader;\n    var tbodyMovableContent;\n    var frHdr;\n    var frCnt;\n    var tbodyContent = gObj.getContentTable().querySelector(literals.tbody);\n    var tbodyHeader = gObj.getHeaderTable().querySelector(literals.tbody);\n\n    if (frzCols) {\n      tbodyMovableHeader = gObj.getMovableHeaderTbody();\n      tbodyMovableContent = gObj.getMovableContentTbody();\n\n      if (isLeftRight) {\n        frHdr = gObj.getFrozenRightHeaderTbody();\n        frCnt = gObj.getFrozenRightContentTbody();\n      }\n    }\n\n    var index = gObj.getFrozenMode() === literals.leftRight ? 3 : 2;\n\n    for (var i = 0, len = args.rows.length; i < len; i++) {\n      if (frzCols) {\n        if (i % index === 0) {\n          tbody.insertBefore(args.rows[i], target);\n        } else if (i % index === 1) {\n          mtbody.insertBefore(args.rows[i], mTarget);\n        } else {\n          frTbody.insertBefore(args.rows[i], frTarget);\n        }\n      } else {\n        tbody.insertBefore(args.rows[i], target);\n      }\n    }\n\n    var tr = [].slice.call(tbody.getElementsByClassName(literals.row));\n    var mtr;\n    var frTr;\n\n    if (frzCols) {\n      mtr = [].slice.call(mtbody.getElementsByClassName(literals.row));\n\n      if (isLeftRight) {\n        frTr = [].slice.call(frTbody.getElementsByClassName(literals.row));\n      }\n    }\n\n    if (this.parent.enableVirtualization) {\n      this.refreshVirtualData(tr, mtr, frTr);\n    } else {\n      this.refreshData(tr, mtr, frTr);\n    }\n\n    if (this.parent.frozenRows) {\n      var _loop_1 = function (i, len) {\n        if (i < this_1.parent.frozenRows) {\n          setRowsInTbody(tbodyHeader, tbodyMovableHeader, frHdr, tr, mtr, frTr, function (tbody, rows) {\n            tbody.appendChild(rows[i]);\n          });\n        } else {\n          setRowsInTbody(tbodyContent, tbodyMovableContent, frCnt, tr, mtr, frTr, function (tbody, rows) {\n            tbody.appendChild(rows[i]);\n          });\n        }\n      };\n\n      var this_1 = this;\n\n      for (var i = 0, len = tr.length; i < len; i++) {\n        _loop_1(i, len);\n      }\n    }\n  };\n\n  RowDD.prototype.updateFrozenRowreOrder = function (args) {\n    var gObj = this.parent;\n    var tbodyMovH;\n    var tbodyMovC;\n    var tbodyFrH;\n    var tbodyFrC;\n    var frzCols = this.parent.isFrozenGrid();\n    var isLeftRight = gObj.getFrozenMode() === literals.leftRight;\n    var tbodyC = gObj.getContentTable().querySelector(literals.tbody);\n    var tbodyH = gObj.getHeaderTable().querySelector(literals.tbody);\n\n    if (frzCols) {\n      tbodyMovH = gObj.getMovableHeaderTbody();\n      tbodyMovC = gObj.getMovableContentTbody();\n\n      if (isLeftRight) {\n        tbodyFrH = gObj.getFrozenRightHeaderTbody();\n        tbodyFrC = gObj.getFrozenRightContentTbody();\n      }\n    }\n\n    var tr = [].slice.call(tbodyH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyC.getElementsByClassName(literals.row)));\n    var mtr;\n    var frTr;\n\n    if (frzCols) {\n      mtr = [].slice.call(tbodyMovH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyMovC.getElementsByClassName(literals.row)));\n\n      if (isLeftRight) {\n        frTr = [].slice.call(tbodyFrH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyFrC.getElementsByClassName(literals.row)));\n      }\n    }\n\n    var tbody = gObj.createElement(literals.tbody);\n    var mtbody = gObj.createElement(literals.tbody);\n    var frTbody = gObj.createElement(literals.tbody);\n    this.parent.clearSelection();\n    var targetRows = this.refreshRowTarget(args);\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      tbody.appendChild(tr[i]);\n\n      if (frzCols) {\n        mtbody.appendChild(mtr[i]);\n\n        if (isLeftRight) {\n          frTbody.appendChild(frTr[i]);\n        }\n      }\n    }\n\n    this.refreshRow(args, tbody, mtbody, frTbody, targetRows.target, targetRows.mTarget, targetRows.frTarget);\n  };\n\n  RowDD.prototype.refreshRowTarget = function (args) {\n    var gObj = this.parent;\n    var mTr;\n    var frTr;\n    var targetIdx = parseInt(args.target.parentElement.getAttribute(literals.ariaRowIndex), 10);\n\n    if (args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) {\n      targetIdx = targetIdx + 1;\n    }\n\n    var tr = gObj.getRowByIndex(targetIdx);\n\n    if (gObj.isFrozenGrid()) {\n      mTr = gObj.getMovableRowByIndex(targetIdx);\n\n      if (gObj.getFrozenMode() === literals.leftRight) {\n        frTr = gObj.getFrozenRightRowByIndex(targetIdx);\n      }\n    }\n\n    var rows = {\n      target: tr,\n      mTarget: mTr,\n      frTarget: frTr\n    };\n    return rows;\n  };\n\n  RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n    var gObj = this.parent;\n    var mtbody;\n    var frTbody;\n    var frzCols = this.parent.isFrozenGrid();\n    var tbody = gObj.getContentTable().querySelector(literals.tbody);\n\n    if (frzCols) {\n      mtbody = gObj.getMovableContentTbody();\n\n      if (gObj.getFrozenMode() === literals.leftRight) {\n        frTbody = gObj.getFrozenRightContentTbody();\n      }\n    }\n\n    this.parent.clearSelection();\n    var targetRows = this.refreshRowTarget(args);\n    this.refreshRow(args, tbody, mtbody, frTbody, targetRows.target, targetRows.mTarget, targetRows.frTarget);\n  };\n\n  RowDD.prototype.refreshVirtualData = function (tr, mtr, frTr) {\n    var recordobj = {};\n    var currentViewData = this.parent.getCurrentViewRecords();\n    var startedRow = this.parent.isFrozenGrid() ? this.parent.getMovableRows()[0] : this.parent.getRows()[0];\n    var startIndex = parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10);\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      var index = parseInt(tr[i].getAttribute(literals.ariaRowIndex), 10);\n      this.parent.notify(events.refreshVirtualCacheOnRowDD, {\n        objIndex: index,\n        end: i === tr.length - 1,\n        startIndex: startIndex\n      });\n      index = index - startIndex;\n      recordobj[i] = currentViewData[index];\n    }\n\n    var rowsElem = this.parent.getRows();\n    var mvbRows;\n    var frRightRow;\n\n    if (this.parent.isFrozenGrid()) {\n      mvbRows = this.parent.getMovableRows();\n\n      if (frTr) {\n        frRightRow = this.parent.getFrozenRightRows();\n      }\n    }\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      tr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n      rowsElem[i] = tr[i];\n      currentViewData[i] = recordobj[i];\n\n      if (this.parent.isFrozenGrid()) {\n        mtr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n        mvbRows[i] = mtr[i];\n\n        if (frTr) {\n          frTr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n          frRightRow[i] = frTr[i];\n        }\n      }\n    }\n  };\n\n  RowDD.prototype.refreshData = function (tr, mtr, frTr) {\n    var rowObj = {};\n    var movobj = {};\n    var frObj = {};\n    var recordobj = {};\n    var rowObjects = this.parent.getRowsObject();\n    var movbObject = this.parent.getMovableRowsObject();\n    var frRightObject = this.parent.getFrozenRightRowsObject();\n    var currentViewData = this.parent.getCurrentViewRecords();\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      var index = parseInt(tr[i].getAttribute(literals.ariaRowIndex), 10);\n      rowObj[i] = rowObjects[index];\n      recordobj[i] = currentViewData[index];\n\n      if (this.parent.isFrozenGrid()) {\n        movobj[i] = movbObject[index];\n\n        if (frTr) {\n          frObj[i] = frRightObject[index];\n        }\n      }\n    }\n\n    var rows = this.parent.getRows();\n    var movbRows;\n    var frRightRows;\n\n    if (this.parent.isFrozenGrid()) {\n      movbRows = this.parent.getMovableRows();\n\n      if (frTr) {\n        frRightRows = this.parent.getFrozenRightRows();\n      }\n    }\n\n    for (var i = 0, len = tr.length; i < len; i++) {\n      rows[i] = tr[i];\n      rowObjects[i] = rowObj[i];\n      currentViewData[i] = recordobj[i];\n\n      if (this.parent.isFrozenGrid()) {\n        movbRows[i] = mtr[i];\n        movbObject[i] = movobj[i];\n\n        if (frTr) {\n          frRightRows[i] = frTr[i];\n          frRightObject[i] = frObj[i];\n        }\n      }\n    }\n\n    resetRowIndex(this.parent, rowObjects, tr);\n\n    if (this.parent.isFrozenGrid()) {\n      resetRowIndex(this.parent, movbObject, mtr);\n\n      if (frTr) {\n        resetRowIndex(this.parent, frRightObject, frTr);\n      }\n    }\n  };\n\n  RowDD.prototype.rowOrder = function (args) {\n    if (args.dropIndex === args.fromIndex || isNaN(args.dropIndex)) {\n      return;\n    }\n\n    if (this.parent.childGrid) {\n      this.parent.detailCollapseAll();\n      var rows = [].slice.call(this.parent.getContentTable().querySelector(literals.tbody).children);\n      var rowObjects = this.parent.getRowsObject();\n      rows.filter(function (row) {\n        if (row.classList.contains('e-detailrow')) {\n          row.remove();\n        }\n      });\n\n      for (var i = 0, len = rowObjects.length; i < len; i++) {\n        if (!rowObjects[i]) {\n          break;\n        }\n\n        if (rowObjects[i].isDetailRow) {\n          this.parent.getRowsObject().splice(i, 1);\n          i--;\n        }\n      }\n    }\n\n    if (args.target.classList.contains('e-rowcelldrag')) {\n      args.target = args.target.parentElement;\n    }\n\n    if (this.parent.frozenRows) {\n      this.updateFrozenRowreOrder(args);\n    } else {\n      this.updateFrozenColumnreOrder(args);\n    }\n\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      var indexes = [];\n\n      if (this.parent.filterSettings.columns.length || this.parent.sortSettings.columns.length) {\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n          indexes.push(parseInt(args.rows[i].getAttribute(literals.ariaRowIndex), 10));\n        }\n\n        this.selectedRowColls = indexes;\n      }\n\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.currentViewData = function () {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var currentVdata = [];\n    var fromIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n\n    for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n      var currentV = 'currentViewData';\n      currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n    }\n\n    if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n      currentVdata[0] = this.parent.currentViewData[fromIdx];\n    }\n\n    return currentVdata;\n  };\n\n  RowDD.prototype.saveChange = function (changeRecords, query) {\n    var _this = this;\n\n    this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query).then(function () {\n      _this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }).catch(function (e) {\n      var error = 'error';\n      var message = 'message';\n\n      if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n        e[error] = e[error][message];\n      }\n\n      _this.parent.trigger(events.actionFailure, e);\n    });\n  };\n\n  RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n    var selectedIndexes = this.parent.getSelectedRowIndexes();\n    var selectedRecords = [];\n    var draggedRecords = [];\n    var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n    var skip = this.parent.allowPaging ? this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize - this.parent.pageSettings.pageSize : 0;\n    var dropIdx = toIndex + skip;\n    var actualIdx = fromIndexes[0] + skip;\n\n    for (var i = 0, len = fromIndexes.length; i < len; i++) {\n      draggedRecords[i] = currentViewData[fromIndexes[i] + skip];\n    }\n\n    for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n      selectedRecords[i] = currentViewData[selectedIndexes[i] + skip];\n    }\n\n    for (var i = 0, len = draggedRecords.length; i < len; i++) {\n      if (i !== 0) {\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i])) {\n            actualIdx = j;\n            break;\n          }\n        }\n\n        for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n          if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n            if (actualIdx > j) {\n              dropIdx = j + 1;\n            }\n\n            break;\n          }\n        }\n      }\n\n      this.reorderRow(actualIdx - skip, dropIdx - skip);\n    }\n\n    if (this.isRefresh) {\n      this.parent.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n\n    for (var i = 0, len = selectedRecords.length; i < len; i++) {\n      for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n        if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n          selectedIndexes[i] = j - skip;\n          break;\n        }\n      }\n    }\n\n    this.selectedRowColls = selectedIndexes;\n  };\n\n  RowDD.prototype.stopTimer = function () {\n    window.clearInterval(this.timer);\n  };\n\n  RowDD.prototype.initializeDrag = function () {\n    var gObj = this.parent;\n    this.draggable = new Draggable(gObj.element, {\n      dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n      distance: 5,\n      helper: this.helper,\n      dragStart: this.dragStart,\n      drag: this.drag,\n      dragStop: this.dragStop,\n      isReplaceDragEle: this.isReplaceDragEle\n    });\n  };\n\n  RowDD.prototype.updateScrollPostion = function (e) {\n    var _this = this;\n\n    var y = getPosition(e).y;\n    var cliRect = this.isDropGrid.getContent().getBoundingClientRect();\n    var rowHeight = this.isDropGrid.getRowHeight() - 15;\n    var scrollElem = this.isDropGrid.getContent().firstElementChild;\n\n    if (cliRect.top >= y) {\n      var scrollPixel_1 = -this.isDropGrid.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_1);\n      }, 200);\n    } else if (cliRect.top + this.isDropGrid.getContent().clientHeight - rowHeight - 33 <= y) {\n      var scrollPixel_2 = this.isDropGrid.getRowHeight();\n      this.isOverflowBorder = false;\n      this.timer = window.setInterval(function () {\n        _this.setScrollDown(scrollElem, scrollPixel_2);\n      }, 200);\n    }\n  };\n\n  RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel) {\n    scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n  };\n\n  RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    var element = closestElement(e.target, 'tr');\n\n    if (parentsUntil(element, 'e-grid') && (parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id || this.istargetGrid)) {\n      var targetElement = element ? element : this.startedRow;\n      this.setBorder(targetElement, e.event, startedRow, targetRow);\n    }\n  };\n\n  RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n    var node = this.parent.element;\n\n    if (this.istargetGrid) {\n      node = this.isDropGrid.element;\n    }\n\n    var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n    this.removeFirstRowBorder(element);\n    this.removeLastRowBorder(element);\n\n    if (parentsUntil(element, 'e-grid') && !this.parent.rowDropSettings.targetID && element.classList.contains(literals.row) && parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id || this.istargetGrid) {\n      removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragborder']);\n      var rowElement = [];\n      var targetRowIndex = parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10);\n\n      if (targetRow && targetRowIndex === 0) {\n        var div = this.parent.createElement('div', {\n          className: 'e-firstrow-dragborder'\n        });\n        var gridheaderEle = this.isDropGrid.getHeaderContent();\n        gridheaderEle.classList.add('e-grid-relative');\n        div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n\n        if (!gridheaderEle.getElementsByClassName('e-firstrow-dragborder').length) {\n          gridheaderEle.appendChild(div);\n        }\n      } else if (this.parent.rowDropSettings.targetID && targetRow) {\n        element = this.isDropGrid.getRowByIndex(targetRowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else if (targetRow && parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10) > targetRowIndex) {\n        element = this.parent.getRowByIndex(targetRowIndex - 1);\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      } else {\n        rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n      }\n\n      var frzCols = this.parent.isFrozenGrid();\n\n      if (targetRow && targetRowIndex !== 0 && frzCols) {\n        var rowIndex = parseInt(element.getAttribute(literals.ariaRowIndex), 10);\n        var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n        rowElement = this.borderRowElement(rowIndex, selector);\n      }\n\n      if (rowElement.length > 0) {\n        addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n      }\n    }\n  };\n\n  RowDD.prototype.borderRowElement = function (rowIndex, selector) {\n    var lastRow = [];\n    lastRow = [].slice.call(this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector)).concat([].slice.call(this.isDropGrid.getMovableRowByIndex(rowIndex).querySelectorAll(selector)));\n\n    if (this.isDropGrid.getFrozenMode() === literals.leftRight) {\n      lastRow = lastRow.concat([].slice.call(this.isDropGrid.getFrozenRightRowByIndex(rowIndex).querySelectorAll(selector)));\n    }\n\n    return lastRow;\n  };\n\n  RowDD.prototype.getScrollWidth = function () {\n    var scrollElem = this.parent.getContent().firstElementChild;\n    return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n  };\n\n  RowDD.prototype.removeFirstRowBorder = function (element) {\n    if (this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element && element.rowIndex !== 0) {\n      remove(this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n    }\n  };\n\n  RowDD.prototype.removeLastRowBorder = function (element) {\n    var islastRowIndex;\n\n    if (this.parent.enableVirtualization) {\n      islastRowIndex = element && parseInt(element.getAttribute(literals.ariaRowIndex), 10) !== this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n    } else {\n      islastRowIndex = element && this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !== element.getAttribute('data-uid');\n    }\n\n    if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n      remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n    }\n  };\n\n  RowDD.prototype.removeBorder = function (element) {\n    this.removeFirstRowBorder(element);\n\n    if (!this.parent.rowDropSettings.targetID) {\n      this.removeLastRowBorder(element);\n    }\n\n    element = (this.isDropGrid.isFrozenGrid() ? this.isDropGrid.getMovableRows() : this.isDropGrid.getRows()).filter(function (row) {\n      return row.querySelector('td.e-dragborder');\n    })[0];\n\n    if (element) {\n      var rowElement = [].slice.call(element.getElementsByClassName('e-dragborder'));\n\n      if (this.parent.isFrozenGrid()) {\n        var rowIndex = parseInt(element.getAttribute(literals.ariaRowIndex), 10);\n        var selector = '.e-dragborder';\n        rowElement = this.borderRowElement(rowIndex, selector);\n      }\n\n      addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n    }\n  };\n\n  RowDD.prototype.getElementFromPosition = function (element, event) {\n    var position = getPosition(event);\n    element.style.display = 'none';\n    var target = document.elementFromPoint(position.x, position.y);\n    element.style.display = '';\n    return target;\n  };\n\n  RowDD.prototype.onDataBound = function () {\n    if (this.selectedRowColls.length > 0) {\n      this.parent.selectRows(this.selectedRowColls);\n      this.selectedRowColls = [];\n    }\n  };\n\n  RowDD.prototype.getTargetIdx = function (targetRow) {\n    return targetRow ? parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) : 0;\n  };\n\n  RowDD.prototype.singleRowDrop = function (e) {\n    var targetRow = closestElement(e.target, 'tr');\n    var srcControl = e.droppedElement.parentElement.ej2_instances[0];\n    var currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n    this.reorderRow(this.startedRowIndex, currentIndex);\n  };\n\n  RowDD.prototype.columnDrop = function (e) {\n    var gObj = this.parent;\n\n    if (e.droppedElement.getAttribute('action') !== 'grouping' && (parentsUntil(e.target, literals.row) || parentsUntil(e.target, 'e-emptyrow') || parentsUntil(e.target, literals.gridContent))) {\n      var targetRow = closestElement(e.target, 'tr');\n      var srcControl = void 0;\n      var currentIndex = void 0;\n\n      if (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' && e.droppedElement.parentElement.id === gObj.element.id || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' && e.droppedElement.parentElement.id !== gObj.element.id) {\n        return;\n      }\n\n      if (e.droppedElement.parentElement.id !== gObj.element.id) {\n        srcControl = e.droppedElement.parentElement.ej2_instances[0];\n      } else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n        this.singleRowDrop(e);\n        return;\n      }\n\n      if (srcControl.element.id !== gObj.element.id && srcControl.rowDropSettings.targetID !== gObj.element.id) {\n        return;\n      }\n\n      var records = srcControl.getSelectedRecords();\n      var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n\n      if (isNaN(targetIndex)) {\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        targetIndex = currentIndex = 0;\n      }\n\n      if (gObj.allowPaging) {\n        targetIndex = targetIndex + gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize;\n      } //Todo: drag and drop mapper & BatchChanges\n\n\n      gObj.notify(events.rowsAdded, {\n        toIndex: targetIndex,\n        records: records\n      });\n      gObj.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n      var selectedRows = srcControl.getSelectedRowIndexes();\n      var skip = srcControl.allowPaging ? srcControl.pageSettings.currentPage * srcControl.pageSettings.pageSize - srcControl.pageSettings.pageSize : 0;\n      this.selectedRows = [];\n\n      for (var i = 0, len = records.length; i < len; i++) {\n        this.selectedRows.push(skip + selectedRows[i]);\n      }\n\n      srcControl.notify(events.rowsRemoved, {\n        indexes: this.selectedRows,\n        records: records\n      });\n      srcControl.notify(events.modelChanged, {\n        type: events.actionBegin,\n        requestType: 'rowdraganddrop'\n      });\n    }\n  };\n\n  RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n    var gObj = this.parent;\n\n    if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n      //Todo: drag and drop mapper & BatchChanges\n      var skip = gObj.allowPaging ? gObj.pageSettings.currentPage * gObj.pageSettings.pageSize - gObj.pageSettings.pageSize : 0; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n      var fromIndex = fromIndexes;\n      toIndex = toIndex + skip;\n      this.selectedRows = gObj.getSelectedRowIndexes();\n      gObj.notify(events.rowPositionChanged, {\n        fromIndex: fromIndexes + skip,\n        toIndex: toIndex\n      });\n    }\n  };\n\n  RowDD.prototype.enableAfterRender = function (e) {\n    if (e.module === this.getModuleName() && e.enable) {\n      this.initializeDrag();\n    }\n  };\n  /**\n   * To destroy the print\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  RowDD.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (this.parent.isDestroyed || !gridElement || !gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent)) {\n      return;\n    }\n\n    this.draggable.destroy();\n    this.parent.off(events.initialEnd, this.initializeDrag);\n    this.parent.off(events.columnDrop, this.columnDrop);\n    this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n    this.parent.off(events.uiUpdate, this.enableAfterRender); //destory ejdrag and drop\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} returns the module name\n   * @private\n   */\n\n\n  RowDD.prototype.getModuleName = function () {\n    return 'rowDragAndDrop';\n  }; // eslint-disable-next-line @typescript-eslint/no-unused-vars\n\n\n  RowDD.prototype.processArgs = function (target) {\n    var gObj = this.parent;\n    var dragIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n\n    if (gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false || gObj.getSelectedRecords().length === 0) {\n      this.rows = [this.parent.getRowByIndex(dragIdx)];\n\n      if (gObj.isFrozenGrid()) {\n        this.rows = [gObj.getRowByIndex(dragIdx), gObj.getMovableRowByIndex(dragIdx)];\n\n        if (gObj.getFrozenMode() === literals.leftRight) {\n          this.rows = [gObj.getRowByIndex(dragIdx), gObj.getMovableRowByIndex(dragIdx), gObj.getFrozenRightRowByIndex(dragIdx)];\n        }\n      }\n\n      this.rowData = [this.parent.getRowInfo(this.startedRow.querySelector('.' + literals.rowCell)).rowData];\n    } else {\n      this.rows = gObj.getSelectedRows();\n      this.rowData = gObj.getSelectedRecords();\n\n      if (this.parent.enableVirtualization) {\n        this.rows = [];\n        var selIndex = gObj.getSelectedRowIndexes();\n\n        for (var i = 0, len = selIndex.length; i < len; i++) {\n          this.rows.push(gObj.getRowByIndex(selIndex[i]));\n\n          if (gObj.isFrozenGrid()) {\n            this.rows.push(gObj.getMovableRowByIndex(selIndex[i]));\n\n            if (gObj.getFrozenMode() === literals.leftRight) {\n              this.rows.push(gObj.getFrozenRightRowByIndex(selIndex[i]));\n            }\n          }\n        }\n      }\n    }\n  };\n\n  return RowDD;\n}();\n\nexport { RowDD };","map":{"version":3,"sources":["/Users/zhouzhou/Desktop/lightfront/node_modules/@syncfusion/ej2-grids/src/grid/actions/row-reorder.js"],"names":["Draggable","isNullOrUndefined","removeClass","remove","closest","closestElement","classList","parentsUntil","removeElement","getPosition","addRemoveActiveClasses","isActionPrevent","setRowsInTbody","resetRowIndex","events","Scroll","literals","RowDD","parent","_this","selectedRows","isOverflowBorder","selectedRowColls","isRefresh","isReplaceDragEle","istargetGrid","helper","e","gObj","target","draggable","currentStateTarget","visualElement","createElement","className","styles","element","offsetWidth","table","tbody","document","getElementsByClassName","length","rowDropSettings","targetID","contains","selectionSettings","type","mode","selectRow","parseInt","parentElement","getAttribute","ariaRowIndex","startedRow","cloneNode","frzCols","isFrozenGrid","rowIndex","innerHTML","getRowByIndex","getMovableRowByIndex","getFrozenMode","leftRight","getFrozenRightRowByIndex","processArgs","args","selectedRow","rows","dragelement","cloneElement","cancel","data","rowData","getSelectedRows","trigger","rowDragStartHelper","removeCell","gridChkBox","exp","RegExp","replace","appendChild","getSelectedRowIndexes","hasAttribute","index","dropCountEle","ele","querySelector","add","dragStart","spanCssEle","getSelectedRecords","style","left","rowDragStart","draggableType","fromIndex","Object","keys","currentViewData","dragStartData","dropElem","getElementById","ej2_instances","getModuleName","getContent","drag","isDropGrid","dropElement","id","getElementFromPosition","event","hoverState","enableHover","trElement","originalEvent","rowDrag","stopTimer","dragTarget","elem","groupSettings","columns","updateScrollPostion","frozenRows","getCurrentViewRecords","moveDragRows","islastRowIndex","enableVirtualization","renderModule","dataManager","dataSource","json","lastRowUid","bottomborder","gridcontentEle","width","getScrollWidth","bottom","removeBorder","content","selector","rowElement","slice","call","querySelectorAll","borderRowElement","dragStop","notify","preventBatch","instance","handler","processDragStop","arg1","isDestroyed","targetEle","stRow","dropIndex","rowDrop","row","gridContent","selectedIndexes","isRowDragable","reorderRows","refresh","rowOrder","targetRow","filter","cell","deleteCell","cellIndex","on","initialEnd","initializeDrag","columnDrop","onDataBoundFn","onDataBound","bind","addEventListener","dataBound","uiUpdate","enableAfterRender","prototype","refreshRow","mtbody","frTbody","mTarget","frTarget","isLeftRight","tbodyMovableHeader","tbodyMovableContent","frHdr","frCnt","tbodyContent","getContentTable","tbodyHeader","getHeaderTable","getMovableHeaderTbody","getMovableContentTbody","getFrozenRightHeaderTbody","getFrozenRightContentTbody","i","len","insertBefore","tr","mtr","frTr","refreshVirtualData","refreshData","_loop_1","this_1","updateFrozenRowreOrder","tbodyMovH","tbodyMovC","tbodyFrH","tbodyFrC","tbodyC","tbodyH","concat","clearSelection","targetRows","refreshRowTarget","mTr","targetIdx","updateFrozenColumnreOrder","recordobj","getMovableRows","getRows","startIndex","refreshVirtualCacheOnRowDD","objIndex","end","rowsElem","mvbRows","frRightRow","getFrozenRightRows","setAttribute","toString","rowObj","movobj","frObj","rowObjects","getRowsObject","movbObject","getMovableRowsObject","frRightObject","getFrozenRightRowsObject","movbRows","frRightRows","isNaN","childGrid","detailCollapseAll","children","isDetailRow","splice","selectRows","indexes","filterSettings","sortSettings","push","currentVdata","fromIdx","n","currentV","saveChange","changeRecords","query","getDataModule","saveChanges","getPrimaryKeyFieldNames","then","modelChanged","actionBegin","requestType","catch","error","message","actionFailure","fromIndexes","toIndex","selectedRecords","draggedRecords","skip","allowPaging","pageSettings","currentPage","pageSize","dropIdx","actualIdx","j","len1","JSON","stringify","reorderRow","window","clearInterval","timer","distance","y","cliRect","getBoundingClientRect","rowHeight","getRowHeight","scrollElem","firstElementChild","top","scrollPixel_1","setInterval","setScrollDown","clientHeight","scrollPixel_2","scrollPixel","scrollTop","targetElement","setBorder","node","removeFirstRowBorder","removeLastRowBorder","targetRowIndex","div","gridheaderEle","getHeaderContent","lastRow","scrollWidth","getScrollBarWidth","position","display","elementFromPoint","x","getTargetIdx","singleRowDrop","srcControl","droppedElement","currentIndex","startedRowIndex","isSingleRowDragDrop","records","targetIndex","rowsAdded","rowsRemoved","rowPositionChanged","module","enable","destroy","gridElement","gridHeader","off","removeEventListener","dragIdx","cells","getRowInfo","rowCell","selIndex"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,iBAApB,QAA6C,sBAA7C;AACA,SAASC,WAAT,QAA4B,sBAA5B;AACA,SAASC,MAAT,EAAiBC,OAAO,IAAIC,cAA5B,EAA4CC,SAA5C,QAA6D,sBAA7D;AACA,SAASC,YAAT,EAAuBC,aAAvB,EAAsCC,WAAtC,EAAmDC,sBAAnD,EAA2EC,eAA3E,QAAkG,cAAlG;AACA,SAASC,cAAT,EAAyBC,aAAzB,QAA8C,cAA9C;AACA,OAAO,KAAKC,MAAZ,MAAwB,kBAAxB;AACA,SAASC,MAAT,QAAuB,mBAAvB;AACA,OAAO,KAAKC,QAAZ,MAA0B,yBAA1B,C,CACA;;AACA;AACA;AACA;AACA;AACA;AACA;;AACA,IAAIC,KAAK;AAAG;AAAe,YAAY;AACnC;AACJ;AACA;AACA;AACA;AACA;AACI,WAASA,KAAT,CAAeC,MAAf,EAAuB;AACnB,QAAIC,KAAK,GAAG,IAAZ;;AACA,SAAKC,YAAL,GAAoB,EAApB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,gBAAL,GAAwB,EAAxB;AACA,SAAKC,SAAL,GAAiB,IAAjB;AACA,SAAKC,gBAAL,GAAwB,IAAxB;AACA,SAAKC,YAAL,GAAoB,KAApB,CAPmB,CAQnB;;AACA,SAAKC,MAAL,GAAc,UAAUC,CAAV,EAAa;AACvB,UAAIC,IAAI,GAAGT,KAAK,CAACD,MAAjB;AACA,UAAIW,MAAM,GAAGV,KAAK,CAACW,SAAN,CAAgBC,kBAA7B;;AACA,UAAIC,aAAa,GAAGb,KAAK,CAACD,MAAN,CAAae,aAAb,CAA2B,KAA3B,EAAkC;AAClDC,QAAAA,SAAS,EAAE,oDADuC;AAElDC,QAAAA,MAAM,EAAE,qCAAqCP,IAAI,CAACQ,OAAL,CAAaC;AAFR,OAAlC,CAApB;;AAIA,UAAIC,KAAK,GAAGnB,KAAK,CAACD,MAAN,CAAae,aAAb,CAA2B,OAA3B,EAAoC;AAAEE,QAAAA,MAAM,EAAE,WAAWP,IAAI,CAACQ,OAAL,CAAaC;AAAlC,OAApC,CAAZ;;AACA,UAAIE,KAAK,GAAGpB,KAAK,CAACD,MAAN,CAAae,aAAb,CAA2BjB,QAAQ,CAACuB,KAApC,CAAZ;;AACA,UAAIC,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,EAAkDC,MAAlD,IACCd,IAAI,CAACe,eAAL,CAAqBC,QAArB,KAAmC,CAACf,MAAM,CAACvB,SAAP,CAAiBuC,QAAjB,CAA0B,uBAA1B,CAAD,IAC7BjB,IAAI,CAACkB,iBAAL,CAAuBC,IAAvB,KAAgC,QADJ,IACiB,CAACxC,YAAY,CAACsB,MAAD,EAAS,WAAT,CADhE,CADD,IAGC,CAACD,IAAI,CAACe,eAAL,CAAqBC,QAAtB,IAAkC,CAACrC,YAAY,CAACsB,MAAD,EAAS,eAAT,CAHpD,EAGgF;AAC5E,eAAO,KAAP;AACH;;AACD,UAAID,IAAI,CAACe,eAAL,CAAqBC,QAArB,IACAhB,IAAI,CAACkB,iBAAL,CAAuBE,IAAvB,KAAgC,KADhC,IACyCpB,IAAI,CAACkB,iBAAL,CAAuBC,IAAvB,KAAgC,QAD7E,EACuF;AACnFnB,QAAAA,IAAI,CAACqB,SAAL,CAAeC,QAAQ,CAAC/B,KAAK,CAACW,SAAN,CAAgBC,kBAAhB,CAAmCoB,aAAnC,CAAiDC,YAAjD,CAA8DpC,QAAQ,CAACqC,YAAvE,CAAD,EAAuF,EAAvF,CAAvB;AACH;;AACDlC,MAAAA,KAAK,CAACmC,UAAN,GAAmBjD,cAAc,CAACwB,MAAD,EAAS,IAAT,CAAd,CAA6B0B,SAA7B,CAAuC,IAAvC,CAAnB;;AACA,UAAIC,OAAO,GAAGrC,KAAK,CAACD,MAAN,CAAauC,YAAb,EAAd;;AACA,UAAID,OAAJ,EAAa;AACT,YAAIE,QAAQ,GAAGR,QAAQ,CAAC7C,cAAc,CAACwB,MAAD,EAAS,IAAT,CAAd,CAA6BuB,YAA7B,CAA0CpC,QAAQ,CAACqC,YAAnD,CAAD,EAAmE,EAAnE,CAAvB;AACAlC,QAAAA,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,GAA6B,EAA7B;AACAxC,QAAAA,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,IAA8B/B,IAAI,CAACgC,aAAL,CAAmBF,QAAnB,EAA6BC,SAA3D;AACAxC,QAAAA,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,IAA8B/B,IAAI,CAACiC,oBAAL,CAA0BH,QAA1B,EAAoCC,SAAlE;;AACA,YAAI/B,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAtC,EAAiD;AAC7C5C,UAAAA,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,IAA8B/B,IAAI,CAACoC,wBAAL,CAA8BN,QAA9B,EAAwCC,SAAtE;AACH;AACJ;;AACDxC,MAAAA,KAAK,CAAC8C,WAAN,CAAkBpC,MAAlB;;AACA,UAAIqC,IAAI,GAAG;AACPC,QAAAA,WAAW,EAAEhD,KAAK,CAACiD,IADZ;AACkBC,QAAAA,WAAW,EAAExC,MAD/B;AAEPyC,QAAAA,YAAY,EAAEtC,aAFP;AAEsBuC,QAAAA,MAAM,EAAE,KAF9B;AAEqCC,QAAAA,IAAI,EAAErD,KAAK,CAACsD;AAFjD,OAAX;AAIA,UAAIrD,YAAY,GAAGQ,IAAI,CAAC8C,eAAL,EAAnB;AACA9C,MAAAA,IAAI,CAAC+C,OAAL,CAAa7D,MAAM,CAAC8D,kBAApB,EAAwCV,IAAxC;AACA,UAAIK,MAAM,GAAG,QAAb;;AACA,UAAIL,IAAI,CAACK,MAAD,CAAR,EAAkB;AACd,eAAO,KAAP;AACH;;AACD/D,MAAAA,aAAa,CAACW,KAAK,CAACmC,UAAP,EAAmB,eAAnB,CAAb;AACA9C,MAAAA,aAAa,CAACW,KAAK,CAACmC,UAAP,EAAmB,sBAAnB,CAAb;AACA9C,MAAAA,aAAa,CAACW,KAAK,CAACmC,UAAP,EAAmB,oBAAnB,CAAb;;AACAnC,MAAAA,KAAK,CAAC0D,UAAN,CAAiB1D,KAAK,CAACmC,UAAvB,EAAmCtC,QAAQ,CAAC8D,UAA5C;;AACA,UAAIC,GAAG,GAAG,IAAIC,MAAJ,CAAW,UAAX,EAAuB,GAAvB,CAAV,CA7CuB,CA6CgB;;AACvC7D,MAAAA,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,GAA6BxC,KAAK,CAACmC,UAAN,CAAiBK,SAAjB,CAA2BsB,OAA3B,CAAmCF,GAAnC,EAAwC,EAAxC,CAA7B;AACAxC,MAAAA,KAAK,CAAC2C,WAAN,CAAkB/D,KAAK,CAACmC,UAAxB;;AACA,UAAI1B,IAAI,CAACuD,qBAAL,GAA6BzC,MAA7B,GAAsC,CAAtC,IAA2CvB,KAAK,CAACmC,UAAN,CAAiB8B,YAAjB,CAA8B,eAA9B,CAA/C,EAA+F;AAC3F,YAAIC,KAAK,GAAGzD,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAlC,GAA8C,CAA9C,GAAkD,CAA9D;;AACA,YAAIuB,YAAY,GAAGnE,KAAK,CAACD,MAAN,CAAae,aAAb,CAA2B,MAA3B,EAAmC;AAClDC,UAAAA,SAAS,EAAE,kBADuC;AACnByB,UAAAA,SAAS,EAAEH,OAAO,GAAG,KAAKpC,YAAY,CAACsB,MAAb,GAAsB2C,KAA9B,GAAsC,KAAKjE,YAAY,CAACsB;AADvD,SAAnC,CAAnB;;AAGAV,QAAAA,aAAa,CAACkD,WAAd,CAA0BI,YAA1B;AACH;;AACD,UAAIC,GAAG,GAAGlF,cAAc,CAACwB,MAAD,EAAS,IAAT,CAAd,CAA6B2D,aAA7B,CAA2C,qBAA3C,CAAV;;AACA,UAAID,GAAJ,EAAS;AACLA,QAAAA,GAAG,CAACjF,SAAJ,CAAcmF,GAAd,CAAkB,gBAAlB;AACH;;AACDnD,MAAAA,KAAK,CAAC4C,WAAN,CAAkB3C,KAAlB;AACAP,MAAAA,aAAa,CAACkD,WAAd,CAA0B5C,KAA1B;AACAV,MAAAA,IAAI,CAACQ,OAAL,CAAa8C,WAAb,CAAyBlD,aAAzB;AACA,aAAOA,aAAP;AACH,KA/DD;;AAgEA,SAAK0D,SAAL,GAAiB,UAAU/D,CAAV,EAAa;AAC1B,UAAIC,IAAI,GAAGT,KAAK,CAACD,MAAjB;;AACA,UAAIsB,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,EAAkDC,MAAtD,EAA8D;AAC1D;AACH;;AACD,UAAIb,MAAM,GAAGF,CAAC,CAACE,MAAf;;AACA,UAAI8D,UAAU,GAAGxE,KAAK,CAACD,MAAN,CAAakB,OAAb,CAAqBoD,aAArB,CAAmC,mBAAnC,CAAjB;;AACA,UAAIrE,KAAK,CAACD,MAAN,CAAa0E,kBAAb,GAAkClD,MAAlC,GAA2C,CAA3C,IAAgDiD,UAApD,EAAgE;AAC5DA,QAAAA,UAAU,CAACE,KAAX,CAAiBC,IAAjB,GAAwB3E,KAAK,CAACD,MAAN,CAAakB,OAAb,CAAqBoD,aAArB,CAAmC,0BAAnC,EACnBnD,WADmB,GACL,CADK,GACD,IADvB;AAEH;;AACDlB,MAAAA,KAAK,CAAC8C,WAAN,CAAkBpC,MAAlB;;AACAD,MAAAA,IAAI,CAAC+C,OAAL,CAAa7D,MAAM,CAACiF,YAApB,EAAkC;AAC9B3B,QAAAA,IAAI,EAAEjD,KAAK,CAACiD,IADkB;AACZvC,QAAAA,MAAM,EAAEF,CAAC,CAACE,MADE;AAE9BmE,QAAAA,aAAa,EAAE,MAFe;AAEPC,QAAAA,SAAS,EAAE/C,QAAQ,CAAC/B,KAAK,CAACiD,IAAN,CAAW,CAAX,EAAchB,YAAd,CAA2BpC,QAAQ,CAACqC,YAApC,CAAD,EAAoD,EAApD,CAFZ;AAG9BmB,QAAAA,IAAI,EAAG0B,MAAM,CAACC,IAAP,CAAYhF,KAAK,CAACsD,OAAN,CAAc,CAAd,CAAZ,EAA8B/B,MAA9B,GAAuC,CAAxC,GAA6CvB,KAAK,CAACsD,OAAnD,GAA6DtD,KAAK,CAACiF,eAAN;AAHrC,OAAlC;AAKAjF,MAAAA,KAAK,CAACkF,aAAN,GAAsBlF,KAAK,CAACsD,OAA5B;AACA,UAAI6B,QAAQ,GAAG9D,QAAQ,CAAC+D,cAAT,CAAwB3E,IAAI,CAACe,eAAL,CAAqBC,QAA7C,CAAf;;AACA,UAAIhB,IAAI,CAACe,eAAL,CAAqBC,QAArB,IAAiC0D,QAAjC,IAA6CA,QAAQ,CAACE,aAAtD,IACAF,QAAQ,CAACE,aAAT,CAAuB,CAAvB,EAA0BC,aAA1B,OAA8C,MADlD,EAC0D;AACtDH,QAAAA,QAAQ,CAACE,aAAT,CAAuB,CAAvB,EAA0BE,UAA1B,GAAuCpG,SAAvC,CAAiDmF,GAAjD,CAAqD,gBAArD;AACH;AACJ,KAvBD;;AAwBA,SAAKkB,IAAL,GAAY,UAAUhF,CAAV,EAAa;AACrB,UAAIC,IAAI,GAAGT,KAAK,CAACD,MAAjB;AACAC,MAAAA,KAAK,CAACyF,UAAN,GAAmBzF,KAAK,CAACD,MAAzB;AACAC,MAAAA,KAAK,CAACM,YAAN,GAAqB,KAArB;;AACA,UAAIN,KAAK,CAACD,MAAN,CAAayB,eAAb,CAA6BC,QAAjC,EAA2C;AACvC,YAAIiE,WAAW,GAAGrE,QAAQ,CAAC+D,cAAT,CAAwB3E,IAAI,CAACe,eAAL,CAAqBC,QAA7C,CAAlB;AACAzB,QAAAA,KAAK,CAACyF,UAAN,GAAmBC,WAAW,CAACL,aAAZ,CAA0B,CAA1B,CAAnB;;AACA,YAAIjG,YAAY,CAACoB,CAAC,CAACE,MAAH,EAAW,QAAX,CAAhB,EAAsC;AAClCV,UAAAA,KAAK,CAACM,YAAN,GAAqBN,KAAK,CAACD,MAAN,CAAayB,eAAb,CAA6BC,QAA7B,KAA0CrC,YAAY,CAACoB,CAAC,CAACE,MAAH,EAAW,QAAX,CAAZ,CAAiCiF,EAAhG;AACH;AACJ;;AACD,UAAIxC,YAAY,GAAGnD,KAAK,CAACD,MAAN,CAAakB,OAAb,CAAqBoD,aAArB,CAAmC,oBAAnC,CAAnB;;AACA,UAAI3D,MAAM,GAAGV,KAAK,CAAC4F,sBAAN,CAA6BzC,YAA7B,EAA2C3C,CAAC,CAACqF,KAA7C,CAAb;;AACA1G,MAAAA,SAAS,CAACgE,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,EAAoB,WAApB,CAAjC,CAAT;AACAnD,MAAAA,KAAK,CAACE,gBAAN,GAAyB,IAAzB;AACAF,MAAAA,KAAK,CAAC8F,UAAN,GAAmBrF,IAAI,CAACsF,WAAxB;AACA,UAAIC,SAAS,GAAG5G,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAZ,GAAiCxB,cAAc,CAACsB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA/C,GAAkE,IAAlF;AACAD,MAAAA,IAAI,CAACsF,WAAL,GAAmB,KAAnB;;AACA,UAAI,CAACvF,CAAC,CAACE,MAAP,EAAe;AACX;AACH;;AACDV,MAAAA,KAAK,CAAC8C,WAAN,CAAkBpC,MAAlB;;AACA,UAAIqC,IAAI,GAAG;AACPE,QAAAA,IAAI,EAAEjD,KAAK,CAACiD,IADL;AACWvC,QAAAA,MAAM,EAAEA,MADnB;AAC2BmE,QAAAA,aAAa,EAAE,MAD1C;AAEPxB,QAAAA,IAAI,EAAErD,KAAK,CAACsD,OAFL;AAEc2C,QAAAA,aAAa,EAAEzF,CAF7B;AAEgC4C,QAAAA,MAAM,EAAE;AAFxC,OAAX;AAIA3C,MAAAA,IAAI,CAAC+C,OAAL,CAAa7D,MAAM,CAACuG,OAApB,EAA6BnD,IAA7B;;AACA/C,MAAAA,KAAK,CAACmG,SAAN;;AACA,UAAIpD,IAAI,CAACK,MAAT,EAAiB;AACb;AACH;;AACD3C,MAAAA,IAAI,CAACQ,OAAL,CAAa9B,SAAb,CAAuBmF,GAAvB,CAA2B,WAA3B;AACAtE,MAAAA,KAAK,CAACoG,UAAN,GAAmBJ,SAAS,IAAI5G,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAZ,CAA+BiF,EAA/B,KAAsCxC,YAAY,CAACnB,aAAb,CAA2B2D,EAA9E,GACf5D,QAAQ,CAACiE,SAAS,CAAC/D,YAAV,CAAuBpC,QAAQ,CAACqC,YAAhC,CAAD,EAAgD,EAAhD,CADO,GAC+CH,QAAQ,CAAC/B,KAAK,CAACmC,UAAN,CAAiBF,YAAjB,CAA8BpC,QAAQ,CAACqC,YAAvC,CAAD,EAAuD,EAAvD,CAD1E;;AAEA,UAAIzB,IAAI,CAACe,eAAL,CAAqBC,QAAzB,EAAmC;AAC/B,YAAI,CAACrC,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAb,IACAtB,YAAY,CAAC+D,YAAY,CAACnB,aAAd,EAA6B,QAA7B,CAAZ,CAAmD2D,EAAnD,KAA0DvG,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAZ,CAA+BiF,EAD7F,EACiG;AAC7FxG,UAAAA,SAAS,CAACgE,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,cAAD,CAApC,CAAT;AACH,SAHD,MAIK;AACDhE,UAAAA,SAAS,CAACgE,YAAD,EAAe,CAAC,cAAD,CAAf,EAAiC,CAAC,iBAAD,CAAjC,CAAT;AACH;AACJ,OARD,MASK;AACD,YAAIkD,IAAI,GAAGjH,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAvB;;AACA,YAAI2F,IAAI,IAAIA,IAAI,CAACV,EAAL,KAAYxC,YAAY,CAACnB,aAAb,CAA2B2D,EAAnD,EAAuD;AACnDxG,UAAAA,SAAS,CAACgE,YAAD,EAAe,CAAC,WAAD,CAAf,EAA8B,CAAC,cAAD,CAA9B,CAAT;AACH,SAFD,MAGK;AACDhE,UAAAA,SAAS,CAACgE,YAAD,EAAe,CAAC,iBAAD,CAAf,EAAoC,CAAC,WAAD,CAApC,CAAT;AACH;AACJ;;AACD,UAAI/D,YAAY,CAACY,KAAK,CAACyF,UAAN,CAAiBxE,OAAlB,EAA2B,QAA3B,CAAhB,EAAsD;AAClD,YAAI,CAAC,CAACjB,KAAK,CAACyF,UAAN,CAAiBa,aAAjB,CAA+BC,OAA/B,CAAuChF,MAAxC,IAAkDf,CAAC,CAACE,MAAF,CAASvB,SAAT,CAAmBuC,QAAnB,CAA4B,uBAA5B,CAAnD,KACA,CAAC1B,KAAK,CAACyF,UAAN,CAAiBxE,OAAjB,CAAyBoD,aAAzB,CAAuC,aAAvC,CADL,EAC4D;AACxD,cAAIjF,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAZ,IAAkCtB,YAAY,CAACsB,MAAD,EAAS,QAAT,CAAZ,CAA+BiF,EAA/B,KAAsC3F,KAAK,CAACyF,UAAN,CAAiBxE,OAAjB,CAAyB0E,EAArG,EAAyG;AACrG3F,YAAAA,KAAK,CAACwG,mBAAN,CAA0BhG,CAAC,CAACqF,KAA5B;AACH;;AACD,cAAK,CAAC7F,KAAK,CAACE,gBAAN,IAA0BF,KAAK,CAACD,MAAN,CAAa0G,UAAb,GAA0BzG,KAAK,CAACoG,UAA3D,MACArE,QAAQ,CAAC/B,KAAK,CAACmC,UAAN,CAAiBF,YAAjB,CAA8BpC,QAAQ,CAACqC,YAAvC,CAAD,EAAuD,EAAvD,CAAR,KAAuElC,KAAK,CAACoG,UAA7E,IAA2FpG,KAAK,CAACM,YADjG,CAAD,IAEIN,KAAK,CAACM,YAAN,IAAsB0F,SAAtB,IAAmChG,KAAK,CAACyF,UAAN,CAAiBhD,aAAjB,CAA+BzC,KAAK,CAACyF,UAAN,CAAiBiB,qBAAjB,GAAyCnF,MAAzC,GAAkD,CAAjF,EACnCU,YADmC,CACtB,UADsB,MACN+D,SAAS,CAAC/D,YAAV,CAAuB,UAAvB,CAHrC,EAG0E;AACtEjC,YAAAA,KAAK,CAAC2G,YAAN,CAAmBnG,CAAnB,EAAsBR,KAAK,CAACmC,UAA5B,EAAwC6D,SAAxC;AACH,WALD,MAMK;AACD,gBAAIY,cAAc,GAAG,KAAK,CAA1B;;AACA,gBAAI5G,KAAK,CAACD,MAAN,CAAa8G,oBAAjB,EAAuC;AACnCD,cAAAA,cAAc,GAAGZ,SAAS,IAAIjE,QAAQ,CAACiE,SAAS,CAAC/D,YAAV,CAAuBpC,QAAQ,CAACqC,YAAhC,CAAD,EAAgD,EAAhD,CAAR,KAC1BlC,KAAK,CAACD,MAAN,CAAa+G,YAAb,CAA0BzD,IAA1B,CAA+B0D,WAA/B,CAA2CC,UAA3C,CAAsDC,IAAtD,CAA2D1F,MAA3D,GAAoE,CADxE;AAEH,aAHD,MAIK;AACD,kBAAI2F,UAAU,GAAGlH,KAAK,CAACD,MAAN,CAAa0C,aAAb,CAA2BzC,KAAK,CAACD,MAAN,CAAa2G,qBAAb,GAAqCnF,MAArC,GAA8C,CAAzE,EACbU,YADa,CACA,UADA,CAAjB;;AAEA2E,cAAAA,cAAc,GAAGZ,SAAS,IAAIkB,UAAU,KAAKlB,SAAS,CAAC/D,YAAV,CAAuB,UAAvB,CAA5B,IAAkEiF,UAAU,KACzFlH,KAAK,CAACmC,UAAN,CAAiBF,YAAjB,CAA8B,UAA9B,CADJ;AAEH;;AACD,gBAAI2E,cAAc,IAAI,CAAC5G,KAAK,CAACD,MAAN,CAAayB,eAAb,CAA6BC,QAApD,EAA8D;AAC1D,kBAAI0F,YAAY,GAAGnH,KAAK,CAACD,MAAN,CAAae,aAAb,CAA2B,KAA3B,EAAkC;AAAEC,gBAAAA,SAAS,EAAE;AAAb,eAAlC,CAAnB;;AACA,kBAAIqG,cAAc,GAAGpH,KAAK,CAACD,MAAN,CAAawF,UAAb,EAArB;;AACA4B,cAAAA,YAAY,CAACzC,KAAb,CAAmB2C,KAAnB,GAA2BrH,KAAK,CAACD,MAAN,CAAakB,OAAb,CAAqBC,WAArB,GAAmClB,KAAK,CAACsH,cAAN,EAAnC,GAA4D,IAAvF;;AACA,kBAAI,CAACF,cAAc,CAAC9F,sBAAf,CAAsC,sBAAtC,EAA8DC,MAAnE,EAA2E;AACvE6F,gBAAAA,cAAc,CAACjI,SAAf,CAAyBmF,GAAzB,CAA6B,iBAA7B;AACA8C,gBAAAA,cAAc,CAACrD,WAAf,CAA2BoD,YAA3B;AACAA,gBAAAA,YAAY,CAACzC,KAAb,CAAmB6C,MAAnB,GAA4BvH,KAAK,CAACsH,cAAN,KAAyB,IAArD;AACH;AACJ;;AACDtH,YAAAA,KAAK,CAACwH,YAAN,CAAmBxB,SAAnB;AACH;AACJ;;AACD,YAAItF,MAAM,IAAIA,MAAM,CAACvB,SAAP,CAAiBuC,QAAjB,CAA0B7B,QAAQ,CAAC4H,OAAnC,CAAV,IACG,CAACzH,KAAK,CAACyF,UAAN,CAAiBxE,OAAjB,CAAyBoD,aAAzB,CAAuC,aAAvC,CADJ,IAC6DrE,KAAK,CAACM,YADvE,EACqF;AACjFN,UAAAA,KAAK,CAACwH,YAAN,CAAmBxB,SAAnB;;AACA,cAAIzD,QAAQ,GAAGvC,KAAK,CAACyF,UAAN,CAAiBiB,qBAAjB,GAAyCnF,MAAzC,GAAkD,CAAjE;AACA,cAAImG,QAAQ,GAAG,gDAAf;AACA,cAAIC,UAAU,GAAG,EAAjB;AACAA,UAAAA,UAAU,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc7H,KAAK,CAACyF,UAAN,CAAiBhD,aAAjB,CAA+BF,QAA/B,EAAyCuF,gBAAzC,CAA0DJ,QAA1D,CAAd,CAAb;;AACA,cAAI1H,KAAK,CAACyF,UAAN,CAAiBnD,YAAjB,EAAJ,EAAqC;AACjCqF,YAAAA,UAAU,GAAG3H,KAAK,CAAC+H,gBAAN,CAAuBxF,QAAvB,EAAiCmF,QAAjC,CAAb;AACH;;AACD,cAAIC,UAAU,CAACpG,MAAX,GAAoB,CAAxB,EAA2B;AACvBhC,YAAAA,sBAAsB,CAACoI,UAAD,EAAa,IAAb,EAAmB,cAAnB,CAAtB;AACH;AACJ;AACJ;AACJ,KAxGD;;AAyGA,SAAKK,QAAL,GAAgB,UAAUxH,CAAV,EAAa;AACzB,UAAIhB,eAAe,CAACQ,KAAK,CAACD,MAAP,CAAnB,EAAmC;AAC/BC,QAAAA,KAAK,CAACD,MAAN,CAAakI,MAAb,CAAoBtI,MAAM,CAACuI,YAA3B,EAAyC;AACrCC,UAAAA,QAAQ,EAAEnI,KAD2B;AACpBoI,UAAAA,OAAO,EAAEpI,KAAK,CAACqI,eADK;AACYC,UAAAA,IAAI,EAAE9H;AADlB,SAAzC;AAGH,OAJD,MAKK;AACDR,QAAAA,KAAK,CAACqI,eAAN,CAAsB7H,CAAtB;AACH;AACJ,KATD;;AAUA,SAAK6H,eAAL,GAAuB,UAAU7H,CAAV,EAAa;AAChC,UAAIC,IAAI,GAAGT,KAAK,CAACD,MAAjB;;AACA,UAAIC,KAAK,CAACD,MAAN,CAAawI,WAAjB,EAA8B;AAC1B;AACH;;AACD,UAAIC,SAAS,GAAGxI,KAAK,CAAC4F,sBAAN,CAA6BpF,CAAC,CAACD,MAA/B,EAAuCC,CAAC,CAACqF,KAAzC,CAAhB;;AACA,UAAInF,MAAM,GAAG8H,SAAS,IAAI,CAACA,SAAS,CAACrJ,SAAV,CAAoBuC,QAApB,CAA6B,eAA7B,CAAd,GACT8G,SADS,GACGhI,CAAC,CAACE,MADlB;AAEAD,MAAAA,IAAI,CAACQ,OAAL,CAAa9B,SAAb,CAAuBH,MAAvB,CAA8B,WAA9B;AACA,UAAI0G,WAAW,GAAGrE,QAAQ,CAAC+D,cAAT,CAAwB3E,IAAI,CAACe,eAAL,CAAqBC,QAA7C,CAAlB;;AACA,UAAIhB,IAAI,CAACe,eAAL,CAAqBC,QAArB,IAAiCiE,WAAjC,IAAgDA,WAAW,CAACL,aAA5D,IACAK,WAAW,CAACL,aAAZ,CAA0B,CAA1B,EAA6BC,aAA7B,OAAiD,MADrD,EAC6D;AACzDI,QAAAA,WAAW,CAACL,aAAZ,CAA0B,CAA1B,EAA6BE,UAA7B,GAA0CpG,SAA1C,CAAoDH,MAApD,CAA2D,gBAA3D;AACH;;AACD,UAAII,YAAY,CAACY,KAAK,CAACyF,UAAN,CAAiBxE,OAAlB,EAA2B,QAA3B,CAAhB,EAAsD;AAClDjB,QAAAA,KAAK,CAACmG,SAAN;;AACAnG,QAAAA,KAAK,CAACyF,UAAN,CAAiBM,WAAjB,GAA+B/F,KAAK,CAAC8F,UAArC;;AACA9F,QAAAA,KAAK,CAACyF,UAAN,CAAiBF,UAAjB,GAA8BpG,SAA9B,CAAwCH,MAAxC,CAA+C,iBAA/C;;AACAgB,QAAAA,KAAK,CAACwH,YAAN,CAAmBgB,SAAnB;;AACA,YAAIC,KAAK,GAAGzI,KAAK,CAACyF,UAAN,CAAiBxE,OAAjB,CAAyBoD,aAAzB,CAAuC,iBAAvC,CAAZ;;AACA,YAAIoE,KAAJ,EAAW;AACPA,UAAAA,KAAK,CAACtJ,SAAN,CAAgBH,MAAhB,CAAuB,gBAAvB;AACH;AACJ;;AACDgB,MAAAA,KAAK,CAAC8C,WAAN,CAAkBpC,MAAlB;;AACA,UAAIV,KAAK,CAACD,MAAN,CAAa8G,oBAAb,IAAqC/H,iBAAiB,CAACkB,KAAK,CAACiD,IAAN,CAAW,CAAX,CAAD,CAA1D,EAA2E;AACvEjD,QAAAA,KAAK,CAACoG,UAAN,GAAmB,IAAnB;AACApH,QAAAA,MAAM,CAACwB,CAAC,CAACD,MAAH,CAAN;AACA;AACH;;AACD,UAAIwC,IAAI,GAAG;AACPrC,QAAAA,MAAM,EAAEA,MADD;AACSmE,QAAAA,aAAa,EAAE,MADxB;AAEPzB,QAAAA,MAAM,EAAE,KAFD;AAGP0B,QAAAA,SAAS,EAAE/C,QAAQ,CAAC/B,KAAK,CAACiD,IAAN,CAAW,CAAX,EAAchB,YAAd,CAA2BpC,QAAQ,CAACqC,YAApC,CAAD,EAAoD,EAApD,CAHZ;AAIPwG,QAAAA,SAAS,EAAE1I,KAAK,CAACoG,UAJV;AAIsBnD,QAAAA,IAAI,EAAEjD,KAAK,CAACiD,IAJlC;AAKPI,QAAAA,IAAI,EAAG0B,MAAM,CAACC,IAAP,CAAYhF,KAAK,CAACkF,aAAN,CAAoB,CAApB,CAAZ,EAAoC3D,MAApC,GAA6C,CAA9C,GAAmDvB,KAAK,CAACkF,aAAzD,GAAyElF,KAAK,CAACiF,eAAN;AALxE,OAAX;AAOAxE,MAAAA,IAAI,CAAC+C,OAAL,CAAa7D,MAAM,CAACgJ,OAApB,EAA6B5F,IAA7B,EAAmC,YAAY;AAC3C,YAAI,EAAE3D,YAAY,CAACsB,MAAD,EAASb,QAAQ,CAAC+I,GAAlB,CAAZ,IAAsCxJ,YAAY,CAACsB,MAAD,EAAS,YAAT,CAAlD,IACCtB,YAAY,CAACsB,MAAD,EAASb,QAAQ,CAACgJ,WAAlB,CADf,KACkD9F,IAAI,CAACK,MAD3D,EACmE;AAC/DpD,UAAAA,KAAK,CAACoG,UAAN,GAAmB,IAAnB;AACApH,UAAAA,MAAM,CAACwB,CAAC,CAACD,MAAH,CAAN;AACA;AACH;;AACDP,QAAAA,KAAK,CAACI,SAAN,GAAkB,KAAlB;;AACA,YAAI0I,eAAe,GAAG9I,KAAK,CAACD,MAAN,CAAaiE,qBAAb,EAAtB;;AACA,YAAIvD,IAAI,CAACsI,aAAL,EAAJ,EAA0B;AACtB,cAAI,CAAC/I,KAAK,CAACD,MAAN,CAAayB,eAAb,CAA6BC,QAA9B,IACAzB,KAAK,CAACmC,UAAN,CAAiBkC,aAAjB,CAA+B,0BAA/B,CADA,IAC8DyE,eAAe,CAACvH,MAAhB,GAAyB,CADvF,IAEAuH,eAAe,CAACvH,MAAhB,KAA2BvB,KAAK,CAACD,MAAN,CAAa2G,qBAAb,GAAqCnF,MAFpE,EAE4E;AACxEvB,YAAAA,KAAK,CAACgJ,WAAN,CAAkBF,eAAlB,EAAmC/F,IAAI,CAAC2F,SAAxC;AACH,WAJD,MAKK;AACD1I,YAAAA,KAAK,CAACgJ,WAAN,CAAkB,CAACjH,QAAQ,CAAC/B,KAAK,CAACmC,UAAN,CAAiBF,YAAjB,CAA8BpC,QAAQ,CAACqC,YAAvC,CAAD,EAAuD,EAAvD,CAAT,CAAlB,EAAwFlC,KAAK,CAACoG,UAA9F;AACH;;AACDpG,UAAAA,KAAK,CAACoG,UAAN,GAAmB,IAAnB;;AACA,cAAI,CAAC3F,IAAI,CAACe,eAAL,CAAqBC,QAA1B,EAAoC;AAChCzC,YAAAA,MAAM,CAACwB,CAAC,CAACD,MAAH,CAAN;;AACA,gBAAIE,IAAI,CAACgG,UAAL,IAAmBhG,IAAI,CAACoG,oBAA5B,EAAkD;AAC9CpG,cAAAA,IAAI,CAACwI,OAAL;AACH,aAFD,MAGK;AACDjJ,cAAAA,KAAK,CAACkJ,QAAN,CAAenG,IAAf;AACH;AACJ;AACJ;;AACD/C,QAAAA,KAAK,CAACI,SAAN,GAAkB,IAAlB;AACH,OA9BD;AA+BH,KApED;;AAqEA,SAAKsD,UAAL,GAAkB,UAAUyF,SAAV,EAAqBpI,SAArB,EAAgC;AAC9C,aAAO,GAAG6G,KAAH,CAASC,IAAT,CAAcsB,SAAS,CAACrB,gBAAV,CAA2B,IAA3B,CAAd,EAAgDsB,MAAhD,CAAuD,UAAUC,IAAV,EAAgB;AAC1E,YAAIA,IAAI,CAAClK,SAAL,CAAeuC,QAAf,CAAwBX,SAAxB,CAAJ,EAAwC;AACpCoI,UAAAA,SAAS,CAACG,UAAV,CAAqBD,IAAI,CAACE,SAA1B;AACH;AACJ,OAJM,CAAP;AAKH,KAND;;AAOA,SAAKxJ,MAAL,GAAcA,MAAd;;AACA,QAAI,KAAKA,MAAL,CAAYwI,WAAhB,EAA6B;AACzB;AACH;;AACD,SAAKxI,MAAL,CAAYyJ,EAAZ,CAAe7J,MAAM,CAAC8J,UAAtB,EAAkC,KAAKC,cAAvC,EAAuD,IAAvD;AACA,SAAK3J,MAAL,CAAYyJ,EAAZ,CAAe7J,MAAM,CAACgK,UAAtB,EAAkC,KAAKA,UAAvC,EAAmD,IAAnD;AACA,SAAKC,aAAL,GAAqB,KAAKC,WAAL,CAAiBC,IAAjB,CAAsB,IAAtB,CAArB;AACA,SAAK/J,MAAL,CAAYgK,gBAAZ,CAA6BpK,MAAM,CAACqK,SAApC,EAA+C,KAAKJ,aAApD;AACA,SAAK7J,MAAL,CAAYyJ,EAAZ,CAAe7J,MAAM,CAACsK,QAAtB,EAAgC,KAAKC,iBAArC,EAAwD,IAAxD;AACH;;AACDpK,EAAAA,KAAK,CAACqK,SAAN,CAAgBC,UAAhB,GAA6B,UAAUrH,IAAV,EAAgB3B,KAAhB,EAAuBiJ,MAAvB,EAA+BC,OAA/B,EAAwC5J,MAAxC,EAAgD6J,OAAhD,EAAyDC,QAAzD,EAAmE;AAC5F,QAAI/J,IAAI,GAAG,KAAKV,MAAhB;AACA,QAAIsC,OAAO,GAAG5B,IAAI,CAAC6B,YAAL,EAAd;AACA,QAAImI,WAAW,GAAGhK,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAApD;AACA,QAAI8H,kBAAJ;AACA,QAAIC,mBAAJ;AACA,QAAIC,KAAJ;AACA,QAAIC,KAAJ;AACA,QAAIC,YAAY,GAAGrK,IAAI,CAACsK,eAAL,GAAuB1G,aAAvB,CAAqCxE,QAAQ,CAACuB,KAA9C,CAAnB;AACA,QAAI4J,WAAW,GAAGvK,IAAI,CAACwK,cAAL,GAAsB5G,aAAtB,CAAoCxE,QAAQ,CAACuB,KAA7C,CAAlB;;AACA,QAAIiB,OAAJ,EAAa;AACTqI,MAAAA,kBAAkB,GAAGjK,IAAI,CAACyK,qBAAL,EAArB;AACAP,MAAAA,mBAAmB,GAAGlK,IAAI,CAAC0K,sBAAL,EAAtB;;AACA,UAAIV,WAAJ,EAAiB;AACbG,QAAAA,KAAK,GAAGnK,IAAI,CAAC2K,yBAAL,EAAR;AACAP,QAAAA,KAAK,GAAGpK,IAAI,CAAC4K,0BAAL,EAAR;AACH;AACJ;;AACD,QAAInH,KAAK,GAAGzD,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAlC,GAA8C,CAA9C,GAAkD,CAA9D;;AACA,SAAK,IAAI0I,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGxI,IAAI,CAACE,IAAL,CAAU1B,MAAhC,EAAwC+J,CAAC,GAAGC,GAA5C,EAAiDD,CAAC,EAAlD,EAAsD;AAClD,UAAIjJ,OAAJ,EAAa;AACT,YAAIiJ,CAAC,GAAGpH,KAAJ,KAAc,CAAlB,EAAqB;AACjB9C,UAAAA,KAAK,CAACoK,YAAN,CAAmBzI,IAAI,CAACE,IAAL,CAAUqI,CAAV,CAAnB,EAAiC5K,MAAjC;AACH,SAFD,MAGK,IAAI4K,CAAC,GAAGpH,KAAJ,KAAc,CAAlB,EAAqB;AACtBmG,UAAAA,MAAM,CAACmB,YAAP,CAAoBzI,IAAI,CAACE,IAAL,CAAUqI,CAAV,CAApB,EAAkCf,OAAlC;AACH,SAFI,MAGA;AACDD,UAAAA,OAAO,CAACkB,YAAR,CAAqBzI,IAAI,CAACE,IAAL,CAAUqI,CAAV,CAArB,EAAmCd,QAAnC;AACH;AACJ,OAVD,MAWK;AACDpJ,QAAAA,KAAK,CAACoK,YAAN,CAAmBzI,IAAI,CAACE,IAAL,CAAUqI,CAAV,CAAnB,EAAiC5K,MAAjC;AACH;AACJ;;AACD,QAAI+K,EAAE,GAAG,GAAG7D,KAAH,CAASC,IAAT,CAAczG,KAAK,CAACE,sBAAN,CAA6BzB,QAAQ,CAAC+I,GAAtC,CAAd,CAAT;AACA,QAAI8C,GAAJ;AACA,QAAIC,IAAJ;;AACA,QAAItJ,OAAJ,EAAa;AACTqJ,MAAAA,GAAG,GAAG,GAAG9D,KAAH,CAASC,IAAT,CAAcwC,MAAM,CAAC/I,sBAAP,CAA8BzB,QAAQ,CAAC+I,GAAvC,CAAd,CAAN;;AACA,UAAI6B,WAAJ,EAAiB;AACbkB,QAAAA,IAAI,GAAG,GAAG/D,KAAH,CAASC,IAAT,CAAcyC,OAAO,CAAChJ,sBAAR,CAA+BzB,QAAQ,CAAC+I,GAAxC,CAAd,CAAP;AACH;AACJ;;AACD,QAAI,KAAK7I,MAAL,CAAY8G,oBAAhB,EAAsC;AAClC,WAAK+E,kBAAL,CAAwBH,EAAxB,EAA4BC,GAA5B,EAAiCC,IAAjC;AACH,KAFD,MAGK;AACD,WAAKE,WAAL,CAAiBJ,EAAjB,EAAqBC,GAArB,EAA0BC,IAA1B;AACH;;AACD,QAAI,KAAK5L,MAAL,CAAY0G,UAAhB,EAA4B;AACxB,UAAIqF,OAAO,GAAG,UAAUR,CAAV,EAAaC,GAAb,EAAkB;AAC5B,YAAID,CAAC,GAAGS,MAAM,CAAChM,MAAP,CAAc0G,UAAtB,EAAkC;AAC9BhH,UAAAA,cAAc,CAACuL,WAAD,EAAcN,kBAAd,EAAkCE,KAAlC,EAAyCa,EAAzC,EAA6CC,GAA7C,EAAkDC,IAAlD,EAAwD,UAAUvK,KAAV,EAAiB6B,IAAjB,EAAuB;AACzF7B,YAAAA,KAAK,CAAC2C,WAAN,CAAkBd,IAAI,CAACqI,CAAD,CAAtB;AACH,WAFa,CAAd;AAGH,SAJD,MAKK;AACD7L,UAAAA,cAAc,CAACqL,YAAD,EAAeH,mBAAf,EAAoCE,KAApC,EAA2CY,EAA3C,EAA+CC,GAA/C,EAAoDC,IAApD,EAA0D,UAAUvK,KAAV,EAAiB6B,IAAjB,EAAuB;AAC3F7B,YAAAA,KAAK,CAAC2C,WAAN,CAAkBd,IAAI,CAACqI,CAAD,CAAtB;AACH,WAFa,CAAd;AAGH;AACJ,OAXD;;AAYA,UAAIS,MAAM,GAAG,IAAb;;AACA,WAAK,IAAIT,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3CQ,QAAAA,OAAO,CAACR,CAAD,EAAIC,GAAJ,CAAP;AACH;AACJ;AACJ,GApED;;AAqEAzL,EAAAA,KAAK,CAACqK,SAAN,CAAgB6B,sBAAhB,GAAyC,UAAUjJ,IAAV,EAAgB;AACrD,QAAItC,IAAI,GAAG,KAAKV,MAAhB;AACA,QAAIkM,SAAJ;AACA,QAAIC,SAAJ;AACA,QAAIC,QAAJ;AACA,QAAIC,QAAJ;AACA,QAAI/J,OAAO,GAAG,KAAKtC,MAAL,CAAYuC,YAAZ,EAAd;AACA,QAAImI,WAAW,GAAGhK,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAApD;AACA,QAAIyJ,MAAM,GAAG5L,IAAI,CAACsK,eAAL,GAAuB1G,aAAvB,CAAqCxE,QAAQ,CAACuB,KAA9C,CAAb;AACA,QAAIkL,MAAM,GAAG7L,IAAI,CAACwK,cAAL,GAAsB5G,aAAtB,CAAoCxE,QAAQ,CAACuB,KAA7C,CAAb;;AACA,QAAIiB,OAAJ,EAAa;AACT4J,MAAAA,SAAS,GAAGxL,IAAI,CAACyK,qBAAL,EAAZ;AACAgB,MAAAA,SAAS,GAAGzL,IAAI,CAAC0K,sBAAL,EAAZ;;AACA,UAAIV,WAAJ,EAAiB;AACb0B,QAAAA,QAAQ,GAAG1L,IAAI,CAAC2K,yBAAL,EAAX;AACAgB,QAAAA,QAAQ,GAAG3L,IAAI,CAAC4K,0BAAL,EAAX;AACH;AACJ;;AACD,QAAII,EAAE,GAAG,GAAG7D,KAAH,CAASC,IAAT,CAAcyE,MAAM,CAAChL,sBAAP,CAA8BzB,QAAQ,CAAC+I,GAAvC,CAAd,EAA2D2D,MAA3D,CAAkE,GAAG3E,KAAH,CAASC,IAAT,CAAcwE,MAAM,CAAC/K,sBAAP,CAA8BzB,QAAQ,CAAC+I,GAAvC,CAAd,CAAlE,CAAT;AACA,QAAI8C,GAAJ;AACA,QAAIC,IAAJ;;AACA,QAAItJ,OAAJ,EAAa;AACTqJ,MAAAA,GAAG,GAAG,GAAG9D,KAAH,CAASC,IAAT,CAAcoE,SAAS,CAAC3K,sBAAV,CAAiCzB,QAAQ,CAAC+I,GAA1C,CAAd,EACD2D,MADC,CACM,GAAG3E,KAAH,CAASC,IAAT,CAAcqE,SAAS,CAAC5K,sBAAV,CAAiCzB,QAAQ,CAAC+I,GAA1C,CAAd,CADN,CAAN;;AAEA,UAAI6B,WAAJ,EAAiB;AACbkB,QAAAA,IAAI,GAAG,GAAG/D,KAAH,CAASC,IAAT,CAAcsE,QAAQ,CAAC7K,sBAAT,CAAgCzB,QAAQ,CAAC+I,GAAzC,CAAd,EACF2D,MADE,CACK,GAAG3E,KAAH,CAASC,IAAT,CAAcuE,QAAQ,CAAC9K,sBAAT,CAAgCzB,QAAQ,CAAC+I,GAAzC,CAAd,CADL,CAAP;AAEH;AACJ;;AACD,QAAIxH,KAAK,GAAGX,IAAI,CAACK,aAAL,CAAmBjB,QAAQ,CAACuB,KAA5B,CAAZ;AACA,QAAIiJ,MAAM,GAAG5J,IAAI,CAACK,aAAL,CAAmBjB,QAAQ,CAACuB,KAA5B,CAAb;AACA,QAAIkJ,OAAO,GAAG7J,IAAI,CAACK,aAAL,CAAmBjB,QAAQ,CAACuB,KAA5B,CAAd;AACA,SAAKrB,MAAL,CAAYyM,cAAZ;AACA,QAAIC,UAAU,GAAG,KAAKC,gBAAL,CAAsB3J,IAAtB,CAAjB;;AACA,SAAK,IAAIuI,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3ClK,MAAAA,KAAK,CAAC2C,WAAN,CAAkB0H,EAAE,CAACH,CAAD,CAApB;;AACA,UAAIjJ,OAAJ,EAAa;AACTgI,QAAAA,MAAM,CAACtG,WAAP,CAAmB2H,GAAG,CAACJ,CAAD,CAAtB;;AACA,YAAIb,WAAJ,EAAiB;AACbH,UAAAA,OAAO,CAACvG,WAAR,CAAoB4H,IAAI,CAACL,CAAD,CAAxB;AACH;AACJ;AACJ;;AACD,SAAKlB,UAAL,CAAgBrH,IAAhB,EAAsB3B,KAAtB,EAA6BiJ,MAA7B,EAAqCC,OAArC,EAA8CmC,UAAU,CAAC/L,MAAzD,EAAiE+L,UAAU,CAAClC,OAA5E,EAAqFkC,UAAU,CAACjC,QAAhG;AACH,GA5CD;;AA6CA1K,EAAAA,KAAK,CAACqK,SAAN,CAAgBuC,gBAAhB,GAAmC,UAAU3J,IAAV,EAAgB;AAC/C,QAAItC,IAAI,GAAG,KAAKV,MAAhB;AACA,QAAI4M,GAAJ;AACA,QAAIhB,IAAJ;AACA,QAAIiB,SAAS,GAAG7K,QAAQ,CAACgB,IAAI,CAACrC,MAAL,CAAYsB,aAAZ,CAA0BC,YAA1B,CAAuCpC,QAAQ,CAACqC,YAAhD,CAAD,EAAgE,EAAhE,CAAxB;;AACA,QAAIa,IAAI,CAAC+B,SAAL,GAAiB/B,IAAI,CAAC2F,SAAtB,IAAmC3F,IAAI,CAAC+B,SAAL,KAAmB/B,IAAI,CAAC2F,SAA/D,EAA0E;AACtEkE,MAAAA,SAAS,GAAGA,SAAS,GAAG,CAAxB;AACH;;AACD,QAAInB,EAAE,GAAGhL,IAAI,CAACgC,aAAL,CAAmBmK,SAAnB,CAAT;;AACA,QAAInM,IAAI,CAAC6B,YAAL,EAAJ,EAAyB;AACrBqK,MAAAA,GAAG,GAAGlM,IAAI,CAACiC,oBAAL,CAA0BkK,SAA1B,CAAN;;AACA,UAAInM,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAtC,EAAiD;AAC7C+I,QAAAA,IAAI,GAAGlL,IAAI,CAACoC,wBAAL,CAA8B+J,SAA9B,CAAP;AACH;AACJ;;AACD,QAAI3J,IAAI,GAAG;AACPvC,MAAAA,MAAM,EAAE+K,EADD;AACKlB,MAAAA,OAAO,EAAEoC,GADd;AACmBnC,MAAAA,QAAQ,EAAEmB;AAD7B,KAAX;AAGA,WAAO1I,IAAP;AACH,GAnBD;;AAoBAnD,EAAAA,KAAK,CAACqK,SAAN,CAAgB0C,yBAAhB,GAA4C,UAAU9J,IAAV,EAAgB;AACxD,QAAItC,IAAI,GAAG,KAAKV,MAAhB;AACA,QAAIsK,MAAJ;AACA,QAAIC,OAAJ;AACA,QAAIjI,OAAO,GAAG,KAAKtC,MAAL,CAAYuC,YAAZ,EAAd;AACA,QAAIlB,KAAK,GAAGX,IAAI,CAACsK,eAAL,GAAuB1G,aAAvB,CAAqCxE,QAAQ,CAACuB,KAA9C,CAAZ;;AACA,QAAIiB,OAAJ,EAAa;AACTgI,MAAAA,MAAM,GAAG5J,IAAI,CAAC0K,sBAAL,EAAT;;AACA,UAAI1K,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAtC,EAAiD;AAC7C0H,QAAAA,OAAO,GAAG7J,IAAI,CAAC4K,0BAAL,EAAV;AACH;AACJ;;AACD,SAAKtL,MAAL,CAAYyM,cAAZ;AACA,QAAIC,UAAU,GAAG,KAAKC,gBAAL,CAAsB3J,IAAtB,CAAjB;AACA,SAAKqH,UAAL,CAAgBrH,IAAhB,EAAsB3B,KAAtB,EAA6BiJ,MAA7B,EAAqCC,OAArC,EAA8CmC,UAAU,CAAC/L,MAAzD,EAAiE+L,UAAU,CAAClC,OAA5E,EAAqFkC,UAAU,CAACjC,QAAhG;AACH,GAfD;;AAgBA1K,EAAAA,KAAK,CAACqK,SAAN,CAAgByB,kBAAhB,GAAqC,UAAUH,EAAV,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AAC1D,QAAImB,SAAS,GAAG,EAAhB;AACA,QAAI7H,eAAe,GAAG,KAAKlF,MAAL,CAAY2G,qBAAZ,EAAtB;AACA,QAAIvE,UAAU,GAAG,KAAKpC,MAAL,CAAYuC,YAAZ,KAA6B,KAAKvC,MAAL,CAAYgN,cAAZ,GAA6B,CAA7B,CAA7B,GAA+D,KAAKhN,MAAL,CAAYiN,OAAZ,GAAsB,CAAtB,CAAhF;AACA,QAAIC,UAAU,GAAGlL,QAAQ,CAACI,UAAU,CAACF,YAAX,CAAwBpC,QAAQ,CAACqC,YAAjC,CAAD,EAAiD,EAAjD,CAAzB;;AACA,SAAK,IAAIoJ,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,UAAIpH,KAAK,GAAGnC,QAAQ,CAAC0J,EAAE,CAACH,CAAD,CAAF,CAAMrJ,YAAN,CAAmBpC,QAAQ,CAACqC,YAA5B,CAAD,EAA4C,EAA5C,CAApB;AACA,WAAKnC,MAAL,CAAYkI,MAAZ,CAAmBtI,MAAM,CAACuN,0BAA1B,EAAsD;AAAEC,QAAAA,QAAQ,EAAEjJ,KAAZ;AAAmBkJ,QAAAA,GAAG,EAAE9B,CAAC,KAAKG,EAAE,CAAClK,MAAH,GAAY,CAA1C;AAA6C0L,QAAAA,UAAU,EAAEA;AAAzD,OAAtD;AACA/I,MAAAA,KAAK,GAAGA,KAAK,GAAG+I,UAAhB;AACAH,MAAAA,SAAS,CAACxB,CAAD,CAAT,GAAerG,eAAe,CAACf,KAAD,CAA9B;AACH;;AACD,QAAImJ,QAAQ,GAAG,KAAKtN,MAAL,CAAYiN,OAAZ,EAAf;AACA,QAAIM,OAAJ;AACA,QAAIC,UAAJ;;AACA,QAAI,KAAKxN,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5BgL,MAAAA,OAAO,GAAG,KAAKvN,MAAL,CAAYgN,cAAZ,EAAV;;AACA,UAAIpB,IAAJ,EAAU;AACN4B,QAAAA,UAAU,GAAG,KAAKxN,MAAL,CAAYyN,kBAAZ,EAAb;AACH;AACJ;;AACD,SAAK,IAAIlC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3CG,MAAAA,EAAE,CAACH,CAAD,CAAF,CAAMmC,YAAN,CAAmB5N,QAAQ,CAACqC,YAA5B,EAA0C,CAACoJ,CAAC,GAAG2B,UAAL,EAAiBS,QAAjB,EAA1C;AACAL,MAAAA,QAAQ,CAAC/B,CAAD,CAAR,GAAcG,EAAE,CAACH,CAAD,CAAhB;AACArG,MAAAA,eAAe,CAACqG,CAAD,CAAf,GAAqBwB,SAAS,CAACxB,CAAD,CAA9B;;AACA,UAAI,KAAKvL,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5BoJ,QAAAA,GAAG,CAACJ,CAAD,CAAH,CAAOmC,YAAP,CAAoB5N,QAAQ,CAACqC,YAA7B,EAA2C,CAACoJ,CAAC,GAAG2B,UAAL,EAAiBS,QAAjB,EAA3C;AACAJ,QAAAA,OAAO,CAAChC,CAAD,CAAP,GAAaI,GAAG,CAACJ,CAAD,CAAhB;;AACA,YAAIK,IAAJ,EAAU;AACNA,UAAAA,IAAI,CAACL,CAAD,CAAJ,CAAQmC,YAAR,CAAqB5N,QAAQ,CAACqC,YAA9B,EAA4C,CAACoJ,CAAC,GAAG2B,UAAL,EAAiBS,QAAjB,EAA5C;AACAH,UAAAA,UAAU,CAACjC,CAAD,CAAV,GAAgBK,IAAI,CAACL,CAAD,CAApB;AACH;AACJ;AACJ;AACJ,GAjCD;;AAkCAxL,EAAAA,KAAK,CAACqK,SAAN,CAAgB0B,WAAhB,GAA8B,UAAUJ,EAAV,EAAcC,GAAd,EAAmBC,IAAnB,EAAyB;AACnD,QAAIgC,MAAM,GAAG,EAAb;AACA,QAAIC,MAAM,GAAG,EAAb;AACA,QAAIC,KAAK,GAAG,EAAZ;AACA,QAAIf,SAAS,GAAG,EAAhB;AACA,QAAIgB,UAAU,GAAG,KAAK/N,MAAL,CAAYgO,aAAZ,EAAjB;AACA,QAAIC,UAAU,GAAG,KAAKjO,MAAL,CAAYkO,oBAAZ,EAAjB;AACA,QAAIC,aAAa,GAAG,KAAKnO,MAAL,CAAYoO,wBAAZ,EAApB;AACA,QAAIlJ,eAAe,GAAG,KAAKlF,MAAL,CAAY2G,qBAAZ,EAAtB;;AACA,SAAK,IAAI4E,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3C,UAAIpH,KAAK,GAAGnC,QAAQ,CAAC0J,EAAE,CAACH,CAAD,CAAF,CAAMrJ,YAAN,CAAmBpC,QAAQ,CAACqC,YAA5B,CAAD,EAA4C,EAA5C,CAApB;AACAyL,MAAAA,MAAM,CAACrC,CAAD,CAAN,GAAYwC,UAAU,CAAC5J,KAAD,CAAtB;AACA4I,MAAAA,SAAS,CAACxB,CAAD,CAAT,GAAerG,eAAe,CAACf,KAAD,CAA9B;;AACA,UAAI,KAAKnE,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5BsL,QAAAA,MAAM,CAACtC,CAAD,CAAN,GAAY0C,UAAU,CAAC9J,KAAD,CAAtB;;AACA,YAAIyH,IAAJ,EAAU;AACNkC,UAAAA,KAAK,CAACvC,CAAD,CAAL,GAAW4C,aAAa,CAAChK,KAAD,CAAxB;AACH;AACJ;AACJ;;AACD,QAAIjB,IAAI,GAAG,KAAKlD,MAAL,CAAYiN,OAAZ,EAAX;AACA,QAAIoB,QAAJ;AACA,QAAIC,WAAJ;;AACA,QAAI,KAAKtO,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5B8L,MAAAA,QAAQ,GAAG,KAAKrO,MAAL,CAAYgN,cAAZ,EAAX;;AACA,UAAIpB,IAAJ,EAAU;AACN0C,QAAAA,WAAW,GAAG,KAAKtO,MAAL,CAAYyN,kBAAZ,EAAd;AACH;AACJ;;AACD,SAAK,IAAIlC,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGE,EAAE,CAAClK,MAAzB,EAAiC+J,CAAC,GAAGC,GAArC,EAA0CD,CAAC,EAA3C,EAA+C;AAC3CrI,MAAAA,IAAI,CAACqI,CAAD,CAAJ,GAAUG,EAAE,CAACH,CAAD,CAAZ;AACAwC,MAAAA,UAAU,CAACxC,CAAD,CAAV,GAAgBqC,MAAM,CAACrC,CAAD,CAAtB;AACArG,MAAAA,eAAe,CAACqG,CAAD,CAAf,GAAqBwB,SAAS,CAACxB,CAAD,CAA9B;;AACA,UAAI,KAAKvL,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5B8L,QAAAA,QAAQ,CAAC9C,CAAD,CAAR,GAAcI,GAAG,CAACJ,CAAD,CAAjB;AACA0C,QAAAA,UAAU,CAAC1C,CAAD,CAAV,GAAgBsC,MAAM,CAACtC,CAAD,CAAtB;;AACA,YAAIK,IAAJ,EAAU;AACN0C,UAAAA,WAAW,CAAC/C,CAAD,CAAX,GAAiBK,IAAI,CAACL,CAAD,CAArB;AACA4C,UAAAA,aAAa,CAAC5C,CAAD,CAAb,GAAmBuC,KAAK,CAACvC,CAAD,CAAxB;AACH;AACJ;AACJ;;AACD5L,IAAAA,aAAa,CAAC,KAAKK,MAAN,EAAc+N,UAAd,EAA0BrC,EAA1B,CAAb;;AACA,QAAI,KAAK1L,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5B5C,MAAAA,aAAa,CAAC,KAAKK,MAAN,EAAciO,UAAd,EAA0BtC,GAA1B,CAAb;;AACA,UAAIC,IAAJ,EAAU;AACNjM,QAAAA,aAAa,CAAC,KAAKK,MAAN,EAAcmO,aAAd,EAA6BvC,IAA7B,CAAb;AACH;AACJ;AACJ,GAjDD;;AAkDA7L,EAAAA,KAAK,CAACqK,SAAN,CAAgBjB,QAAhB,GAA2B,UAAUnG,IAAV,EAAgB;AACvC,QAAIA,IAAI,CAAC2F,SAAL,KAAmB3F,IAAI,CAAC+B,SAAxB,IAAqCwJ,KAAK,CAACvL,IAAI,CAAC2F,SAAN,CAA9C,EAAgE;AAC5D;AACH;;AACD,QAAI,KAAK3I,MAAL,CAAYwO,SAAhB,EAA2B;AACvB,WAAKxO,MAAL,CAAYyO,iBAAZ;AACA,UAAIvL,IAAI,GAAG,GAAG2E,KAAH,CAASC,IAAT,CAAc,KAAK9H,MAAL,CAAYgL,eAAZ,GAA8B1G,aAA9B,CAA4CxE,QAAQ,CAACuB,KAArD,EAA4DqN,QAA1E,CAAX;AACA,UAAIX,UAAU,GAAG,KAAK/N,MAAL,CAAYgO,aAAZ,EAAjB;AACA9K,MAAAA,IAAI,CAACmG,MAAL,CAAY,UAAUR,GAAV,EAAe;AACvB,YAAIA,GAAG,CAACzJ,SAAJ,CAAcuC,QAAd,CAAuB,aAAvB,CAAJ,EAA2C;AACvCkH,UAAAA,GAAG,CAAC5J,MAAJ;AACH;AACJ,OAJD;;AAKA,WAAK,IAAIsM,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGuC,UAAU,CAACvM,MAAjC,EAAyC+J,CAAC,GAAGC,GAA7C,EAAkDD,CAAC,EAAnD,EAAuD;AACnD,YAAI,CAACwC,UAAU,CAACxC,CAAD,CAAf,EAAoB;AAChB;AACH;;AACD,YAAIwC,UAAU,CAACxC,CAAD,CAAV,CAAcoD,WAAlB,EAA+B;AAC3B,eAAK3O,MAAL,CAAYgO,aAAZ,GAA4BY,MAA5B,CAAmCrD,CAAnC,EAAsC,CAAtC;AACAA,UAAAA,CAAC;AACJ;AACJ;AACJ;;AACD,QAAIvI,IAAI,CAACrC,MAAL,CAAYvB,SAAZ,CAAsBuC,QAAtB,CAA+B,eAA/B,CAAJ,EAAqD;AACjDqB,MAAAA,IAAI,CAACrC,MAAL,GAAcqC,IAAI,CAACrC,MAAL,CAAYsB,aAA1B;AACH;;AACD,QAAI,KAAKjC,MAAL,CAAY0G,UAAhB,EAA4B;AACxB,WAAKuF,sBAAL,CAA4BjJ,IAA5B;AACH,KAFD,MAGK;AACD,WAAK8J,yBAAL,CAA+B9J,IAA/B;AACH;;AACD,QAAI,KAAK5C,gBAAL,CAAsBoB,MAAtB,GAA+B,CAAnC,EAAsC;AAClC,WAAKxB,MAAL,CAAY6O,UAAZ,CAAuB,KAAKzO,gBAA5B;AACA,UAAI0O,OAAO,GAAG,EAAd;;AACA,UAAI,KAAK9O,MAAL,CAAY+O,cAAZ,CAA2BvI,OAA3B,CAAmChF,MAAnC,IAA6C,KAAKxB,MAAL,CAAYgP,YAAZ,CAAyBxI,OAAzB,CAAiChF,MAAlF,EAA0F;AACtF,aAAK,IAAI+J,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGxI,IAAI,CAACE,IAAL,CAAU1B,MAAhC,EAAwC+J,CAAC,GAAGC,GAA5C,EAAiDD,CAAC,EAAlD,EAAsD;AAClDuD,UAAAA,OAAO,CAACG,IAAR,CAAajN,QAAQ,CAACgB,IAAI,CAACE,IAAL,CAAUqI,CAAV,EAAarJ,YAAb,CAA0BpC,QAAQ,CAACqC,YAAnC,CAAD,EAAmD,EAAnD,CAArB;AACH;;AACD,aAAK/B,gBAAL,GAAwB0O,OAAxB;AACH;;AACD,WAAK1O,gBAAL,GAAwB,EAAxB;AACH;AACJ,GA3CD;;AA4CAL,EAAAA,KAAK,CAACqK,SAAN,CAAgBlF,eAAhB,GAAkC,YAAY;AAC1C,QAAI6D,eAAe,GAAG,KAAK/I,MAAL,CAAYiE,qBAAZ,EAAtB;AACA,QAAIiL,YAAY,GAAG,EAAnB;AACA,QAAIC,OAAO,GAAGnN,QAAQ,CAAC,KAAKI,UAAL,CAAgBF,YAAhB,CAA6BpC,QAAQ,CAACqC,YAAtC,CAAD,EAAsD,EAAtD,CAAtB;;AACA,SAAK,IAAIoJ,CAAC,GAAG,CAAR,EAAW6D,CAAC,GAAGrG,eAAe,CAACvH,MAApC,EAA4C+J,CAAC,GAAG6D,CAAhD,EAAmD7D,CAAC,EAApD,EAAwD;AACpD,UAAI8D,QAAQ,GAAG,iBAAf;AACAH,MAAAA,YAAY,CAAC3D,CAAD,CAAZ,GAAkB,KAAKvL,MAAL,CAAYqP,QAAZ,EAAsBtG,eAAe,CAACwC,CAAD,CAArC,CAAlB;AACH;;AACD,QAAI,CAAC,KAAKvL,MAAL,CAAYyB,eAAZ,CAA4BC,QAA7B,IAAyCqH,eAAe,CAACvH,MAAhB,KAA2B,CAAxE,EAA2E;AACvE0N,MAAAA,YAAY,CAAC,CAAD,CAAZ,GAAkB,KAAKlP,MAAL,CAAYkF,eAAZ,CAA4BiK,OAA5B,CAAlB;AACH;;AACD,WAAOD,YAAP;AACH,GAZD;;AAaAnP,EAAAA,KAAK,CAACqK,SAAN,CAAgBkF,UAAhB,GAA6B,UAAUC,aAAV,EAAyBC,KAAzB,EAAgC;AACzD,QAAIvP,KAAK,GAAG,IAAZ;;AACA,SAAKD,MAAL,CAAYyP,aAAZ,GAA4BC,WAA5B,CAAwCH,aAAxC,EAAuD,KAAKvP,MAAL,CAAY2P,uBAAZ,GAAsC,CAAtC,CAAvD,EAAiG,EAAjG,EAAqGH,KAArG,EACKI,IADL,CACU,YAAY;AAClB3P,MAAAA,KAAK,CAACD,MAAN,CAAakI,MAAb,CAAoBtI,MAAM,CAACiQ,YAA3B,EAAyC;AACrChO,QAAAA,IAAI,EAAEjC,MAAM,CAACkQ,WADwB;AACXC,QAAAA,WAAW,EAAE;AADF,OAAzC;AAGH,KALD,EAKGC,KALH,CAKS,UAAUvP,CAAV,EAAa;AAClB,UAAIwP,KAAK,GAAG,OAAZ;AACA,UAAIC,OAAO,GAAG,SAAd;;AACA,UAAI,CAACnR,iBAAiB,CAAC0B,CAAC,CAACwP,KAAD,CAAF,CAAlB,IAAgC,CAAClR,iBAAiB,CAAC0B,CAAC,CAACwP,KAAD,CAAD,CAASC,OAAT,CAAD,CAAtD,EAA2E;AACvEzP,QAAAA,CAAC,CAACwP,KAAD,CAAD,GAAWxP,CAAC,CAACwP,KAAD,CAAD,CAASC,OAAT,CAAX;AACH;;AACDjQ,MAAAA,KAAK,CAACD,MAAN,CAAayD,OAAb,CAAqB7D,MAAM,CAACuQ,aAA5B,EAA2C1P,CAA3C;AACH,KAZD;AAaH,GAfD;;AAgBAV,EAAAA,KAAK,CAACqK,SAAN,CAAgBnB,WAAhB,GAA8B,UAAUmH,WAAV,EAAuBC,OAAvB,EAAgC;AAC1D,QAAItH,eAAe,GAAG,KAAK/I,MAAL,CAAYiE,qBAAZ,EAAtB;AACA,QAAIqM,eAAe,GAAG,EAAtB;AACA,QAAIC,cAAc,GAAG,EAArB;AACA,QAAIrL,eAAe,GAAG,KAAKlF,MAAL,CAAY+G,YAAZ,CAAyBzD,IAAzB,CAA8B0D,WAA9B,CAA0CC,UAA1C,CAAqDC,IAA3E;AACA,QAAIsJ,IAAI,GAAG,KAAKxQ,MAAL,CAAYyQ,WAAZ,GACN,KAAKzQ,MAAL,CAAY0Q,YAAZ,CAAyBC,WAAzB,GAAuC,KAAK3Q,MAAL,CAAY0Q,YAAZ,CAAyBE,QAAjE,GAA6E,KAAK5Q,MAAL,CAAY0Q,YAAZ,CAAyBE,QAD/F,GAC0G,CADrH;AAEA,QAAIC,OAAO,GAAGR,OAAO,GAAGG,IAAxB;AACA,QAAIM,SAAS,GAAGV,WAAW,CAAC,CAAD,CAAX,GAAiBI,IAAjC;;AACA,SAAK,IAAIjF,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG4E,WAAW,CAAC5O,MAAlC,EAA0C+J,CAAC,GAAGC,GAA9C,EAAmDD,CAAC,EAApD,EAAwD;AACpDgF,MAAAA,cAAc,CAAChF,CAAD,CAAd,GAAoBrG,eAAe,CAACkL,WAAW,CAAC7E,CAAD,CAAX,GAAiBiF,IAAlB,CAAnC;AACH;;AACD,SAAK,IAAIjF,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGzC,eAAe,CAACvH,MAAtC,EAA8C+J,CAAC,GAAGC,GAAlD,EAAuDD,CAAC,EAAxD,EAA4D;AACxD+E,MAAAA,eAAe,CAAC/E,CAAD,CAAf,GAAqBrG,eAAe,CAAC6D,eAAe,CAACwC,CAAD,CAAf,GAAqBiF,IAAtB,CAApC;AACH;;AACD,SAAK,IAAIjF,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG+E,cAAc,CAAC/O,MAArC,EAA6C+J,CAAC,GAAGC,GAAjD,EAAsDD,CAAC,EAAvD,EAA2D;AACvD,UAAIA,CAAC,KAAK,CAAV,EAAa;AACT,aAAK,IAAIwF,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG9L,eAAe,CAAC1D,MAAvC,EAA+CuP,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,cAAIE,IAAI,CAACC,SAAL,CAAe,KAAKlR,MAAL,CAAY+G,YAAZ,CAAyBzD,IAAzB,CAA8B0D,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0D6J,CAA1D,CAAf,MACAE,IAAI,CAACC,SAAL,CAAeX,cAAc,CAAChF,CAAD,CAA7B,CADJ,EACuC;AACnCuF,YAAAA,SAAS,GAAGC,CAAZ;AACA;AACH;AACJ;;AACD,aAAK,IAAIA,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG9L,eAAe,CAAC1D,MAAvC,EAA+CuP,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,cAAIE,IAAI,CAACC,SAAL,CAAe,KAAKlR,MAAL,CAAY+G,YAAZ,CAAyBzD,IAAzB,CAA8B0D,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0D6J,CAA1D,CAAf,MAAiFE,IAAI,CAACC,SAAL,CAAeX,cAAc,CAAChF,CAAC,GAAG,CAAL,CAA7B,CAArF,EAA4H;AACxH,gBAAIuF,SAAS,GAAGC,CAAhB,EAAmB;AACfF,cAAAA,OAAO,GAAGE,CAAC,GAAG,CAAd;AACH;;AACD;AACH;AACJ;AACJ;;AACD,WAAKI,UAAL,CAAgBL,SAAS,GAAGN,IAA5B,EAAkCK,OAAO,GAAGL,IAA5C;AACH;;AACD,QAAI,KAAKnQ,SAAT,EAAoB;AAChB,WAAKL,MAAL,CAAYkI,MAAZ,CAAmBtI,MAAM,CAACiQ,YAA1B,EAAwC;AACpChO,QAAAA,IAAI,EAAEjC,MAAM,CAACkQ,WADuB;AACVC,QAAAA,WAAW,EAAE;AADH,OAAxC;AAGH;;AACD,SAAK,IAAIxE,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAG8E,eAAe,CAAC9O,MAAtC,EAA8C+J,CAAC,GAAGC,GAAlD,EAAuDD,CAAC,EAAxD,EAA4D;AACxD,WAAK,IAAIwF,CAAC,GAAG,CAAR,EAAWC,IAAI,GAAG9L,eAAe,CAAC1D,MAAvC,EAA+CuP,CAAC,GAAGC,IAAnD,EAAyDD,CAAC,EAA1D,EAA8D;AAC1D,YAAIE,IAAI,CAACC,SAAL,CAAe,KAAKlR,MAAL,CAAY+G,YAAZ,CAAyBzD,IAAzB,CAA8B0D,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0D6J,CAA1D,CAAf,MAAiFE,IAAI,CAACC,SAAL,CAAeZ,eAAe,CAAC/E,CAAD,CAA9B,CAArF,EAAyH;AACrHxC,UAAAA,eAAe,CAACwC,CAAD,CAAf,GAAqBwF,CAAC,GAAGP,IAAzB;AACA;AACH;AACJ;AACJ;;AACD,SAAKpQ,gBAAL,GAAwB2I,eAAxB;AACH,GAjDD;;AAkDAhJ,EAAAA,KAAK,CAACqK,SAAN,CAAgBhE,SAAhB,GAA4B,YAAY;AACpCgL,IAAAA,MAAM,CAACC,aAAP,CAAqB,KAAKC,KAA1B;AACH,GAFD;;AAGAvR,EAAAA,KAAK,CAACqK,SAAN,CAAgBT,cAAhB,GAAiC,YAAY;AACzC,QAAIjJ,IAAI,GAAG,KAAKV,MAAhB;AACA,SAAKY,SAAL,GAAiB,IAAI9B,SAAJ,CAAc4B,IAAI,CAACQ,OAAnB,EAA4B;AACzCmF,MAAAA,UAAU,EAAE,4CAD6B;AAEzCkL,MAAAA,QAAQ,EAAE,CAF+B;AAGzC/Q,MAAAA,MAAM,EAAE,KAAKA,MAH4B;AAIzCgE,MAAAA,SAAS,EAAE,KAAKA,SAJyB;AAKzCiB,MAAAA,IAAI,EAAE,KAAKA,IAL8B;AAMzCwC,MAAAA,QAAQ,EAAE,KAAKA,QAN0B;AAOzC3H,MAAAA,gBAAgB,EAAE,KAAKA;AAPkB,KAA5B,CAAjB;AASH,GAXD;;AAYAP,EAAAA,KAAK,CAACqK,SAAN,CAAgB3D,mBAAhB,GAAsC,UAAUhG,CAAV,EAAa;AAC/C,QAAIR,KAAK,GAAG,IAAZ;;AACA,QAAIuR,CAAC,GAAGjS,WAAW,CAACkB,CAAD,CAAX,CAAe+Q,CAAvB;AACA,QAAIC,OAAO,GAAG,KAAK/L,UAAL,CAAgBF,UAAhB,GAA6BkM,qBAA7B,EAAd;AACA,QAAIC,SAAS,GAAG,KAAKjM,UAAL,CAAgBkM,YAAhB,KAAiC,EAAjD;AACA,QAAIC,UAAU,GAAG,KAAKnM,UAAL,CAAgBF,UAAhB,GAA6BsM,iBAA9C;;AACA,QAAIL,OAAO,CAACM,GAAR,IAAeP,CAAnB,EAAsB;AAClB,UAAIQ,aAAa,GAAG,CAAE,KAAKtM,UAAL,CAAgBkM,YAAhB,EAAtB;AACA,WAAKzR,gBAAL,GAAwB,KAAxB;AACA,WAAKmR,KAAL,GAAaF,MAAM,CAACa,WAAP,CAAmB,YAAY;AAAEhS,QAAAA,KAAK,CAACiS,aAAN,CAAoBL,UAApB,EAAgCG,aAAhC;AAAiD,OAAlF,EAAoF,GAApF,CAAb;AACH,KAJD,MAKK,IAAIP,OAAO,CAACM,GAAR,GAAc,KAAKrM,UAAL,CAAgBF,UAAhB,GAA6B2M,YAA3C,GAA0DR,SAA1D,GAAsE,EAAtE,IAA4EH,CAAhF,EAAmF;AACpF,UAAIY,aAAa,GAAI,KAAK1M,UAAL,CAAgBkM,YAAhB,EAArB;AACA,WAAKzR,gBAAL,GAAwB,KAAxB;AACA,WAAKmR,KAAL,GAAaF,MAAM,CAACa,WAAP,CAAmB,YAAY;AAAEhS,QAAAA,KAAK,CAACiS,aAAN,CAAoBL,UAApB,EAAgCO,aAAhC;AAAiD,OAAlF,EAAoF,GAApF,CAAb;AACH;AACJ,GAhBD;;AAiBArS,EAAAA,KAAK,CAACqK,SAAN,CAAgB8H,aAAhB,GAAgC,UAAUL,UAAV,EAAsBQ,WAAtB,EAAmC;AAC/DR,IAAAA,UAAU,CAACS,SAAX,GAAuBT,UAAU,CAACS,SAAX,GAAuBD,WAA9C;AACH,GAFD;;AAGAtS,EAAAA,KAAK,CAACqK,SAAN,CAAgBxD,YAAhB,GAA+B,UAAUnG,CAAV,EAAa2B,UAAb,EAAyBgH,SAAzB,EAAoC;AAC/D,QAAIhG,YAAY,GAAG,KAAKpD,MAAL,CAAYkB,OAAZ,CAAoBoD,aAApB,CAAkC,oBAAlC,CAAnB;AACA,QAAIpD,OAAO,GAAG/B,cAAc,CAACsB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA5B;;AACA,QAAItB,YAAY,CAAC6B,OAAD,EAAU,QAAV,CAAZ,KACC7B,YAAY,CAAC+D,YAAY,CAACnB,aAAd,EAA6B,QAA7B,CAAZ,CAAmD2D,EAAnD,KAA0DvG,YAAY,CAAC6B,OAAD,EAAU,QAAV,CAAZ,CAAgC0E,EAA1F,IAAgG,KAAKrF,YADtG,CAAJ,EACyH;AACrH,UAAIgS,aAAa,GAAGrR,OAAO,GACvBA,OADuB,GACb,KAAKkB,UADnB;AAEA,WAAKoQ,SAAL,CAAeD,aAAf,EAA8B9R,CAAC,CAACqF,KAAhC,EAAuC1D,UAAvC,EAAmDgH,SAAnD;AACH;AACJ,GATD;;AAUArJ,EAAAA,KAAK,CAACqK,SAAN,CAAgBoI,SAAhB,GAA4B,UAAUtR,OAAV,EAAmB4E,KAAnB,EAA0B1D,UAA1B,EAAsCgH,SAAtC,EAAiD;AACzE,QAAIqJ,IAAI,GAAG,KAAKzS,MAAL,CAAYkB,OAAvB;;AACA,QAAI,KAAKX,YAAT,EAAuB;AACnBkS,MAAAA,IAAI,GAAG,KAAK/M,UAAL,CAAgBxE,OAAvB;AACH;;AACD,QAAIkC,YAAY,GAAG,KAAKpD,MAAL,CAAYkB,OAAZ,CAAoBoD,aAApB,CAAkC,oBAAlC,CAAnB;AACA,SAAKoO,oBAAL,CAA0BxR,OAA1B;AACA,SAAKyR,mBAAL,CAAyBzR,OAAzB;;AACA,QAAI7B,YAAY,CAAC6B,OAAD,EAAU,QAAV,CAAZ,IAAoC,CAAC,KAAKlB,MAAL,CAAYyB,eAAZ,CAA4BC,QAA7B,IAAyCR,OAAO,CAAC9B,SAAR,CAAkBuC,QAAlB,CAA2B7B,QAAQ,CAAC+I,GAApC,CAAzC,IACpCxJ,YAAY,CAAC+D,YAAY,CAACnB,aAAd,EAA6B,QAA7B,CAAZ,CAAmD2D,EAAnD,KAA0DvG,YAAY,CAAC6B,OAAD,EAAU,QAAV,CAAZ,CAAgC0E,EAD1F,IACiG,KAAKrF,YAD1G,EACwH;AACpHvB,MAAAA,WAAW,CAACyT,IAAI,CAAC1K,gBAAL,CAAsB,gDAAtB,CAAD,EAA0E,CAAC,cAAD,CAA1E,CAAX;AACA,UAAIH,UAAU,GAAG,EAAjB;AACA,UAAIgL,cAAc,GAAG5Q,QAAQ,CAACoH,SAAS,CAAClH,YAAV,CAAuBpC,QAAQ,CAACqC,YAAhC,CAAD,EAAgD,EAAhD,CAA7B;;AACA,UAAIiH,SAAS,IAAIwJ,cAAc,KAAK,CAApC,EAAuC;AACnC,YAAIC,GAAG,GAAG,KAAK7S,MAAL,CAAYe,aAAZ,CAA0B,KAA1B,EAAiC;AAAEC,UAAAA,SAAS,EAAE;AAAb,SAAjC,CAAV;AACA,YAAI8R,aAAa,GAAG,KAAKpN,UAAL,CAAgBqN,gBAAhB,EAApB;AACAD,QAAAA,aAAa,CAAC1T,SAAd,CAAwBmF,GAAxB,CAA4B,iBAA5B;AACAsO,QAAAA,GAAG,CAAClO,KAAJ,CAAU2C,KAAV,GAAkBmL,IAAI,CAACtR,WAAL,GAAmB,KAAKoG,cAAL,EAAnB,GAA2C,IAA7D;;AACA,YAAI,CAACuL,aAAa,CAACvR,sBAAd,CAAqC,uBAArC,EAA8DC,MAAnE,EAA2E;AACvEsR,UAAAA,aAAa,CAAC9O,WAAd,CAA0B6O,GAA1B;AACH;AACJ,OARD,MASK,IAAI,KAAK7S,MAAL,CAAYyB,eAAZ,CAA4BC,QAA5B,IAAwC0H,SAA5C,EAAuD;AACxDlI,QAAAA,OAAO,GAAG,KAAKwE,UAAL,CAAgBhD,aAAhB,CAA8BkQ,cAAc,GAAG,CAA/C,CAAV;AACAhL,QAAAA,UAAU,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc5G,OAAO,CAAC6G,gBAAR,CAAyB,gDAAzB,CAAd,CAAb;AACH,OAHI,MAIA,IAAIqB,SAAS,IAAIpH,QAAQ,CAACI,UAAU,CAACF,YAAX,CAAwBpC,QAAQ,CAACqC,YAAjC,CAAD,EAAiD,EAAjD,CAAR,GAA+DyQ,cAAhF,EAAgG;AACjG1R,QAAAA,OAAO,GAAG,KAAKlB,MAAL,CAAY0C,aAAZ,CAA0BkQ,cAAc,GAAG,CAA3C,CAAV;AACAhL,QAAAA,UAAU,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc5G,OAAO,CAAC6G,gBAAR,CAAyB,gDAAzB,CAAd,CAAb;AACH,OAHI,MAIA;AACDH,QAAAA,UAAU,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc5G,OAAO,CAAC6G,gBAAR,CAAyB,gDAAzB,CAAd,CAAb;AACH;;AACD,UAAIzF,OAAO,GAAG,KAAKtC,MAAL,CAAYuC,YAAZ,EAAd;;AACA,UAAI6G,SAAS,IAAIwJ,cAAc,KAAK,CAAhC,IAAqCtQ,OAAzC,EAAkD;AAC9C,YAAIE,QAAQ,GAAGR,QAAQ,CAACd,OAAO,CAACgB,YAAR,CAAqBpC,QAAQ,CAACqC,YAA9B,CAAD,EAA8C,EAA9C,CAAvB;AACA,YAAIwF,QAAQ,GAAG,gDAAf;AACAC,QAAAA,UAAU,GAAG,KAAKI,gBAAL,CAAsBxF,QAAtB,EAAgCmF,QAAhC,CAAb;AACH;;AACD,UAAIC,UAAU,CAACpG,MAAX,GAAoB,CAAxB,EAA2B;AACvBhC,QAAAA,sBAAsB,CAACoI,UAAD,EAAa,IAAb,EAAmB,cAAnB,CAAtB;AACH;AACJ;AACJ,GA3CD;;AA4CA7H,EAAAA,KAAK,CAACqK,SAAN,CAAgBpC,gBAAhB,GAAmC,UAAUxF,QAAV,EAAoBmF,QAApB,EAA8B;AAC7D,QAAIqL,OAAO,GAAG,EAAd;AACAA,IAAAA,OAAO,GAAG,GAAGnL,KAAH,CAASC,IAAT,CAAc,KAAKpC,UAAL,CAAgBhD,aAAhB,CAA8BF,QAA9B,EAAwCuF,gBAAxC,CAAyDJ,QAAzD,CAAd,EACN6E,MADM,CACC,GAAG3E,KAAH,CAASC,IAAT,CAAc,KAAKpC,UAAL,CAAgB/C,oBAAhB,CAAqCH,QAArC,EAA+CuF,gBAA/C,CAAgEJ,QAAhE,CAAd,CADD,CAAV;;AAEA,QAAI,KAAKjC,UAAL,CAAgB9C,aAAhB,OAAoC9C,QAAQ,CAAC+C,SAAjD,EAA4D;AACxDmQ,MAAAA,OAAO,GAAGA,OAAO,CAACxG,MAAR,CAAe,GAAG3E,KAAH,CAASC,IAAT,CAAc,KAAKpC,UAAL,CAAgB5C,wBAAhB,CAAyCN,QAAzC,EAAmDuF,gBAAnD,CAAoEJ,QAApE,CAAd,CAAf,CAAV;AACH;;AACD,WAAOqL,OAAP;AACH,GARD;;AASAjT,EAAAA,KAAK,CAACqK,SAAN,CAAgB7C,cAAhB,GAAiC,YAAY;AACzC,QAAIsK,UAAU,GAAG,KAAK7R,MAAL,CAAYwF,UAAZ,GAAyBsM,iBAA1C;AACA,WAAOD,UAAU,CAACoB,WAAX,GAAyBpB,UAAU,CAAC1Q,WAApC,GAAkDtB,MAAM,CAACqT,iBAAP,EAAlD,GAA+E,CAAtF;AACH,GAHD;;AAIAnT,EAAAA,KAAK,CAACqK,SAAN,CAAgBsI,oBAAhB,GAAuC,UAAUxR,OAAV,EAAmB;AACtD,QAAI,KAAKwE,UAAL,CAAgBxE,OAAhB,CAAwBK,sBAAxB,CAA+C,uBAA/C,EAAwEC,MAAxE,GAAiF,CAAjF,IAAsFN,OAAtF,IACAA,OAAO,CAACsB,QAAR,KAAqB,CADzB,EAC4B;AACxBvD,MAAAA,MAAM,CAAC,KAAKyG,UAAL,CAAgBxE,OAAhB,CAAwBK,sBAAxB,CAA+C,uBAA/C,EAAwE,CAAxE,CAAD,CAAN;AACH;AACJ,GALD;;AAMAxB,EAAAA,KAAK,CAACqK,SAAN,CAAgBuI,mBAAhB,GAAsC,UAAUzR,OAAV,EAAmB;AACrD,QAAI2F,cAAJ;;AACA,QAAI,KAAK7G,MAAL,CAAY8G,oBAAhB,EAAsC;AAClCD,MAAAA,cAAc,GAAG3F,OAAO,IAAIc,QAAQ,CAACd,OAAO,CAACgB,YAAR,CAAqBpC,QAAQ,CAACqC,YAA9B,CAAD,EAA8C,EAA9C,CAAR,KACxB,KAAKnC,MAAL,CAAY+G,YAAZ,CAAyBzD,IAAzB,CAA8B0D,WAA9B,CAA0CC,UAA1C,CAAqDC,IAArD,CAA0D1F,MAA1D,GAAmE,CADvE;AAEH,KAHD,MAIK;AACDqF,MAAAA,cAAc,GAAG3F,OAAO,IACpB,KAAKlB,MAAL,CAAY0C,aAAZ,CAA0B,KAAK1C,MAAL,CAAY2G,qBAAZ,GAAoCnF,MAApC,GAA6C,CAAvE,EAA0EU,YAA1E,CAAuF,UAAvF,MACIhB,OAAO,CAACgB,YAAR,CAAqB,UAArB,CAFR;AAGH;;AACD,QAAI,KAAKlC,MAAL,CAAYkB,OAAZ,CAAoBK,sBAApB,CAA2C,sBAA3C,EAAmEC,MAAnE,GAA4E,CAA5E,IAAiFN,OAAjF,IAA4F2F,cAAhG,EAAgH;AAC5G5H,MAAAA,MAAM,CAAC,KAAKe,MAAL,CAAYkB,OAAZ,CAAoBK,sBAApB,CAA2C,sBAA3C,EAAmE,CAAnE,CAAD,CAAN;AACH;AACJ,GAdD;;AAeAxB,EAAAA,KAAK,CAACqK,SAAN,CAAgB3C,YAAhB,GAA+B,UAAUvG,OAAV,EAAmB;AAC9C,SAAKwR,oBAAL,CAA0BxR,OAA1B;;AACA,QAAI,CAAC,KAAKlB,MAAL,CAAYyB,eAAZ,CAA4BC,QAAjC,EAA2C;AACvC,WAAKiR,mBAAL,CAAyBzR,OAAzB;AACH;;AACDA,IAAAA,OAAO,GAAG,CAAC,KAAKwE,UAAL,CAAgBnD,YAAhB,KAAiC,KAAKmD,UAAL,CAAgBsH,cAAhB,EAAjC,GAAoE,KAAKtH,UAAL,CAAgBuH,OAAhB,EAArE,EAAgG5D,MAAhG,CAAuG,UAAUR,GAAV,EAAe;AAC5H,aAAOA,GAAG,CAACvE,aAAJ,CAAkB,iBAAlB,CAAP;AACH,KAFS,EAEP,CAFO,CAAV;;AAGA,QAAIpD,OAAJ,EAAa;AACT,UAAI0G,UAAU,GAAG,GAAGC,KAAH,CAASC,IAAT,CAAc5G,OAAO,CAACK,sBAAR,CAA+B,cAA/B,CAAd,CAAjB;;AACA,UAAI,KAAKvB,MAAL,CAAYuC,YAAZ,EAAJ,EAAgC;AAC5B,YAAIC,QAAQ,GAAGR,QAAQ,CAACd,OAAO,CAACgB,YAAR,CAAqBpC,QAAQ,CAACqC,YAA9B,CAAD,EAA8C,EAA9C,CAAvB;AACA,YAAIwF,QAAQ,GAAG,eAAf;AACAC,QAAAA,UAAU,GAAG,KAAKI,gBAAL,CAAsBxF,QAAtB,EAAgCmF,QAAhC,CAAb;AACH;;AACDnI,MAAAA,sBAAsB,CAACoI,UAAD,EAAa,KAAb,EAAoB,cAApB,CAAtB;AACH;AACJ,GAjBD;;AAkBA7H,EAAAA,KAAK,CAACqK,SAAN,CAAgBvE,sBAAhB,GAAyC,UAAU3E,OAAV,EAAmB4E,KAAnB,EAA0B;AAC/D,QAAIqN,QAAQ,GAAG5T,WAAW,CAACuG,KAAD,CAA1B;AACA5E,IAAAA,OAAO,CAACyD,KAAR,CAAcyO,OAAd,GAAwB,MAAxB;AACA,QAAIzS,MAAM,GAAGW,QAAQ,CAAC+R,gBAAT,CAA0BF,QAAQ,CAACG,CAAnC,EAAsCH,QAAQ,CAAC3B,CAA/C,CAAb;AACAtQ,IAAAA,OAAO,CAACyD,KAAR,CAAcyO,OAAd,GAAwB,EAAxB;AACA,WAAOzS,MAAP;AACH,GAND;;AAOAZ,EAAAA,KAAK,CAACqK,SAAN,CAAgBN,WAAhB,GAA8B,YAAY;AACtC,QAAI,KAAK1J,gBAAL,CAAsBoB,MAAtB,GAA+B,CAAnC,EAAsC;AAClC,WAAKxB,MAAL,CAAY6O,UAAZ,CAAuB,KAAKzO,gBAA5B;AACA,WAAKA,gBAAL,GAAwB,EAAxB;AACH;AACJ,GALD;;AAMAL,EAAAA,KAAK,CAACqK,SAAN,CAAgBmJ,YAAhB,GAA+B,UAAUnK,SAAV,EAAqB;AAChD,WAAOA,SAAS,GAAGpH,QAAQ,CAACoH,SAAS,CAAClH,YAAV,CAAuBpC,QAAQ,CAACqC,YAAhC,CAAD,EAAgD,EAAhD,CAAX,GAAiE,CAAjF;AACH,GAFD;;AAGApC,EAAAA,KAAK,CAACqK,SAAN,CAAgBoJ,aAAhB,GAAgC,UAAU/S,CAAV,EAAa;AACzC,QAAI2I,SAAS,GAAGjK,cAAc,CAACsB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA9B;AACA,QAAI8S,UAAU,GAAGhT,CAAC,CAACiT,cAAF,CAAiBzR,aAAjB,CAA+BqD,aAA/B,CAA6C,CAA7C,CAAjB;AACA,QAAIqO,YAAY,GAAGvK,SAAS,GAAGA,SAAS,CAAC5G,QAAb,GAAwBiR,UAAU,CAACvO,eAAX,CAA2B1D,MAA3B,GAAoC,CAAxF;AACA,SAAK2P,UAAL,CAAgB,KAAKyC,eAArB,EAAsCD,YAAtC;AACH,GALD;;AAMA5T,EAAAA,KAAK,CAACqK,SAAN,CAAgBR,UAAhB,GAA6B,UAAUnJ,CAAV,EAAa;AACtC,QAAIC,IAAI,GAAG,KAAKV,MAAhB;;AACA,QAAIS,CAAC,CAACiT,cAAF,CAAiBxR,YAAjB,CAA8B,QAA9B,MAA4C,UAA5C,KACC7C,YAAY,CAACoB,CAAC,CAACE,MAAH,EAAWb,QAAQ,CAAC+I,GAApB,CAAZ,IAAwCxJ,YAAY,CAACoB,CAAC,CAACE,MAAH,EAAW,YAAX,CAApD,IAAgFtB,YAAY,CAACoB,CAAC,CAACE,MAAH,EAAWb,QAAQ,CAACgJ,WAApB,CAD7F,CAAJ,EACoI;AAChI,UAAIM,SAAS,GAAGjK,cAAc,CAACsB,CAAC,CAACE,MAAH,EAAW,IAAX,CAA9B;AACA,UAAI8S,UAAU,GAAG,KAAK,CAAtB;AACA,UAAIE,YAAY,GAAG,KAAK,CAAxB;;AACA,UAAKlT,CAAC,CAACiT,cAAF,CAAiBpP,aAAjB,CAA+B,IAA/B,EAAqCpC,YAArC,CAAkD,gBAAlD,MAAwE,MAAxE,IACDzB,CAAC,CAACiT,cAAF,CAAiBzR,aAAjB,CAA+B2D,EAA/B,KAAsClF,IAAI,CAACQ,OAAL,CAAa0E,EADnD,IAEInF,CAAC,CAACiT,cAAF,CAAiBpP,aAAjB,CAA+B,IAA/B,EAAqCpC,YAArC,CAAkD,gBAAlD,MAAwE,MAAxE,IACAzB,CAAC,CAACiT,cAAF,CAAiBzR,aAAjB,CAA+B2D,EAA/B,KAAsClF,IAAI,CAACQ,OAAL,CAAa0E,EAH3D,EAGgE;AAC5D;AACH;;AACD,UAAInF,CAAC,CAACiT,cAAF,CAAiBzR,aAAjB,CAA+B2D,EAA/B,KAAsClF,IAAI,CAACQ,OAAL,CAAa0E,EAAvD,EAA2D;AACvD6N,QAAAA,UAAU,GAAGhT,CAAC,CAACiT,cAAF,CAAiBzR,aAAjB,CAA+BqD,aAA/B,CAA6C,CAA7C,CAAb;AACH,OAFD,MAGK,IAAI,KAAKuO,mBAAL,IAA4BpT,CAAC,CAACiT,cAAF,CAAiBpP,aAAjB,CAA+B,IAA/B,EAAqCpC,YAArC,CAAkD,gBAAlD,MAAwE,MAAxG,EAAgH;AACjH,aAAKsR,aAAL,CAAmB/S,CAAnB;AACA;AACH;;AACD,UAAIgT,UAAU,CAACvS,OAAX,CAAmB0E,EAAnB,KAA0BlF,IAAI,CAACQ,OAAL,CAAa0E,EAAvC,IAA6C6N,UAAU,CAAChS,eAAX,CAA2BC,QAA3B,KAAwChB,IAAI,CAACQ,OAAL,CAAa0E,EAAtG,EAA0G;AACtG;AACH;;AACD,UAAIkO,OAAO,GAAGL,UAAU,CAAC/O,kBAAX,EAAd;AACA,UAAIqP,WAAW,GAAGJ,YAAY,GAAG,KAAKJ,YAAL,CAAkBnK,SAAlB,CAAjC;;AACA,UAAImF,KAAK,CAACwF,WAAD,CAAT,EAAwB;AACpB;AACAA,QAAAA,WAAW,GAAGJ,YAAY,GAAG,CAA7B;AACH;;AACD,UAAIjT,IAAI,CAAC+P,WAAT,EAAsB;AAClBsD,QAAAA,WAAW,GAAGA,WAAW,GAAIrT,IAAI,CAACgQ,YAAL,CAAkBC,WAAlB,GAAgCjQ,IAAI,CAACgQ,YAAL,CAAkBE,QAAjE,GAA6ElQ,IAAI,CAACgQ,YAAL,CAAkBE,QAA7G;AACH,OA5B+H,CA6BhI;;;AACAlQ,MAAAA,IAAI,CAACwH,MAAL,CAAYtI,MAAM,CAACoU,SAAnB,EAA8B;AAAE3D,QAAAA,OAAO,EAAE0D,WAAX;AAAwBD,QAAAA,OAAO,EAAEA;AAAjC,OAA9B;AACApT,MAAAA,IAAI,CAACwH,MAAL,CAAYtI,MAAM,CAACiQ,YAAnB,EAAiC;AAC7BhO,QAAAA,IAAI,EAAEjC,MAAM,CAACkQ,WADgB;AACHC,QAAAA,WAAW,EAAE;AADV,OAAjC;AAGA,UAAI7P,YAAY,GAAGuT,UAAU,CAACxP,qBAAX,EAAnB;AACA,UAAIuM,IAAI,GAAGiD,UAAU,CAAChD,WAAX,GACNgD,UAAU,CAAC/C,YAAX,CAAwBC,WAAxB,GAAsC8C,UAAU,CAAC/C,YAAX,CAAwBE,QAA/D,GAA2E6C,UAAU,CAAC/C,YAAX,CAAwBE,QAD5F,GACuG,CADlH;AAEA,WAAK1Q,YAAL,GAAoB,EAApB;;AACA,WAAK,IAAIqL,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGsI,OAAO,CAACtS,MAA9B,EAAsC+J,CAAC,GAAGC,GAA1C,EAA+CD,CAAC,EAAhD,EAAoD;AAChD,aAAKrL,YAAL,CAAkB+O,IAAlB,CAAuBuB,IAAI,GAAGtQ,YAAY,CAACqL,CAAD,CAA1C;AACH;;AACDkI,MAAAA,UAAU,CAACvL,MAAX,CAAkBtI,MAAM,CAACqU,WAAzB,EAAsC;AAAEnF,QAAAA,OAAO,EAAE,KAAK5O,YAAhB;AAA8B4T,QAAAA,OAAO,EAAEA;AAAvC,OAAtC;AACAL,MAAAA,UAAU,CAACvL,MAAX,CAAkBtI,MAAM,CAACiQ,YAAzB,EAAuC;AACnChO,QAAAA,IAAI,EAAEjC,MAAM,CAACkQ,WADsB;AACTC,QAAAA,WAAW,EAAE;AADJ,OAAvC;AAGH;AACJ,GAjDD;;AAkDAhQ,EAAAA,KAAK,CAACqK,SAAN,CAAgB+G,UAAhB,GAA6B,UAAUf,WAAV,EAAuBC,OAAvB,EAAgC;AACzD,QAAI3P,IAAI,GAAG,KAAKV,MAAhB;;AACA,QAAI,CAACU,IAAI,CAACsO,YAAL,CAAkBxI,OAAlB,CAA0BhF,MAA3B,IAAqC,CAACd,IAAI,CAAC6F,aAAL,CAAmBC,OAAnB,CAA2BhF,MAAjE,IAA2E,CAACd,IAAI,CAACqO,cAAL,CAAoBvI,OAApB,CAA4BhF,MAA5G,EAAoH;AAChH;AACA,UAAIgP,IAAI,GAAG9P,IAAI,CAAC+P,WAAL,GACN/P,IAAI,CAACgQ,YAAL,CAAkBC,WAAlB,GAAgCjQ,IAAI,CAACgQ,YAAL,CAAkBE,QAAnD,GAA+DlQ,IAAI,CAACgQ,YAAL,CAAkBE,QAD1E,GACqF,CADhG,CAFgH,CAIhH;;AACA,UAAI7L,SAAS,GAAGqL,WAAhB;AACAC,MAAAA,OAAO,GAAGA,OAAO,GAAGG,IAApB;AACA,WAAKtQ,YAAL,GAAoBQ,IAAI,CAACuD,qBAAL,EAApB;AACAvD,MAAAA,IAAI,CAACwH,MAAL,CAAYtI,MAAM,CAACsU,kBAAnB,EAAuC;AACnCnP,QAAAA,SAAS,EAAEqL,WAAW,GAAGI,IADU;AAEnCH,QAAAA,OAAO,EAAEA;AAF0B,OAAvC;AAIH;AACJ,GAfD;;AAgBAtQ,EAAAA,KAAK,CAACqK,SAAN,CAAgBD,iBAAhB,GAAoC,UAAU1J,CAAV,EAAa;AAC7C,QAAIA,CAAC,CAAC0T,MAAF,KAAa,KAAK5O,aAAL,EAAb,IAAqC9E,CAAC,CAAC2T,MAA3C,EAAmD;AAC/C,WAAKzK,cAAL;AACH;AACJ,GAJD;AAKA;AACJ;AACA;AACA;AACA;AACA;;;AACI5J,EAAAA,KAAK,CAACqK,SAAN,CAAgBiK,OAAhB,GAA0B,YAAY;AAClC,QAAIC,WAAW,GAAG,KAAKtU,MAAL,CAAYkB,OAA9B;;AACA,QAAI,KAAKlB,MAAL,CAAYwI,WAAZ,IAA2B,CAAC8L,WAA5B,IAA4C,CAACA,WAAW,CAAChQ,aAAZ,CAA0B,MAAMxE,QAAQ,CAACyU,UAAzC,CAAD,IAC5C,CAACD,WAAW,CAAChQ,aAAZ,CAA0B,MAAMxE,QAAQ,CAACgJ,WAAzC,CADL,EAC6D;AACzD;AACH;;AACD,SAAKlI,SAAL,CAAeyT,OAAf;AACA,SAAKrU,MAAL,CAAYwU,GAAZ,CAAgB5U,MAAM,CAAC8J,UAAvB,EAAmC,KAAKC,cAAxC;AACA,SAAK3J,MAAL,CAAYwU,GAAZ,CAAgB5U,MAAM,CAACgK,UAAvB,EAAmC,KAAKA,UAAxC;AACA,SAAK5J,MAAL,CAAYyU,mBAAZ,CAAgC7U,MAAM,CAACqK,SAAvC,EAAkD,KAAKJ,aAAvD;AACA,SAAK7J,MAAL,CAAYwU,GAAZ,CAAgB5U,MAAM,CAACsK,QAAvB,EAAiC,KAAKC,iBAAtC,EAVkC,CAWlC;AACH,GAZD;AAaA;AACJ;AACA;AACA;AACA;AACA;;;AACIpK,EAAAA,KAAK,CAACqK,SAAN,CAAgB7E,aAAhB,GAAgC,YAAY;AACxC,WAAO,gBAAP;AACH,GAFD,CAz5BmC,CA45BnC;;;AACAxF,EAAAA,KAAK,CAACqK,SAAN,CAAgBrH,WAAhB,GAA8B,UAAUpC,MAAV,EAAkB;AAC5C,QAAID,IAAI,GAAG,KAAKV,MAAhB;AACA,QAAI0U,OAAO,GAAG1S,QAAQ,CAAC,KAAKI,UAAL,CAAgBF,YAAhB,CAA6BpC,QAAQ,CAACqC,YAAtC,CAAD,EAAsD,EAAtD,CAAtB;;AACA,QAAKzB,IAAI,CAACgE,kBAAL,GAA0BlD,MAA1B,GAAmC,CAAnC,IAAwC,KAAKY,UAAL,CAAgBuS,KAAhB,CAAsB,CAAtB,EAAyBvV,SAAzB,CAAmCuC,QAAnC,CAA4C,uBAA5C,MAAyE,KAAlH,IACGjB,IAAI,CAACgE,kBAAL,GAA0BlD,MAA1B,KAAqC,CAD5C,EAC+C;AAC3C,WAAK0B,IAAL,GAAY,CAAC,KAAKlD,MAAL,CAAY0C,aAAZ,CAA0BgS,OAA1B,CAAD,CAAZ;;AACA,UAAIhU,IAAI,CAAC6B,YAAL,EAAJ,EAAyB;AACrB,aAAKW,IAAL,GAAY,CAACxC,IAAI,CAACgC,aAAL,CAAmBgS,OAAnB,CAAD,EAA8BhU,IAAI,CAACiC,oBAAL,CAA0B+R,OAA1B,CAA9B,CAAZ;;AACA,YAAIhU,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAtC,EAAiD;AAC7C,eAAKK,IAAL,GAAY,CAACxC,IAAI,CAACgC,aAAL,CAAmBgS,OAAnB,CAAD,EAA8BhU,IAAI,CAACiC,oBAAL,CAA0B+R,OAA1B,CAA9B,EAAkEhU,IAAI,CAACoC,wBAAL,CAA8B4R,OAA9B,CAAlE,CAAZ;AACH;AACJ;;AACD,WAAKnR,OAAL,GAAe,CAAC,KAAKvD,MAAL,CAAY4U,UAAZ,CAAwB,KAAKxS,UAAN,CAAkBkC,aAAlB,CAAgC,MAAMxE,QAAQ,CAAC+U,OAA/C,CAAvB,EAAgFtR,OAAjF,CAAf;AACH,KAVD,MAWK;AACD,WAAKL,IAAL,GAAYxC,IAAI,CAAC8C,eAAL,EAAZ;AACA,WAAKD,OAAL,GAAe7C,IAAI,CAACgE,kBAAL,EAAf;;AACA,UAAI,KAAK1E,MAAL,CAAY8G,oBAAhB,EAAsC;AAClC,aAAK5D,IAAL,GAAY,EAAZ;AACA,YAAI4R,QAAQ,GAAGpU,IAAI,CAACuD,qBAAL,EAAf;;AACA,aAAK,IAAIsH,CAAC,GAAG,CAAR,EAAWC,GAAG,GAAGsJ,QAAQ,CAACtT,MAA/B,EAAuC+J,CAAC,GAAGC,GAA3C,EAAgDD,CAAC,EAAjD,EAAqD;AACjD,eAAKrI,IAAL,CAAU+L,IAAV,CAAevO,IAAI,CAACgC,aAAL,CAAmBoS,QAAQ,CAACvJ,CAAD,CAA3B,CAAf;;AACA,cAAI7K,IAAI,CAAC6B,YAAL,EAAJ,EAAyB;AACrB,iBAAKW,IAAL,CAAU+L,IAAV,CAAevO,IAAI,CAACiC,oBAAL,CAA0BmS,QAAQ,CAACvJ,CAAD,CAAlC,CAAf;;AACA,gBAAI7K,IAAI,CAACkC,aAAL,OAAyB9C,QAAQ,CAAC+C,SAAtC,EAAiD;AAC7C,mBAAKK,IAAL,CAAU+L,IAAV,CAAevO,IAAI,CAACoC,wBAAL,CAA8BgS,QAAQ,CAACvJ,CAAD,CAAtC,CAAf;AACH;AACJ;AACJ;AACJ;AACJ;AACJ,GA/BD;;AAgCA,SAAOxL,KAAP;AACH,CA97B0B,EAA3B;;AA+7BA,SAASA,KAAT","sourcesContent":["import { Draggable, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { removeClass } from '@syncfusion/ej2-base';\nimport { remove, closest as closestElement, classList } from '@syncfusion/ej2-base';\nimport { parentsUntil, removeElement, getPosition, addRemoveActiveClasses, isActionPrevent } from '../base/util';\nimport { setRowsInTbody, resetRowIndex } from '../base/util';\nimport * as events from '../base/constant';\nimport { Scroll } from '../actions/scroll';\nimport * as literals from '../base/string-literals';\n// eslint-disable-next-line valid-jsdoc\n/**\n *\n * Reorder module is used to handle row reordering.\n *\n * @hidden\n */\nvar RowDD = /** @class */ (function () {\n    /**\n     * Constructor for the Grid print module\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @hidden\n     */\n    function RowDD(parent) {\n        var _this = this;\n        this.selectedRows = [];\n        this.isOverflowBorder = true;\n        this.selectedRowColls = [];\n        this.isRefresh = true;\n        this.isReplaceDragEle = true;\n        this.istargetGrid = false;\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n        this.helper = function (e) {\n            var gObj = _this.parent;\n            var target = _this.draggable.currentStateTarget;\n            var visualElement = _this.parent.createElement('div', {\n                className: 'e-cloneproperties e-draganddrop e-grid e-dragclone',\n                styles: 'height:\"auto\", z-index:2, width:' + gObj.element.offsetWidth\n            });\n            var table = _this.parent.createElement('table', { styles: 'width:' + gObj.element.offsetWidth });\n            var tbody = _this.parent.createElement(literals.tbody);\n            if (document.getElementsByClassName('e-griddragarea').length ||\n                (gObj.rowDropSettings.targetID && ((!target.classList.contains('e-selectionbackground')\n                    && gObj.selectionSettings.type !== 'Single') || !parentsUntil(target, 'e-rowcell'))) ||\n                (!gObj.rowDropSettings.targetID && !parentsUntil(target, 'e-rowdragdrop'))) {\n                return false;\n            }\n            if (gObj.rowDropSettings.targetID &&\n                gObj.selectionSettings.mode === 'Row' && gObj.selectionSettings.type === 'Single') {\n                gObj.selectRow(parseInt(_this.draggable.currentStateTarget.parentElement.getAttribute(literals.ariaRowIndex), 10));\n            }\n            _this.startedRow = closestElement(target, 'tr').cloneNode(true);\n            var frzCols = _this.parent.isFrozenGrid();\n            if (frzCols) {\n                var rowIndex = parseInt(closestElement(target, 'tr').getAttribute(literals.ariaRowIndex), 10);\n                _this.startedRow.innerHTML = '';\n                _this.startedRow.innerHTML += gObj.getRowByIndex(rowIndex).innerHTML;\n                _this.startedRow.innerHTML += gObj.getMovableRowByIndex(rowIndex).innerHTML;\n                if (gObj.getFrozenMode() === literals.leftRight) {\n                    _this.startedRow.innerHTML += gObj.getFrozenRightRowByIndex(rowIndex).innerHTML;\n                }\n            }\n            _this.processArgs(target);\n            var args = {\n                selectedRow: _this.rows, dragelement: target,\n                cloneElement: visualElement, cancel: false, data: _this.rowData\n            };\n            var selectedRows = gObj.getSelectedRows();\n            gObj.trigger(events.rowDragStartHelper, args);\n            var cancel = 'cancel';\n            if (args[cancel]) {\n                return false;\n            }\n            removeElement(_this.startedRow, '.e-indentcell');\n            removeElement(_this.startedRow, '.e-detailrowcollapse');\n            removeElement(_this.startedRow, '.e-detailrowexpand');\n            _this.removeCell(_this.startedRow, literals.gridChkBox);\n            var exp = new RegExp('e-active', 'g'); //high contrast issue\n            _this.startedRow.innerHTML = _this.startedRow.innerHTML.replace(exp, '');\n            tbody.appendChild(_this.startedRow);\n            if (gObj.getSelectedRowIndexes().length > 1 && _this.startedRow.hasAttribute('aria-selected')) {\n                var index = gObj.getFrozenMode() === literals.leftRight ? 3 : 2;\n                var dropCountEle = _this.parent.createElement('span', {\n                    className: 'e-dropitemscount', innerHTML: frzCols ? '' + selectedRows.length / index : '' + selectedRows.length\n                });\n                visualElement.appendChild(dropCountEle);\n            }\n            var ele = closestElement(target, 'tr').querySelector('.e-icon-rowdragicon');\n            if (ele) {\n                ele.classList.add('e-dragstartrow');\n            }\n            table.appendChild(tbody);\n            visualElement.appendChild(table);\n            gObj.element.appendChild(visualElement);\n            return visualElement;\n        };\n        this.dragStart = function (e) {\n            var gObj = _this.parent;\n            if (document.getElementsByClassName('e-griddragarea').length) {\n                return;\n            }\n            var target = e.target;\n            var spanCssEle = _this.parent.element.querySelector('.e-dropitemscount');\n            if (_this.parent.getSelectedRecords().length > 1 && spanCssEle) {\n                spanCssEle.style.left = _this.parent.element.querySelector('.e-cloneproperties table')\n                    .offsetWidth - 5 + 'px';\n            }\n            _this.processArgs(target);\n            gObj.trigger(events.rowDragStart, {\n                rows: _this.rows, target: e.target,\n                draggableType: 'rows', fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10),\n                data: (Object.keys(_this.rowData[0]).length > 0) ? _this.rowData : _this.currentViewData()\n            });\n            _this.dragStartData = _this.rowData;\n            var dropElem = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElem && dropElem.ej2_instances &&\n                dropElem.ej2_instances[0].getModuleName() === 'grid') {\n                dropElem.ej2_instances[0].getContent().classList.add('e-allowRowDrop');\n            }\n        };\n        this.drag = function (e) {\n            var gObj = _this.parent;\n            _this.isDropGrid = _this.parent;\n            _this.istargetGrid = false;\n            if (_this.parent.rowDropSettings.targetID) {\n                var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n                _this.isDropGrid = dropElement.ej2_instances[0];\n                if (parentsUntil(e.target, 'e-grid')) {\n                    _this.istargetGrid = _this.parent.rowDropSettings.targetID === parentsUntil(e.target, 'e-grid').id;\n                }\n            }\n            var cloneElement = _this.parent.element.querySelector('.e-cloneproperties');\n            var target = _this.getElementFromPosition(cloneElement, e.event);\n            classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur', 'e-movecur']);\n            _this.isOverflowBorder = true;\n            _this.hoverState = gObj.enableHover;\n            var trElement = parentsUntil(target, 'e-grid') ? closestElement(e.target, 'tr') : null;\n            gObj.enableHover = false;\n            if (!e.target) {\n                return;\n            }\n            _this.processArgs(target);\n            var args = {\n                rows: _this.rows, target: target, draggableType: 'rows',\n                data: _this.rowData, originalEvent: e, cancel: false\n            };\n            gObj.trigger(events.rowDrag, args);\n            _this.stopTimer();\n            if (args.cancel) {\n                return;\n            }\n            gObj.element.classList.add('e-rowdrag');\n            _this.dragTarget = trElement && parentsUntil(target, 'e-grid').id === cloneElement.parentElement.id ?\n                parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) : parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n            if (gObj.rowDropSettings.targetID) {\n                if (!parentsUntil(target, 'e-grid') ||\n                    parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(target, 'e-grid').id) {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-defaultcur'], ['e-notallowedcur']);\n                }\n            }\n            else {\n                var elem = parentsUntil(target, 'e-grid');\n                if (elem && elem.id === cloneElement.parentElement.id) {\n                    classList(cloneElement, ['e-movecur'], ['e-defaultcur']);\n                }\n                else {\n                    classList(cloneElement, ['e-notallowedcur'], ['e-movecur']);\n                }\n            }\n            if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n                if ((!_this.isDropGrid.groupSettings.columns.length || e.target.classList.contains('e-selectionbackground')) &&\n                    !_this.isDropGrid.element.querySelector('.e-emptyrow')) {\n                    if (parentsUntil(target, 'e-grid') && parentsUntil(target, 'e-grid').id === _this.isDropGrid.element.id) {\n                        _this.updateScrollPostion(e.event);\n                    }\n                    if (((_this.isOverflowBorder || _this.parent.frozenRows > _this.dragTarget) &&\n                        (parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10) !== _this.dragTarget || _this.istargetGrid))\n                        || (_this.istargetGrid && trElement && _this.isDropGrid.getRowByIndex(_this.isDropGrid.getCurrentViewRecords().length - 1).\n                            getAttribute('data-uid') === trElement.getAttribute('data-uid'))) {\n                        _this.moveDragRows(e, _this.startedRow, trElement);\n                    }\n                    else {\n                        var islastRowIndex = void 0;\n                        if (_this.parent.enableVirtualization) {\n                            islastRowIndex = trElement && parseInt(trElement.getAttribute(literals.ariaRowIndex), 10) ===\n                                _this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n                        }\n                        else {\n                            var lastRowUid = _this.parent.getRowByIndex(_this.parent.getCurrentViewRecords().length - 1).\n                                getAttribute('data-uid');\n                            islastRowIndex = trElement && lastRowUid === trElement.getAttribute('data-uid') && lastRowUid !==\n                                _this.startedRow.getAttribute('data-uid');\n                        }\n                        if (islastRowIndex && !_this.parent.rowDropSettings.targetID) {\n                            var bottomborder = _this.parent.createElement('div', { className: 'e-lastrow-dragborder' });\n                            var gridcontentEle = _this.parent.getContent();\n                            bottomborder.style.width = _this.parent.element.offsetWidth - _this.getScrollWidth() + 'px';\n                            if (!gridcontentEle.getElementsByClassName('e-lastrow-dragborder').length) {\n                                gridcontentEle.classList.add('e-grid-relative');\n                                gridcontentEle.appendChild(bottomborder);\n                                bottomborder.style.bottom = _this.getScrollWidth() + 'px';\n                            }\n                        }\n                        _this.removeBorder(trElement);\n                    }\n                }\n                if (target && target.classList.contains(literals.content)\n                    && !_this.isDropGrid.element.querySelector('.e-emptyrow') && _this.istargetGrid) {\n                    _this.removeBorder(trElement);\n                    var rowIndex = _this.isDropGrid.getCurrentViewRecords().length - 1;\n                    var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n                    var rowElement = [];\n                    rowElement = [].slice.call(_this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector));\n                    if (_this.isDropGrid.isFrozenGrid()) {\n                        rowElement = _this.borderRowElement(rowIndex, selector);\n                    }\n                    if (rowElement.length > 0) {\n                        addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n                    }\n                }\n            }\n        };\n        this.dragStop = function (e) {\n            if (isActionPrevent(_this.parent)) {\n                _this.parent.notify(events.preventBatch, {\n                    instance: _this, handler: _this.processDragStop, arg1: e\n                });\n            }\n            else {\n                _this.processDragStop(e);\n            }\n        };\n        this.processDragStop = function (e) {\n            var gObj = _this.parent;\n            if (_this.parent.isDestroyed) {\n                return;\n            }\n            var targetEle = _this.getElementFromPosition(e.helper, e.event);\n            var target = targetEle && !targetEle.classList.contains('e-dlg-overlay') ?\n                targetEle : e.target;\n            gObj.element.classList.remove('e-rowdrag');\n            var dropElement = document.getElementById(gObj.rowDropSettings.targetID);\n            if (gObj.rowDropSettings.targetID && dropElement && dropElement.ej2_instances &&\n                dropElement.ej2_instances[0].getModuleName() === 'grid') {\n                dropElement.ej2_instances[0].getContent().classList.remove('e-allowRowDrop');\n            }\n            if (parentsUntil(_this.isDropGrid.element, 'e-grid')) {\n                _this.stopTimer();\n                _this.isDropGrid.enableHover = _this.hoverState;\n                _this.isDropGrid.getContent().classList.remove('e-grid-relative');\n                _this.removeBorder(targetEle);\n                var stRow = _this.isDropGrid.element.querySelector('.e-dragstartrow');\n                if (stRow) {\n                    stRow.classList.remove('e-dragstartrow');\n                }\n            }\n            _this.processArgs(target);\n            if (_this.parent.enableVirtualization && isNullOrUndefined(_this.rows[0])) {\n                _this.dragTarget = null;\n                remove(e.helper);\n                return;\n            }\n            var args = {\n                target: target, draggableType: 'rows',\n                cancel: false,\n                fromIndex: parseInt(_this.rows[0].getAttribute(literals.ariaRowIndex), 10),\n                dropIndex: _this.dragTarget, rows: _this.rows,\n                data: (Object.keys(_this.dragStartData[0]).length > 0) ? _this.dragStartData : _this.currentViewData()\n            };\n            gObj.trigger(events.rowDrop, args, function () {\n                if (!(parentsUntil(target, literals.row) || parentsUntil(target, 'e-emptyrow')\n                    || parentsUntil(target, literals.gridContent)) || args.cancel) {\n                    _this.dragTarget = null;\n                    remove(e.helper);\n                    return;\n                }\n                _this.isRefresh = false;\n                var selectedIndexes = _this.parent.getSelectedRowIndexes();\n                if (gObj.isRowDragable()) {\n                    if (!_this.parent.rowDropSettings.targetID &&\n                        _this.startedRow.querySelector('td.e-selectionbackground') && selectedIndexes.length > 1 &&\n                        selectedIndexes.length !== _this.parent.getCurrentViewRecords().length) {\n                        _this.reorderRows(selectedIndexes, args.dropIndex);\n                    }\n                    else {\n                        _this.reorderRows([parseInt(_this.startedRow.getAttribute(literals.ariaRowIndex), 10)], _this.dragTarget);\n                    }\n                    _this.dragTarget = null;\n                    if (!gObj.rowDropSettings.targetID) {\n                        remove(e.helper);\n                        if (gObj.frozenRows && gObj.enableVirtualization) {\n                            gObj.refresh();\n                        }\n                        else {\n                            _this.rowOrder(args);\n                        }\n                    }\n                }\n                _this.isRefresh = true;\n            });\n        };\n        this.removeCell = function (targetRow, className) {\n            return [].slice.call(targetRow.querySelectorAll('td')).filter(function (cell) {\n                if (cell.classList.contains(className)) {\n                    targetRow.deleteCell(cell.cellIndex);\n                }\n            });\n        };\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.initialEnd, this.initializeDrag, this);\n        this.parent.on(events.columnDrop, this.columnDrop, this);\n        this.onDataBoundFn = this.onDataBound.bind(this);\n        this.parent.addEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.on(events.uiUpdate, this.enableAfterRender, this);\n    }\n    RowDD.prototype.refreshRow = function (args, tbody, mtbody, frTbody, target, mTarget, frTarget) {\n        var gObj = this.parent;\n        var frzCols = gObj.isFrozenGrid();\n        var isLeftRight = gObj.getFrozenMode() === literals.leftRight;\n        var tbodyMovableHeader;\n        var tbodyMovableContent;\n        var frHdr;\n        var frCnt;\n        var tbodyContent = gObj.getContentTable().querySelector(literals.tbody);\n        var tbodyHeader = gObj.getHeaderTable().querySelector(literals.tbody);\n        if (frzCols) {\n            tbodyMovableHeader = gObj.getMovableHeaderTbody();\n            tbodyMovableContent = gObj.getMovableContentTbody();\n            if (isLeftRight) {\n                frHdr = gObj.getFrozenRightHeaderTbody();\n                frCnt = gObj.getFrozenRightContentTbody();\n            }\n        }\n        var index = gObj.getFrozenMode() === literals.leftRight ? 3 : 2;\n        for (var i = 0, len = args.rows.length; i < len; i++) {\n            if (frzCols) {\n                if (i % index === 0) {\n                    tbody.insertBefore(args.rows[i], target);\n                }\n                else if (i % index === 1) {\n                    mtbody.insertBefore(args.rows[i], mTarget);\n                }\n                else {\n                    frTbody.insertBefore(args.rows[i], frTarget);\n                }\n            }\n            else {\n                tbody.insertBefore(args.rows[i], target);\n            }\n        }\n        var tr = [].slice.call(tbody.getElementsByClassName(literals.row));\n        var mtr;\n        var frTr;\n        if (frzCols) {\n            mtr = [].slice.call(mtbody.getElementsByClassName(literals.row));\n            if (isLeftRight) {\n                frTr = [].slice.call(frTbody.getElementsByClassName(literals.row));\n            }\n        }\n        if (this.parent.enableVirtualization) {\n            this.refreshVirtualData(tr, mtr, frTr);\n        }\n        else {\n            this.refreshData(tr, mtr, frTr);\n        }\n        if (this.parent.frozenRows) {\n            var _loop_1 = function (i, len) {\n                if (i < this_1.parent.frozenRows) {\n                    setRowsInTbody(tbodyHeader, tbodyMovableHeader, frHdr, tr, mtr, frTr, function (tbody, rows) {\n                        tbody.appendChild(rows[i]);\n                    });\n                }\n                else {\n                    setRowsInTbody(tbodyContent, tbodyMovableContent, frCnt, tr, mtr, frTr, function (tbody, rows) {\n                        tbody.appendChild(rows[i]);\n                    });\n                }\n            };\n            var this_1 = this;\n            for (var i = 0, len = tr.length; i < len; i++) {\n                _loop_1(i, len);\n            }\n        }\n    };\n    RowDD.prototype.updateFrozenRowreOrder = function (args) {\n        var gObj = this.parent;\n        var tbodyMovH;\n        var tbodyMovC;\n        var tbodyFrH;\n        var tbodyFrC;\n        var frzCols = this.parent.isFrozenGrid();\n        var isLeftRight = gObj.getFrozenMode() === literals.leftRight;\n        var tbodyC = gObj.getContentTable().querySelector(literals.tbody);\n        var tbodyH = gObj.getHeaderTable().querySelector(literals.tbody);\n        if (frzCols) {\n            tbodyMovH = gObj.getMovableHeaderTbody();\n            tbodyMovC = gObj.getMovableContentTbody();\n            if (isLeftRight) {\n                tbodyFrH = gObj.getFrozenRightHeaderTbody();\n                tbodyFrC = gObj.getFrozenRightContentTbody();\n            }\n        }\n        var tr = [].slice.call(tbodyH.getElementsByClassName(literals.row)).concat([].slice.call(tbodyC.getElementsByClassName(literals.row)));\n        var mtr;\n        var frTr;\n        if (frzCols) {\n            mtr = [].slice.call(tbodyMovH.getElementsByClassName(literals.row))\n                .concat([].slice.call(tbodyMovC.getElementsByClassName(literals.row)));\n            if (isLeftRight) {\n                frTr = [].slice.call(tbodyFrH.getElementsByClassName(literals.row))\n                    .concat([].slice.call(tbodyFrC.getElementsByClassName(literals.row)));\n            }\n        }\n        var tbody = gObj.createElement(literals.tbody);\n        var mtbody = gObj.createElement(literals.tbody);\n        var frTbody = gObj.createElement(literals.tbody);\n        this.parent.clearSelection();\n        var targetRows = this.refreshRowTarget(args);\n        for (var i = 0, len = tr.length; i < len; i++) {\n            tbody.appendChild(tr[i]);\n            if (frzCols) {\n                mtbody.appendChild(mtr[i]);\n                if (isLeftRight) {\n                    frTbody.appendChild(frTr[i]);\n                }\n            }\n        }\n        this.refreshRow(args, tbody, mtbody, frTbody, targetRows.target, targetRows.mTarget, targetRows.frTarget);\n    };\n    RowDD.prototype.refreshRowTarget = function (args) {\n        var gObj = this.parent;\n        var mTr;\n        var frTr;\n        var targetIdx = parseInt(args.target.parentElement.getAttribute(literals.ariaRowIndex), 10);\n        if (args.fromIndex < args.dropIndex || args.fromIndex === args.dropIndex) {\n            targetIdx = targetIdx + 1;\n        }\n        var tr = gObj.getRowByIndex(targetIdx);\n        if (gObj.isFrozenGrid()) {\n            mTr = gObj.getMovableRowByIndex(targetIdx);\n            if (gObj.getFrozenMode() === literals.leftRight) {\n                frTr = gObj.getFrozenRightRowByIndex(targetIdx);\n            }\n        }\n        var rows = {\n            target: tr, mTarget: mTr, frTarget: frTr\n        };\n        return rows;\n    };\n    RowDD.prototype.updateFrozenColumnreOrder = function (args) {\n        var gObj = this.parent;\n        var mtbody;\n        var frTbody;\n        var frzCols = this.parent.isFrozenGrid();\n        var tbody = gObj.getContentTable().querySelector(literals.tbody);\n        if (frzCols) {\n            mtbody = gObj.getMovableContentTbody();\n            if (gObj.getFrozenMode() === literals.leftRight) {\n                frTbody = gObj.getFrozenRightContentTbody();\n            }\n        }\n        this.parent.clearSelection();\n        var targetRows = this.refreshRowTarget(args);\n        this.refreshRow(args, tbody, mtbody, frTbody, targetRows.target, targetRows.mTarget, targetRows.frTarget);\n    };\n    RowDD.prototype.refreshVirtualData = function (tr, mtr, frTr) {\n        var recordobj = {};\n        var currentViewData = this.parent.getCurrentViewRecords();\n        var startedRow = this.parent.isFrozenGrid() ? this.parent.getMovableRows()[0] : this.parent.getRows()[0];\n        var startIndex = parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10);\n        for (var i = 0, len = tr.length; i < len; i++) {\n            var index = parseInt(tr[i].getAttribute(literals.ariaRowIndex), 10);\n            this.parent.notify(events.refreshVirtualCacheOnRowDD, { objIndex: index, end: i === tr.length - 1, startIndex: startIndex });\n            index = index - startIndex;\n            recordobj[i] = currentViewData[index];\n        }\n        var rowsElem = this.parent.getRows();\n        var mvbRows;\n        var frRightRow;\n        if (this.parent.isFrozenGrid()) {\n            mvbRows = this.parent.getMovableRows();\n            if (frTr) {\n                frRightRow = this.parent.getFrozenRightRows();\n            }\n        }\n        for (var i = 0, len = tr.length; i < len; i++) {\n            tr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n            rowsElem[i] = tr[i];\n            currentViewData[i] = recordobj[i];\n            if (this.parent.isFrozenGrid()) {\n                mtr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n                mvbRows[i] = mtr[i];\n                if (frTr) {\n                    frTr[i].setAttribute(literals.ariaRowIndex, (i + startIndex).toString());\n                    frRightRow[i] = frTr[i];\n                }\n            }\n        }\n    };\n    RowDD.prototype.refreshData = function (tr, mtr, frTr) {\n        var rowObj = {};\n        var movobj = {};\n        var frObj = {};\n        var recordobj = {};\n        var rowObjects = this.parent.getRowsObject();\n        var movbObject = this.parent.getMovableRowsObject();\n        var frRightObject = this.parent.getFrozenRightRowsObject();\n        var currentViewData = this.parent.getCurrentViewRecords();\n        for (var i = 0, len = tr.length; i < len; i++) {\n            var index = parseInt(tr[i].getAttribute(literals.ariaRowIndex), 10);\n            rowObj[i] = rowObjects[index];\n            recordobj[i] = currentViewData[index];\n            if (this.parent.isFrozenGrid()) {\n                movobj[i] = movbObject[index];\n                if (frTr) {\n                    frObj[i] = frRightObject[index];\n                }\n            }\n        }\n        var rows = this.parent.getRows();\n        var movbRows;\n        var frRightRows;\n        if (this.parent.isFrozenGrid()) {\n            movbRows = this.parent.getMovableRows();\n            if (frTr) {\n                frRightRows = this.parent.getFrozenRightRows();\n            }\n        }\n        for (var i = 0, len = tr.length; i < len; i++) {\n            rows[i] = tr[i];\n            rowObjects[i] = rowObj[i];\n            currentViewData[i] = recordobj[i];\n            if (this.parent.isFrozenGrid()) {\n                movbRows[i] = mtr[i];\n                movbObject[i] = movobj[i];\n                if (frTr) {\n                    frRightRows[i] = frTr[i];\n                    frRightObject[i] = frObj[i];\n                }\n            }\n        }\n        resetRowIndex(this.parent, rowObjects, tr);\n        if (this.parent.isFrozenGrid()) {\n            resetRowIndex(this.parent, movbObject, mtr);\n            if (frTr) {\n                resetRowIndex(this.parent, frRightObject, frTr);\n            }\n        }\n    };\n    RowDD.prototype.rowOrder = function (args) {\n        if (args.dropIndex === args.fromIndex || isNaN(args.dropIndex)) {\n            return;\n        }\n        if (this.parent.childGrid) {\n            this.parent.detailCollapseAll();\n            var rows = [].slice.call(this.parent.getContentTable().querySelector(literals.tbody).children);\n            var rowObjects = this.parent.getRowsObject();\n            rows.filter(function (row) {\n                if (row.classList.contains('e-detailrow')) {\n                    row.remove();\n                }\n            });\n            for (var i = 0, len = rowObjects.length; i < len; i++) {\n                if (!rowObjects[i]) {\n                    break;\n                }\n                if (rowObjects[i].isDetailRow) {\n                    this.parent.getRowsObject().splice(i, 1);\n                    i--;\n                }\n            }\n        }\n        if (args.target.classList.contains('e-rowcelldrag')) {\n            args.target = args.target.parentElement;\n        }\n        if (this.parent.frozenRows) {\n            this.updateFrozenRowreOrder(args);\n        }\n        else {\n            this.updateFrozenColumnreOrder(args);\n        }\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            var indexes = [];\n            if (this.parent.filterSettings.columns.length || this.parent.sortSettings.columns.length) {\n                for (var i = 0, len = args.rows.length; i < len; i++) {\n                    indexes.push(parseInt(args.rows[i].getAttribute(literals.ariaRowIndex), 10));\n                }\n                this.selectedRowColls = indexes;\n            }\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.currentViewData = function () {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var currentVdata = [];\n        var fromIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n        for (var i = 0, n = selectedIndexes.length; i < n; i++) {\n            var currentV = 'currentViewData';\n            currentVdata[i] = this.parent[currentV][selectedIndexes[i]];\n        }\n        if (!this.parent.rowDropSettings.targetID && selectedIndexes.length === 0) {\n            currentVdata[0] = this.parent.currentViewData[fromIdx];\n        }\n        return currentVdata;\n    };\n    RowDD.prototype.saveChange = function (changeRecords, query) {\n        var _this = this;\n        this.parent.getDataModule().saveChanges(changeRecords, this.parent.getPrimaryKeyFieldNames()[0], {}, query)\n            .then(function () {\n            _this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }).catch(function (e) {\n            var error = 'error';\n            var message = 'message';\n            if (!isNullOrUndefined(e[error]) && !isNullOrUndefined(e[error][message])) {\n                e[error] = e[error][message];\n            }\n            _this.parent.trigger(events.actionFailure, e);\n        });\n    };\n    RowDD.prototype.reorderRows = function (fromIndexes, toIndex) {\n        var selectedIndexes = this.parent.getSelectedRowIndexes();\n        var selectedRecords = [];\n        var draggedRecords = [];\n        var currentViewData = this.parent.renderModule.data.dataManager.dataSource.json;\n        var skip = this.parent.allowPaging ?\n            (this.parent.pageSettings.currentPage * this.parent.pageSettings.pageSize) - this.parent.pageSettings.pageSize : 0;\n        var dropIdx = toIndex + skip;\n        var actualIdx = fromIndexes[0] + skip;\n        for (var i = 0, len = fromIndexes.length; i < len; i++) {\n            draggedRecords[i] = currentViewData[fromIndexes[i] + skip];\n        }\n        for (var i = 0, len = selectedIndexes.length; i < len; i++) {\n            selectedRecords[i] = currentViewData[selectedIndexes[i] + skip];\n        }\n        for (var i = 0, len = draggedRecords.length; i < len; i++) {\n            if (i !== 0) {\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) ===\n                        JSON.stringify(draggedRecords[i])) {\n                        actualIdx = j;\n                        break;\n                    }\n                }\n                for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                    if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(draggedRecords[i - 1])) {\n                        if (actualIdx > j) {\n                            dropIdx = j + 1;\n                        }\n                        break;\n                    }\n                }\n            }\n            this.reorderRow(actualIdx - skip, dropIdx - skip);\n        }\n        if (this.isRefresh) {\n            this.parent.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n        for (var i = 0, len = selectedRecords.length; i < len; i++) {\n            for (var j = 0, len1 = currentViewData.length; j < len1; j++) {\n                if (JSON.stringify(this.parent.renderModule.data.dataManager.dataSource.json[j]) === JSON.stringify(selectedRecords[i])) {\n                    selectedIndexes[i] = j - skip;\n                    break;\n                }\n            }\n        }\n        this.selectedRowColls = selectedIndexes;\n    };\n    RowDD.prototype.stopTimer = function () {\n        window.clearInterval(this.timer);\n    };\n    RowDD.prototype.initializeDrag = function () {\n        var gObj = this.parent;\n        this.draggable = new Draggable(gObj.element, {\n            dragTarget: '.e-rowcelldrag, .e-rowdragdrop, .e-rowcell',\n            distance: 5,\n            helper: this.helper,\n            dragStart: this.dragStart,\n            drag: this.drag,\n            dragStop: this.dragStop,\n            isReplaceDragEle: this.isReplaceDragEle\n        });\n    };\n    RowDD.prototype.updateScrollPostion = function (e) {\n        var _this = this;\n        var y = getPosition(e).y;\n        var cliRect = this.isDropGrid.getContent().getBoundingClientRect();\n        var rowHeight = this.isDropGrid.getRowHeight() - 15;\n        var scrollElem = this.isDropGrid.getContent().firstElementChild;\n        if (cliRect.top >= y) {\n            var scrollPixel_1 = -(this.isDropGrid.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_1); }, 200);\n        }\n        else if (cliRect.top + this.isDropGrid.getContent().clientHeight - rowHeight - 33 <= y) {\n            var scrollPixel_2 = (this.isDropGrid.getRowHeight());\n            this.isOverflowBorder = false;\n            this.timer = window.setInterval(function () { _this.setScrollDown(scrollElem, scrollPixel_2); }, 200);\n        }\n    };\n    RowDD.prototype.setScrollDown = function (scrollElem, scrollPixel) {\n        scrollElem.scrollTop = scrollElem.scrollTop + scrollPixel;\n    };\n    RowDD.prototype.moveDragRows = function (e, startedRow, targetRow) {\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        var element = closestElement(e.target, 'tr');\n        if (parentsUntil(element, 'e-grid') &&\n            (parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id || this.istargetGrid)) {\n            var targetElement = element ?\n                element : this.startedRow;\n            this.setBorder(targetElement, e.event, startedRow, targetRow);\n        }\n    };\n    RowDD.prototype.setBorder = function (element, event, startedRow, targetRow) {\n        var node = this.parent.element;\n        if (this.istargetGrid) {\n            node = this.isDropGrid.element;\n        }\n        var cloneElement = this.parent.element.querySelector('.e-cloneproperties');\n        this.removeFirstRowBorder(element);\n        this.removeLastRowBorder(element);\n        if (parentsUntil(element, 'e-grid') && (!this.parent.rowDropSettings.targetID && element.classList.contains(literals.row) &&\n            parentsUntil(cloneElement.parentElement, 'e-grid').id === parentsUntil(element, 'e-grid').id) || this.istargetGrid) {\n            removeClass(node.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'), ['e-dragborder']);\n            var rowElement = [];\n            var targetRowIndex = parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10);\n            if (targetRow && targetRowIndex === 0) {\n                var div = this.parent.createElement('div', { className: 'e-firstrow-dragborder' });\n                var gridheaderEle = this.isDropGrid.getHeaderContent();\n                gridheaderEle.classList.add('e-grid-relative');\n                div.style.width = node.offsetWidth - this.getScrollWidth() + 'px';\n                if (!gridheaderEle.getElementsByClassName('e-firstrow-dragborder').length) {\n                    gridheaderEle.appendChild(div);\n                }\n            }\n            else if (this.parent.rowDropSettings.targetID && targetRow) {\n                element = this.isDropGrid.getRowByIndex(targetRowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else if (targetRow && parseInt(startedRow.getAttribute(literals.ariaRowIndex), 10) > targetRowIndex) {\n                element = this.parent.getRowByIndex(targetRowIndex - 1);\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            else {\n                rowElement = [].slice.call(element.querySelectorAll('.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse'));\n            }\n            var frzCols = this.parent.isFrozenGrid();\n            if (targetRow && targetRowIndex !== 0 && frzCols) {\n                var rowIndex = parseInt(element.getAttribute(literals.ariaRowIndex), 10);\n                var selector = '.e-rowcell,.e-rowdragdrop,.e-detailrowcollapse';\n                rowElement = this.borderRowElement(rowIndex, selector);\n            }\n            if (rowElement.length > 0) {\n                addRemoveActiveClasses(rowElement, true, 'e-dragborder');\n            }\n        }\n    };\n    RowDD.prototype.borderRowElement = function (rowIndex, selector) {\n        var lastRow = [];\n        lastRow = [].slice.call(this.isDropGrid.getRowByIndex(rowIndex).querySelectorAll(selector)).\n            concat([].slice.call(this.isDropGrid.getMovableRowByIndex(rowIndex).querySelectorAll(selector)));\n        if (this.isDropGrid.getFrozenMode() === literals.leftRight) {\n            lastRow = lastRow.concat([].slice.call(this.isDropGrid.getFrozenRightRowByIndex(rowIndex).querySelectorAll(selector)));\n        }\n        return lastRow;\n    };\n    RowDD.prototype.getScrollWidth = function () {\n        var scrollElem = this.parent.getContent().firstElementChild;\n        return scrollElem.scrollWidth > scrollElem.offsetWidth ? Scroll.getScrollBarWidth() : 0;\n    };\n    RowDD.prototype.removeFirstRowBorder = function (element) {\n        if (this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder').length > 0 && element &&\n            element.rowIndex !== 0) {\n            remove(this.isDropGrid.element.getElementsByClassName('e-firstrow-dragborder')[0]);\n        }\n    };\n    RowDD.prototype.removeLastRowBorder = function (element) {\n        var islastRowIndex;\n        if (this.parent.enableVirtualization) {\n            islastRowIndex = element && parseInt(element.getAttribute(literals.ariaRowIndex), 10) !==\n                this.parent.renderModule.data.dataManager.dataSource.json.length - 1;\n        }\n        else {\n            islastRowIndex = element &&\n                this.parent.getRowByIndex(this.parent.getCurrentViewRecords().length - 1).getAttribute('data-uid') !==\n                    element.getAttribute('data-uid');\n        }\n        if (this.parent.element.getElementsByClassName('e-lastrow-dragborder').length > 0 && element && islastRowIndex) {\n            remove(this.parent.element.getElementsByClassName('e-lastrow-dragborder')[0]);\n        }\n    };\n    RowDD.prototype.removeBorder = function (element) {\n        this.removeFirstRowBorder(element);\n        if (!this.parent.rowDropSettings.targetID) {\n            this.removeLastRowBorder(element);\n        }\n        element = (this.isDropGrid.isFrozenGrid() ? this.isDropGrid.getMovableRows() : this.isDropGrid.getRows()).filter(function (row) {\n            return row.querySelector('td.e-dragborder');\n        })[0];\n        if (element) {\n            var rowElement = [].slice.call(element.getElementsByClassName('e-dragborder'));\n            if (this.parent.isFrozenGrid()) {\n                var rowIndex = parseInt(element.getAttribute(literals.ariaRowIndex), 10);\n                var selector = '.e-dragborder';\n                rowElement = this.borderRowElement(rowIndex, selector);\n            }\n            addRemoveActiveClasses(rowElement, false, 'e-dragborder');\n        }\n    };\n    RowDD.prototype.getElementFromPosition = function (element, event) {\n        var position = getPosition(event);\n        element.style.display = 'none';\n        var target = document.elementFromPoint(position.x, position.y);\n        element.style.display = '';\n        return target;\n    };\n    RowDD.prototype.onDataBound = function () {\n        if (this.selectedRowColls.length > 0) {\n            this.parent.selectRows(this.selectedRowColls);\n            this.selectedRowColls = [];\n        }\n    };\n    RowDD.prototype.getTargetIdx = function (targetRow) {\n        return targetRow ? parseInt(targetRow.getAttribute(literals.ariaRowIndex), 10) : 0;\n    };\n    RowDD.prototype.singleRowDrop = function (e) {\n        var targetRow = closestElement(e.target, 'tr');\n        var srcControl = e.droppedElement.parentElement.ej2_instances[0];\n        var currentIndex = targetRow ? targetRow.rowIndex : srcControl.currentViewData.length - 1;\n        this.reorderRow(this.startedRowIndex, currentIndex);\n    };\n    RowDD.prototype.columnDrop = function (e) {\n        var gObj = this.parent;\n        if (e.droppedElement.getAttribute('action') !== 'grouping' &&\n            (parentsUntil(e.target, literals.row) || parentsUntil(e.target, 'e-emptyrow') || parentsUntil(e.target, literals.gridContent))) {\n            var targetRow = closestElement(e.target, 'tr');\n            var srcControl = void 0;\n            var currentIndex = void 0;\n            if ((e.droppedElement.querySelector('tr').getAttribute('single-dragrow') !== 'true' &&\n                e.droppedElement.parentElement.id === gObj.element.id)\n                || (e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true' &&\n                    e.droppedElement.parentElement.id !== gObj.element.id)) {\n                return;\n            }\n            if (e.droppedElement.parentElement.id !== gObj.element.id) {\n                srcControl = e.droppedElement.parentElement.ej2_instances[0];\n            }\n            else if (this.isSingleRowDragDrop || e.droppedElement.querySelector('tr').getAttribute('single-dragrow') === 'true') {\n                this.singleRowDrop(e);\n                return;\n            }\n            if (srcControl.element.id !== gObj.element.id && srcControl.rowDropSettings.targetID !== gObj.element.id) {\n                return;\n            }\n            var records = srcControl.getSelectedRecords();\n            var targetIndex = currentIndex = this.getTargetIdx(targetRow);\n            if (isNaN(targetIndex)) {\n                // eslint-disable-next-line @typescript-eslint/no-unused-vars\n                targetIndex = currentIndex = 0;\n            }\n            if (gObj.allowPaging) {\n                targetIndex = targetIndex + (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize;\n            }\n            //Todo: drag and drop mapper & BatchChanges\n            gObj.notify(events.rowsAdded, { toIndex: targetIndex, records: records });\n            gObj.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n            var selectedRows = srcControl.getSelectedRowIndexes();\n            var skip = srcControl.allowPaging ?\n                (srcControl.pageSettings.currentPage * srcControl.pageSettings.pageSize) - srcControl.pageSettings.pageSize : 0;\n            this.selectedRows = [];\n            for (var i = 0, len = records.length; i < len; i++) {\n                this.selectedRows.push(skip + selectedRows[i]);\n            }\n            srcControl.notify(events.rowsRemoved, { indexes: this.selectedRows, records: records });\n            srcControl.notify(events.modelChanged, {\n                type: events.actionBegin, requestType: 'rowdraganddrop'\n            });\n        }\n    };\n    RowDD.prototype.reorderRow = function (fromIndexes, toIndex) {\n        var gObj = this.parent;\n        if (!gObj.sortSettings.columns.length && !gObj.groupSettings.columns.length && !gObj.filterSettings.columns.length) {\n            //Todo: drag and drop mapper & BatchChanges\n            var skip = gObj.allowPaging ?\n                (gObj.pageSettings.currentPage * gObj.pageSettings.pageSize) - gObj.pageSettings.pageSize : 0;\n            // eslint-disable-next-line @typescript-eslint/no-unused-vars\n            var fromIndex = fromIndexes;\n            toIndex = toIndex + skip;\n            this.selectedRows = gObj.getSelectedRowIndexes();\n            gObj.notify(events.rowPositionChanged, {\n                fromIndex: fromIndexes + skip,\n                toIndex: toIndex\n            });\n        }\n    };\n    RowDD.prototype.enableAfterRender = function (e) {\n        if (e.module === this.getModuleName() && e.enable) {\n            this.initializeDrag();\n        }\n    };\n    /**\n     * To destroy the print\n     *\n     * @returns {void}\n     * @hidden\n     */\n    RowDD.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (this.parent.isDestroyed || !gridElement || (!gridElement.querySelector('.' + literals.gridHeader) &&\n            !gridElement.querySelector('.' + literals.gridContent))) {\n            return;\n        }\n        this.draggable.destroy();\n        this.parent.off(events.initialEnd, this.initializeDrag);\n        this.parent.off(events.columnDrop, this.columnDrop);\n        this.parent.removeEventListener(events.dataBound, this.onDataBoundFn);\n        this.parent.off(events.uiUpdate, this.enableAfterRender);\n        //destory ejdrag and drop\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} returns the module name\n     * @private\n     */\n    RowDD.prototype.getModuleName = function () {\n        return 'rowDragAndDrop';\n    };\n    // eslint-disable-next-line @typescript-eslint/no-unused-vars\n    RowDD.prototype.processArgs = function (target) {\n        var gObj = this.parent;\n        var dragIdx = parseInt(this.startedRow.getAttribute(literals.ariaRowIndex), 10);\n        if ((gObj.getSelectedRecords().length > 0 && this.startedRow.cells[0].classList.contains('e-selectionbackground') === false)\n            || gObj.getSelectedRecords().length === 0) {\n            this.rows = [this.parent.getRowByIndex(dragIdx)];\n            if (gObj.isFrozenGrid()) {\n                this.rows = [gObj.getRowByIndex(dragIdx), gObj.getMovableRowByIndex(dragIdx)];\n                if (gObj.getFrozenMode() === literals.leftRight) {\n                    this.rows = [gObj.getRowByIndex(dragIdx), gObj.getMovableRowByIndex(dragIdx), gObj.getFrozenRightRowByIndex(dragIdx)];\n                }\n            }\n            this.rowData = [this.parent.getRowInfo((this.startedRow).querySelector('.' + literals.rowCell)).rowData];\n        }\n        else {\n            this.rows = gObj.getSelectedRows();\n            this.rowData = gObj.getSelectedRecords();\n            if (this.parent.enableVirtualization) {\n                this.rows = [];\n                var selIndex = gObj.getSelectedRowIndexes();\n                for (var i = 0, len = selIndex.length; i < len; i++) {\n                    this.rows.push(gObj.getRowByIndex(selIndex[i]));\n                    if (gObj.isFrozenGrid()) {\n                        this.rows.push(gObj.getMovableRowByIndex(selIndex[i]));\n                        if (gObj.getFrozenMode() === literals.leftRight) {\n                            this.rows.push(gObj.getFrozenRightRowByIndex(selIndex[i]));\n                        }\n                    }\n                }\n            }\n        }\n    };\n    return RowDD;\n}());\nexport { RowDD };\n"]},"metadata":{},"sourceType":"module"}