{"ast":null,"code":"import { remove, extend, getValue } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { uiUpdate, initialEnd, dataReady, modelChanged, refreshAggregates, refreshFooterRenderer, groupAggregates } from '../base/constant';\nimport { FooterRenderer } from '../renderer/footer-renderer';\nimport { SummaryCellRenderer } from '../renderer/summary-cell-renderer';\nimport { GroupSummaryModelGenerator, CaptionSummaryModelGenerator } from '../services/summary-model-generator';\nimport * as literals from '../base/string-literals';\n/**\n * Summary Action controller.\n */\n\nvar Aggregate =\n/** @class */\nfunction () {\n  function Aggregate(parent, locator) {\n    this.parent = parent;\n    this.locator = locator;\n    this.addEventListener();\n  }\n\n  Aggregate.prototype.getModuleName = function () {\n    return 'aggregate';\n  };\n\n  Aggregate.prototype.initiateRender = function () {\n    var _this = this;\n\n    var cellFac = this.locator.getService('cellRendererFactory');\n    var instance = new SummaryCellRenderer(this.parent, this.locator);\n    var type = [CellType.Summary, CellType.CaptionSummary, CellType.GroupSummary];\n\n    for (var i = 0; i < type.length; i++) {\n      cellFac.addCellRenderer(type[i], instance);\n    }\n\n    this.footerRenderer = new FooterRenderer(this.parent, this.locator);\n    this.footerRenderer.renderPanel();\n    this.footerRenderer.renderTable();\n    var footerContent = this.footerRenderer.getPanel();\n\n    if (this.parent.element.scrollHeight >= this.parent.getHeight(this.parent.height) && footerContent) {\n      addClass([footerContent], ['e-footerpadding']);\n    }\n\n    this.locator.register('footerRenderer', this.footerRenderer);\n\n    var fn = function () {\n      _this.prepareSummaryInfo();\n\n      _this.parent.off(dataReady, fn);\n    };\n\n    this.parent.on(dataReady, fn, this);\n    this.parent.on(dataReady, this.footerRenderer.refresh, this.footerRenderer);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Aggregate.prototype.prepareSummaryInfo = function () {\n    var _this = this;\n\n    summaryIterator(this.parent.aggregates, function (column) {\n      var cFormat = getValue('customFormat', column);\n\n      if (!isNullOrUndefined(cFormat)) {\n        column.setPropertiesSilent({\n          format: cFormat\n        });\n      }\n\n      if (typeof column.format === 'object') {\n        var valueFormatter = new ValueFormatter();\n        column.setFormatter(valueFormatter.getFormatFunction(extend({}, column.format)));\n      } else if (typeof column.format === 'string') {\n        var fmtr = _this.locator.getService('valueFormatter');\n\n        column.setFormatter(fmtr.getFormatFunction({\n          format: column.format\n        }));\n      }\n\n      column.setPropertiesSilent({\n        columnName: column.columnName || column.field\n      });\n    });\n  };\n\n  Aggregate.prototype.onPropertyChanged = function (e) {\n    if (e.module !== this.getModuleName()) {\n      return;\n    }\n\n    if (isNullOrUndefined(this.footerRenderer)) {\n      this.initiateRender();\n    }\n\n    this.prepareSummaryInfo();\n    this.footerRenderer.refresh();\n    var cModel = new CaptionSummaryModelGenerator(this.parent);\n    var gModel = new GroupSummaryModelGenerator(this.parent);\n\n    if (gModel.getData().length !== 0 || !cModel.isEmpty()) {\n      this.parent.notify(modelChanged, {});\n    }\n  };\n\n  Aggregate.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(initialEnd, this.initiateRender, this);\n    this.parent.on(uiUpdate, this.onPropertyChanged, this);\n    this.parent.on(refreshAggregates, this.refresh, this);\n  };\n\n  Aggregate.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.footerRenderer.removeEventListener();\n    this.parent.off(initialEnd, this.initiateRender);\n    this.parent.off(dataReady, this.footerRenderer.refresh);\n    this.parent.off(uiUpdate, this.onPropertyChanged);\n    this.parent.off(refreshAggregates, this.refresh);\n  };\n\n  Aggregate.prototype.destroy = function () {\n    this.removeEventListener();\n    remove(this.parent.element.querySelector('.' + literals.gridFooter));\n  };\n\n  Aggregate.prototype.refresh = function (data) {\n    var editedData = data instanceof Array ? data : [data];\n    this.parent.notify(refreshFooterRenderer, editedData);\n\n    if (this.parent.groupSettings.columns.length > 0) {\n      this.parent.notify(groupAggregates, editedData);\n    }\n  };\n\n  return Aggregate;\n}();\n\nexport { Aggregate };\n/**\n * @param {AggregateRowModel[]} aggregates - specifies the AggregateRowModel\n * @param {Function} callback - specifies the Function\n * @returns {void}\n * @private\n */\n\nexport function summaryIterator(aggregates, callback) {\n  for (var i = 0; i < aggregates.length; i++) {\n    for (var j = 0; j < aggregates[i].columns.length; j++) {\n      callback(aggregates[i].columns[j], aggregates[i]);\n    }\n  }\n}","map":{"version":3,"sources":["/Users/zhouzhou/Desktop/lightfront/node_modules/@syncfusion/ej2-grids/src/grid/actions/aggregate.js"],"names":["remove","extend","getValue","isNullOrUndefined","addClass","CellType","ValueFormatter","uiUpdate","initialEnd","dataReady","modelChanged","refreshAggregates","refreshFooterRenderer","groupAggregates","FooterRenderer","SummaryCellRenderer","GroupSummaryModelGenerator","CaptionSummaryModelGenerator","literals","Aggregate","parent","locator","addEventListener","prototype","getModuleName","initiateRender","_this","cellFac","getService","instance","type","Summary","CaptionSummary","GroupSummary","i","length","addCellRenderer","footerRenderer","renderPanel","renderTable","footerContent","getPanel","element","scrollHeight","getHeight","height","register","fn","prepareSummaryInfo","off","on","refresh","summaryIterator","aggregates","column","cFormat","setPropertiesSilent","format","valueFormatter","setFormatter","getFormatFunction","fmtr","columnName","field","onPropertyChanged","e","module","cModel","gModel","getData","isEmpty","notify","isDestroyed","removeEventListener","destroy","querySelector","gridFooter","data","editedData","Array","groupSettings","columns","callback","j"],"mappings":"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","sourcesContent":["import { remove, extend, getValue } from '@syncfusion/ej2-base';\nimport { isNullOrUndefined, addClass } from '@syncfusion/ej2-base';\nimport { CellType } from '../base/enum';\nimport { ValueFormatter } from '../services/value-formatter';\nimport { uiUpdate, initialEnd, dataReady, modelChanged, refreshAggregates, refreshFooterRenderer, groupAggregates } from '../base/constant';\nimport { FooterRenderer } from '../renderer/footer-renderer';\nimport { SummaryCellRenderer } from '../renderer/summary-cell-renderer';\nimport { GroupSummaryModelGenerator, CaptionSummaryModelGenerator } from '../services/summary-model-generator';\nimport * as literals from '../base/string-literals';\n/**\n * Summary Action controller.\n */\nvar Aggregate = /** @class */ (function () {\n    function Aggregate(parent, locator) {\n        this.parent = parent;\n        this.locator = locator;\n        this.addEventListener();\n    }\n    Aggregate.prototype.getModuleName = function () {\n        return 'aggregate';\n    };\n    Aggregate.prototype.initiateRender = function () {\n        var _this = this;\n        var cellFac = this.locator.getService('cellRendererFactory');\n        var instance = new SummaryCellRenderer(this.parent, this.locator);\n        var type = [CellType.Summary, CellType.CaptionSummary, CellType.GroupSummary];\n        for (var i = 0; i < type.length; i++) {\n            cellFac.addCellRenderer(type[i], instance);\n        }\n        this.footerRenderer = new FooterRenderer(this.parent, this.locator);\n        this.footerRenderer.renderPanel();\n        this.footerRenderer.renderTable();\n        var footerContent = this.footerRenderer.getPanel();\n        if (this.parent.element.scrollHeight >= this.parent.getHeight(this.parent.height)\n            && footerContent) {\n            addClass([footerContent], ['e-footerpadding']);\n        }\n        this.locator.register('footerRenderer', this.footerRenderer);\n        var fn = function () {\n            _this.prepareSummaryInfo();\n            _this.parent.off(dataReady, fn);\n        };\n        this.parent.on(dataReady, fn, this);\n        this.parent.on(dataReady, this.footerRenderer.refresh, this.footerRenderer);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Aggregate.prototype.prepareSummaryInfo = function () {\n        var _this = this;\n        summaryIterator(this.parent.aggregates, function (column) {\n            var cFormat = getValue('customFormat', column);\n            if (!isNullOrUndefined(cFormat)) {\n                column.setPropertiesSilent({ format: cFormat });\n            }\n            if (typeof (column.format) === 'object') {\n                var valueFormatter = new ValueFormatter();\n                column.setFormatter(valueFormatter.getFormatFunction(extend({}, column.format)));\n            }\n            else if (typeof (column.format) === 'string') {\n                var fmtr = _this.locator.getService('valueFormatter');\n                column.setFormatter(fmtr.getFormatFunction({ format: column.format }));\n            }\n            column.setPropertiesSilent({ columnName: column.columnName || column.field });\n        });\n    };\n    Aggregate.prototype.onPropertyChanged = function (e) {\n        if (e.module !== this.getModuleName()) {\n            return;\n        }\n        if (isNullOrUndefined(this.footerRenderer)) {\n            this.initiateRender();\n        }\n        this.prepareSummaryInfo();\n        this.footerRenderer.refresh();\n        var cModel = new CaptionSummaryModelGenerator(this.parent);\n        var gModel = new GroupSummaryModelGenerator(this.parent);\n        if (gModel.getData().length !== 0 || !cModel.isEmpty()) {\n            this.parent.notify(modelChanged, {});\n        }\n    };\n    Aggregate.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(initialEnd, this.initiateRender, this);\n        this.parent.on(uiUpdate, this.onPropertyChanged, this);\n        this.parent.on(refreshAggregates, this.refresh, this);\n    };\n    Aggregate.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.footerRenderer.removeEventListener();\n        this.parent.off(initialEnd, this.initiateRender);\n        this.parent.off(dataReady, this.footerRenderer.refresh);\n        this.parent.off(uiUpdate, this.onPropertyChanged);\n        this.parent.off(refreshAggregates, this.refresh);\n    };\n    Aggregate.prototype.destroy = function () {\n        this.removeEventListener();\n        remove(this.parent.element.querySelector('.' + literals.gridFooter));\n    };\n    Aggregate.prototype.refresh = function (data) {\n        var editedData = data instanceof Array ? data : [data];\n        this.parent.notify(refreshFooterRenderer, editedData);\n        if (this.parent.groupSettings.columns.length > 0) {\n            this.parent.notify(groupAggregates, editedData);\n        }\n    };\n    return Aggregate;\n}());\nexport { Aggregate };\n/**\n * @param {AggregateRowModel[]} aggregates - specifies the AggregateRowModel\n * @param {Function} callback - specifies the Function\n * @returns {void}\n * @private\n */\nexport function summaryIterator(aggregates, callback) {\n    for (var i = 0; i < aggregates.length; i++) {\n        for (var j = 0; j < aggregates[i].columns.length; j++) {\n            callback(aggregates[i].columns[j], aggregates[i]);\n        }\n    }\n}\n"]},"metadata":{},"sourceType":"module"}