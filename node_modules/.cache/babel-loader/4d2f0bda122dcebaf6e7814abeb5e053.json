{"ast":null,"code":"import { EventHandler, detach, formatUnit, Browser, closest } from '@syncfusion/ej2-base';\nimport { Column } from '../models/column';\nimport { ColumnWidthService } from '../services/width-controller';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, parentsUntil, gridActionHandler, Global } from '../base/util';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as literals from '../base/string-literals';\nexport var resizeClassList = {\n  root: 'e-rhandler',\n  suppress: 'e-rsuppress',\n  icon: 'e-ricon',\n  helper: 'e-rhelper',\n  header: 'th.e-headercell',\n  cursor: 'e-rcursor'\n};\n/**\n * `Resize` module is used to handle Resize to fit for columns.\n *\n * @hidden\n * @private\n */\n\nvar Resize =\n/** @class */\nfunction () {\n  /**\n   * Constructor for the Grid resize module\n   *\n   * @param {IGrid} parent - specifies the IGrid\n   * @hidden\n   */\n  function Resize(parent) {\n    this.tapped = false;\n    this.isDblClk = true;\n    this.parent = parent;\n\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.widthService = new ColumnWidthService(parent);\n    this.addEventListener();\n  }\n  /**\n   * Resize by field names.\n   *\n   * @param  {string|string[]} fName - Defines the field name.\n   * @returns {void}\n   */\n\n\n  Resize.prototype.autoFitColumns = function (fName) {\n    var columnName = fName === undefined || fName === null || fName.length <= 0 ? this.parent.getColumns().map(function (x) {\n      return x.field;\n    }) : typeof fName === 'string' ? [fName] : fName;\n    this.findColumn(columnName);\n  };\n\n  Resize.prototype.autoFit = function () {\n    var newarray = this.parent.getColumns().filter(function (c) {\n      return c.autoFit === true;\n    }).map(function (c) {\n      return c.field || c.headerText;\n    });\n\n    if (newarray.length > 0) {\n      this.autoFitColumns(newarray);\n    }\n\n    if (this.parent.resizeSettings.mode === 'Auto') {\n      this.widthService.setWidthToTable();\n    }\n  };\n\n  Resize.prototype.resizeColumn = function (fName, index, id) {\n    var gObj = this.parent;\n    var tWidth = 0;\n    var headerTable;\n    var contentTable;\n    var footerTable;\n    var headerDivTag = 'e-gridheader';\n    var contentDivTag = literals.gridContent;\n    var footerDivTag = literals.gridFooter;\n    var indentWidth = 0;\n    var uid = id ? id : this.parent.getUidByColumnField(fName);\n    var columnIndex = this.parent.getNormalizedColumnIndex(uid);\n    var headerTextClone;\n    var contentTextClone;\n    var footerTextClone;\n    var columnIndexByField = this.parent.getColumnIndexByField(fName);\n    var left = gObj.getFrozenColumns() || gObj.getFrozenLeftColumnsCount();\n    var movable = gObj.getMovableColumnsCount();\n\n    if (!isNullOrUndefined(gObj.getFooterContent())) {\n      footerTable = gObj.getFooterContentTable();\n    }\n\n    if (gObj.isFrozenGrid()) {\n      var col = gObj.getColumnByField(fName);\n\n      if (col.getFreezeTableName() === literals.frozenLeft) {\n        headerTable = gObj.getHeaderTable();\n        contentTable = gObj.getContentTable();\n        headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n        contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \")\");\n\n        if (footerTable) {\n          footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \")\");\n        }\n      } else if (col.getFreezeTableName() === 'movable') {\n        headerTable = gObj.getHeaderContent().querySelector('.' + literals.movableHeader).children[0];\n        contentTable = gObj.getContent().querySelector('.' + literals.movableContent).children[0];\n        headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n        contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex - left + 1) + \")\");\n\n        if (footerTable) {\n          footerTable = gObj.getFooterContent().querySelector('.e-movablefootercontent').children[0];\n          footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex - left + 1) + \")\");\n        }\n      } else if (col.getFreezeTableName() === literals.frozenRight) {\n        headerTable = gObj.getHeaderContent().querySelector('.e-frozen-right-header').children[0];\n        contentTable = gObj.getContent().querySelector('.e-frozen-right-content').children[0];\n        headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n        contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex - (left + movable) + 1) + \")\");\n\n        if (footerTable) {\n          footerTable = gObj.getFooterContent().querySelector('.e-movablefootercontent').children[0];\n          footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex - (left + movable) + 1) + \")\");\n        }\n      }\n    } else {\n      headerTable = gObj.getHeaderTable();\n      contentTable = gObj.getContentTable();\n      headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n      contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \"):not(.e-groupcaption)\");\n\n      if (footerTable) {\n        footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \"):not(.e-groupcaption)\");\n      }\n    }\n\n    var indentWidthClone = [].slice.call(headerTable.querySelector('tr').getElementsByClassName('e-grouptopleftcell'));\n\n    if (indentWidthClone.length > 0) {\n      for (var i = 0; i < indentWidthClone.length; i++) {\n        indentWidth += indentWidthClone[i].offsetWidth;\n      }\n    }\n\n    var detailsElement = contentTable.querySelector('.e-detailrowcollapse') || contentTable.querySelector('.e-detailrowexpand');\n\n    if ((this.parent.detailTemplate || this.parent.childGrid) && detailsElement) {\n      indentWidth += detailsElement.offsetWidth;\n    }\n\n    var headerText = [headerTextClone];\n    var contentText = [];\n    var footerText = [];\n\n    if (footerTable) {\n      for (var i = 0; i < footerTextClone.length; i++) {\n        footerText[i] = footerTextClone[i].cloneNode(true);\n      }\n    }\n\n    for (var i = 0; i < contentTextClone.length; i++) {\n      contentText[i] = contentTextClone[i].cloneNode(true);\n    }\n\n    var wHeader = this.createTable(headerTable, headerText, headerDivTag);\n    var wContent = this.createTable(contentTable, contentText, contentDivTag);\n    var wFooter = null;\n\n    if (footerText.length) {\n      wFooter = this.createTable(footerTable, footerText, footerDivTag);\n    }\n\n    var columnbyindex = gObj.getColumns()[columnIndexByField];\n    var width = columnbyindex.width = formatUnit(Math.max(wHeader, wContent, wFooter));\n    var colMaxWidth = columnbyindex.maxWidth && parseFloat(columnbyindex.maxWidth.toString());\n\n    if (parseInt(width, 10) > colMaxWidth) {\n      columnbyindex.width = colMaxWidth;\n    }\n\n    this.widthService.setColumnWidth(gObj.getColumns()[columnIndexByField]);\n    var result = gObj.getColumns().some(function (x) {\n      return x.width === null || x.width === undefined || x.width.length <= 0;\n    });\n\n    if (result === false) {\n      var element = gObj.getColumns();\n\n      for (var i = 0; i < element.length; i++) {\n        if (element[i].visible) {\n          tWidth = tWidth + parseFloat(element[i].width);\n        }\n      }\n    }\n\n    var calcTableWidth = tWidth + indentWidth;\n\n    if (tWidth > 0 && !gObj.isFrozenGrid()) {\n      if (this.parent.detailTemplate || this.parent.childGrid) {\n        this.widthService.setColumnWidth(new Column({\n          width: '30px'\n        }));\n      }\n\n      if (this.parent.resizeSettings.mode === 'Auto') {\n        calcTableWidth = '100%';\n      }\n\n      headerTable.style.width = formatUnit(calcTableWidth);\n      contentTable.style.width = formatUnit(calcTableWidth);\n\n      if (!isNullOrUndefined(footerTable)) {\n        footerTable.style.width = formatUnit(calcTableWidth);\n      }\n    }\n\n    var tableWidth = headerTable.offsetWidth;\n    var contentwidth = gObj.getContent().scrollWidth;\n\n    if (contentwidth > tableWidth) {\n      headerTable.classList.add('e-tableborder');\n      contentTable.classList.add('e-tableborder');\n    } else {\n      headerTable.classList.remove('e-tableborder');\n      contentTable.classList.remove('e-tableborder');\n    }\n\n    if (!isNullOrUndefined(footerTable)) {\n      footerTable.classList.add('e-tableborder');\n    }\n  };\n  /**\n   * To destroy the resize\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Resize.prototype.destroy = function () {\n    var gridElement = this.parent.element;\n\n    if (!gridElement || !gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent)) {\n      return;\n    }\n\n    this.widthService = null;\n    this.unwireEvents();\n    this.removeEventListener();\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @returns {string} returns the module name\n   * @private\n   */\n\n\n  Resize.prototype.getModuleName = function () {\n    return 'resize';\n  };\n\n  Resize.prototype.findColumn = function (fName) {\n    for (var i = 0; i < fName.length; i++) {\n      var fieldName = fName[i];\n      var columnIndex = this.parent.getColumnIndexByField(fieldName);\n      var column = this.parent.getColumns()[columnIndex];\n\n      if (columnIndex > -1 && !isNullOrUndefined(column) && column.visible === true) {\n        this.resizeColumn(fieldName, columnIndex);\n      }\n    }\n  };\n  /**\n   * To create table for autofit\n   *\n   * @param {Element} table - specifies the table\n   * @param {Element[]} text - specifies the text\n   * @param {string} tag - specifies the tag name\n   * @returns {number} returns the number\n   * @hidden\n   */\n\n\n  Resize.prototype.createTable = function (table, text, tag) {\n    var myTableDiv = this.parent.createElement('div');\n    myTableDiv.className = this.parent.element.className;\n    myTableDiv.style.cssText = 'display: inline-block;visibility:hidden;position:absolute';\n    var mySubDiv = this.parent.createElement('div');\n    mySubDiv.className = tag;\n    var myTable = this.parent.createElement('table');\n    myTable.className = table.className;\n    myTable.classList.add('e-resizetable');\n    myTable.style.cssText = 'table-layout: auto;width: auto';\n    var myTr = this.parent.createElement('tr');\n\n    for (var i = 0; i < text.length; i++) {\n      var tr = myTr.cloneNode();\n      tr.className = table.querySelector('tr').className;\n      tr.appendChild(text[i]);\n      myTable.appendChild(tr);\n    }\n\n    mySubDiv.appendChild(myTable);\n    myTableDiv.appendChild(mySubDiv);\n    document.body.appendChild(myTableDiv);\n    var offsetWidthValue = myTable.getBoundingClientRect().width;\n    document.body.removeChild(myTableDiv);\n    return Math.ceil(offsetWidthValue);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Resize.prototype.addEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.on(events.headerRefreshed, this.refreshHeight, this);\n    this.parent.on(events.initialEnd, this.wireEvents, this);\n    this.parent.on(events.contentReady, this.autoFit, this);\n    this.parent.on(events.refreshHandlers, this.refreshHeight, this);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Resize.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.headerRefreshed, this.refreshHeight);\n    this.parent.off(events.initialEnd, this.wireEvents);\n    this.parent.off(events.refreshHandlers, this.refreshHeight);\n  };\n  /**\n   * @returns {void}\n   * @hidden\n   */\n\n\n  Resize.prototype.render = function () {\n    this.unwireEvents();\n    this.wireEvents();\n    this.setHandlerHeight();\n  };\n\n  Resize.prototype.refreshHeight = function () {\n    var element = this.getResizeHandlers();\n\n    for (var i = 0; i < element.length; i++) {\n      if (element[i].parentElement.offsetHeight > 0) {\n        element[i].style.height = element[i].parentElement.offsetHeight + 'px';\n      }\n    }\n\n    this.setHandlerHeight();\n  };\n\n  Resize.prototype.wireEvents = function () {\n    EventHandler.add(this.parent.getHeaderContent(), Browser.touchStartEvent, this.touchResizeStart, this);\n    EventHandler.add(this.parent.getHeaderContent(), events.dblclick, this.callAutoFit, this);\n  };\n\n  Resize.prototype.unwireEvents = function () {\n    EventHandler.remove(this.parent.getHeaderContent(), Browser.touchStartEvent, this.touchResizeStart);\n    EventHandler.remove(this.parent.getHeaderContent(), events.dblclick, this.callAutoFit);\n  };\n\n  Resize.prototype.getResizeHandlers = function () {\n    return this.parent.isFrozenGrid() ? [].slice.call(this.parent.getHeaderContent().getElementsByClassName(resizeClassList.root)) : [].slice.call(this.parent.getHeaderTable().getElementsByClassName(resizeClassList.root));\n  };\n\n  Resize.prototype.setHandlerHeight = function () {\n    var element = [].slice.call(this.parent.getHeaderTable().getElementsByClassName(resizeClassList.suppress));\n\n    for (var i = 0; i < element.length; i++) {\n      element[i].style.height = element[i].parentElement.offsetHeight + 'px';\n    }\n  };\n\n  Resize.prototype.callAutoFit = function (e) {\n    if (e.target.classList.contains('e-rhandler')) {\n      var col = this.getTargetColumn(e);\n\n      if (col.columns) {\n        return;\n      }\n\n      this.resizeColumn(col.field, this.parent.getNormalizedColumnIndex(col.uid), col.uid);\n      var header = closest(e.target, resizeClassList.header);\n      header.classList.add('e-resized');\n    }\n  };\n\n  Resize.prototype.touchResizeStart = function (e) {\n    if (!Global.timer) {\n      Global.timer = setTimeout(function () {\n        Global.timer = null;\n      }, 300);\n      return this.resizeStart(e);\n    } else {\n      clearTimeout(Global.timer);\n      Global.timer = null;\n      this.callAutoFit(e);\n    }\n  };\n\n  Resize.prototype.resizeStart = function (e) {\n    var _this = this;\n\n    if (e.target.classList.contains('e-rhandler')) {\n      if (!this.helper) {\n        if (this.getScrollBarWidth() === 0) {\n          if (this.parent.allowGrouping) {\n            for (var i = 0; i < this.parent.groupSettings.columns.length; i++) {\n              this.widthService.setColumnWidth(new Column({\n                width: '30px'\n              }), i);\n            }\n          }\n\n          for (var _i = 0, _a = this.refreshColumnWidth(); _i < _a.length; _i++) {\n            var col = _a[_i];\n            this.widthService.setColumnWidth(col);\n          }\n\n          this.widthService.setWidthToTable();\n        }\n\n        this.refreshStackedColumnWidth();\n        this.element = e.target;\n\n        if (this.parent.getVisibleFrozenColumns()) {\n          var mtbody = this.parent.getMovableContentTbody();\n          var ftbody = this.parent.getFrozenLeftContentTbody();\n          var frtbody = this.parent.getFrozenRightContentTbody();\n          var mtr = [].slice.call(mtbody.querySelectorAll('tr'));\n          var ftr = [].slice.call(ftbody.querySelectorAll('tr'));\n          var frTr = [];\n\n          if (this.parent.getFrozenMode() === literals.leftRight && frtbody) {\n            frTr = [].slice.call(frtbody.querySelectorAll('tr'));\n          }\n\n          var _loop_1 = function (i) {\n            gridActionHandler(this_1.parent, function (tableName, row) {\n              if (_this.parent.rowHeight) {\n                row[i].style.height = _this.parent.rowHeight + 'px';\n              } else {\n                row[i].style.removeProperty('height');\n              }\n            }, [ftr, mtr, frTr]);\n          };\n\n          var this_1 = this;\n\n          for (var i = 0; i < mtr.length; i++) {\n            _loop_1(i);\n          }\n        }\n\n        this.parentElementWidth = this.parent.element.getBoundingClientRect().width;\n        this.appendHelper();\n        this.column = this.getTargetColumn(e);\n        this.pageX = this.getPointX(e);\n\n        if (this.column.getFreezeTableName() === literals.frozenRight) {\n          if (this.parent.enableRtl) {\n            this.minMove = (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0) - parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString());\n          } else {\n            this.minMove = parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString()) - (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0);\n          }\n        } else if (this.parent.enableRtl) {\n          this.minMove = parseFloat(this.column.width.toString()) - (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0);\n        } else {\n          this.minMove = (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0) - parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString());\n        }\n\n        this.minMove += this.pageX;\n      }\n\n      if (Browser.isDevice && !this.helper.classList.contains(resizeClassList.icon)) {\n        this.helper.classList.add(resizeClassList.icon);\n        EventHandler.add(document, Browser.touchStartEvent, this.removeHelper, this);\n        EventHandler.add(this.helper, Browser.touchStartEvent, this.resizeStart, this);\n      } else {\n        var args = {\n          e: e,\n          column: this.column\n        };\n        this.parent.trigger(events.resizeStart, args, function (args) {\n          if (args.cancel || _this.parent.isEdit) {\n            _this.cancelResizeAction();\n\n            return;\n          }\n\n          EventHandler.add(document, Browser.touchEndEvent, _this.resizeEnd, _this);\n          EventHandler.add(_this.parent.element, Browser.touchMoveEvent, _this.resizing, _this);\n\n          _this.updateCursor('add');\n        });\n      }\n    }\n  };\n\n  Resize.prototype.cancelResizeAction = function (removeEvents) {\n    if (removeEvents) {\n      EventHandler.remove(this.parent.element, Browser.touchMoveEvent, this.resizing);\n      EventHandler.remove(document, Browser.touchEndEvent, this.resizeEnd);\n      this.updateCursor('remove');\n    }\n\n    if (Browser.isDevice) {\n      EventHandler.remove(document, Browser.touchStartEvent, this.removeHelper);\n      EventHandler.remove(this.helper, Browser.touchStartEvent, this.resizeStart);\n    }\n\n    detach(this.helper);\n    this.refresh();\n  };\n\n  Resize.prototype.getWidth = function (width, minWidth, maxWidth) {\n    if (minWidth && width < minWidth) {\n      return minWidth;\n    } else if (maxWidth && width > maxWidth) {\n      return maxWidth;\n    } else {\n      return width;\n    }\n  };\n\n  Resize.prototype.updateResizeEleHeight = function () {\n    var elements = [].slice.call(this.parent.getHeaderContent().getElementsByClassName('e-rhandler'));\n\n    for (var i = 0; i < elements.length; i++) {\n      elements[i].style.height = this.element.parentElement.offsetHeight + 'px';\n    }\n  };\n\n  Resize.prototype.getColData = function (column, mousemove) {\n    return {\n      width: parseFloat(isNullOrUndefined(this.widthService.getWidth(column)) || this.widthService.getWidth(column) === 'auto' ? '0' : this.widthService.getWidth(column).toString()) + mousemove,\n      minWidth: column.minWidth ? parseFloat(column.minWidth.toString()) : null,\n      maxWidth: column.maxWidth ? parseFloat(column.maxWidth.toString()) : null\n    };\n  };\n\n  Resize.prototype.resizing = function (e) {\n    if (isNullOrUndefined(this.column)) {\n      return;\n    }\n\n    var offsetWidth = 0;\n\n    if (isNullOrUndefined(this.column)) {\n      offsetWidth = parentsUntil(this.element, 'th').offsetWidth;\n    }\n\n    if (this.parent.allowTextWrap) {\n      this.updateResizeEleHeight();\n      this.setHelperHeight();\n    }\n\n    var pageX = this.getPointX(e);\n    var mousemove = this.parent.enableRtl ? -(pageX - this.pageX) : pageX - this.pageX;\n\n    if (this.column.getFreezeTableName() === literals.frozenRight) {\n      mousemove = this.parent.enableRtl ? pageX - this.pageX : this.pageX - pageX;\n    }\n\n    var colData = this.getColData(this.column, mousemove);\n\n    if (!colData.width) {\n      colData.width = closest(this.element, 'th').offsetWidth;\n    }\n\n    var width = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);\n    this.parent.log('resize_min_max', {\n      column: this.column,\n      width: width\n    });\n\n    if (this.column.getFreezeTableName() === literals.frozenRight) {\n      if (this.parent.enableRtl && this.minMove >= pageX || !this.parent.enableRtl && this.minMove <= pageX) {\n        width = this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 10;\n        this.pageX = pageX = this.minMove;\n      }\n    }\n\n    if (this.column.getFreezeTableName() !== literals.frozenRight && (!this.parent.enableRtl && this.minMove >= pageX || this.parent.enableRtl && this.minMove <= pageX) || this.column.getFreezeTableName() === literals.frozenRight && (this.parent.enableRtl && this.minMove >= pageX || !this.parent.enableRtl && this.minMove <= pageX)) {\n      width = this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 10;\n      this.pageX = pageX = this.minMove;\n    }\n\n    if (width !== parseFloat(isNullOrUndefined(this.column.width) || this.column.width === 'auto' ? offsetWidth.toString() : this.column.width.toString())) {\n      this.pageX = pageX;\n      this.column.width = formatUnit(width);\n      var args = {\n        e: e,\n        column: this.column\n      };\n      this.parent.trigger(events.onResize, args);\n\n      if (args.cancel) {\n        this.cancelResizeAction(true);\n        return;\n      }\n\n      var columns = [this.column];\n      var finalColumns = [this.column];\n\n      if (this.column.columns) {\n        columns = this.getSubColumns(this.column, []);\n        columns = this.calulateColumnsWidth(columns, false, mousemove);\n        finalColumns = this.calulateColumnsWidth(columns, true, mousemove);\n      }\n\n      for (var _i = 0, finalColumns_1 = finalColumns; _i < finalColumns_1.length; _i++) {\n        var col = finalColumns_1[_i];\n        this.widthService.setColumnWidth(col, null, 'resize');\n      }\n\n      this.updateHelper();\n    }\n\n    this.isDblClk = false;\n  };\n\n  Resize.prototype.calulateColumnsWidth = function (columns, isUpdate, mousemove) {\n    var finalColumns = [];\n\n    for (var _i = 0, columns_1 = columns; _i < columns_1.length; _i++) {\n      var col = columns_1[_i];\n      var totalWidth = 0;\n\n      for (var i = 0; i < columns.length; i++) {\n        totalWidth += parseFloat(columns[i].width.toString());\n      }\n\n      var colData = this.getColData(col, parseFloat(col.width) * mousemove / totalWidth);\n      var colWidth = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);\n\n      if (colWidth !== parseFloat(col.width.toString())) {\n        if (isUpdate) {\n          col.width = formatUnit(colWidth < 1 ? 1 : colWidth);\n        }\n\n        finalColumns.push(col);\n      }\n    }\n\n    return finalColumns;\n  };\n\n  Resize.prototype.getSubColumns = function (column, subColumns) {\n    for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.visible !== false && col.allowResizing) {\n        if (col.columns) {\n          this.getSubColumns(col, subColumns);\n        } else {\n          subColumns.push(col);\n        }\n      }\n    }\n\n    return subColumns;\n  };\n\n  Resize.prototype.resizeEnd = function (e) {\n    if (!this.helper || this.parent.isDestroyed) {\n      return;\n    }\n\n    EventHandler.remove(this.parent.element, Browser.touchMoveEvent, this.resizing);\n    EventHandler.remove(document, Browser.touchEndEvent, this.resizeEnd);\n    this.updateCursor('remove');\n    detach(this.helper);\n    var args = {\n      e: e,\n      column: this.column\n    };\n    var content = this.parent.getContent().querySelector('.' + literals.content);\n    var cTable = content.querySelector('.' + literals.movableContent) ? content.querySelector('.' + literals.movableContent) : content;\n\n    if (cTable.scrollHeight > cTable.clientHeight) {\n      this.parent.scrollModule.setPadding();\n      cTable.style.overflowY = 'scroll';\n    }\n\n    this.parent.trigger(events.resizeStop, args);\n    closest(this.element, '.e-headercell').classList.add('e-resized');\n\n    if (parentsUntil(this.element, 'e-frozenheader')) {\n      this.isFrozenColResized = true;\n    } else {\n      this.isFrozenColResized = false;\n    }\n\n    if (this.parent.isFrozenGrid()) {\n      this.parent.notify(events.freezeRender, {\n        case: 'textwrap'\n      });\n    }\n\n    if (this.parent.allowTextWrap) {\n      this.updateResizeEleHeight();\n      this.parent.notify(events.textWrapRefresh, {\n        case: 'textwrap'\n      });\n    }\n\n    this.refresh();\n    this.doubleTapEvent(e);\n    this.isDblClk = true;\n  };\n\n  Resize.prototype.getPointX = function (e) {\n    if (e.touches && e.touches.length) {\n      return e.touches[0].pageX;\n    } else {\n      return e.pageX;\n    }\n  };\n\n  Resize.prototype.refreshColumnWidth = function () {\n    var columns = this.parent.getColumns();\n\n    for (var _i = 0, _a = [].slice.apply(this.parent.getHeaderContent().querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n      var ele = _a[_i];\n\n      for (var _b = 0, columns_2 = columns; _b < columns_2.length; _b++) {\n        var column = columns_2[_b];\n\n        if (ele.querySelector('[e-mappinguid]') && ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === column.uid && column.visible) {\n          column.width = ele.getBoundingClientRect().width;\n          break;\n        }\n      }\n    }\n\n    return columns;\n  };\n\n  Resize.prototype.refreshStackedColumnWidth = function () {\n    for (var _i = 0, _a = this.parent.getStackedColumns(this.parent.columns); _i < _a.length; _i++) {\n      var stackedColumn = _a[_i];\n      stackedColumn.width = this.getStackedWidth(stackedColumn, 0);\n    }\n  };\n\n  Resize.prototype.getStackedWidth = function (column, width) {\n    for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {\n      var col = _a[_i];\n\n      if (col.visible !== false) {\n        if (col.columns) {\n          this.getStackedWidth(col, width);\n        } else {\n          width += col.width;\n        }\n      }\n    }\n\n    return width;\n  };\n\n  Resize.prototype.getTargetColumn = function (e) {\n    var cell = closest(e.target, resizeClassList.header);\n    cell = cell.querySelector('.e-headercelldiv') || cell.querySelector('.e-stackedheadercelldiv');\n    var uid = cell.getAttribute('e-mappinguid');\n    return this.parent.getColumnByUid(uid);\n  };\n\n  Resize.prototype.updateCursor = function (action) {\n    var headerRows = [].slice.call(this.parent.getHeaderContent().querySelectorAll('th'));\n    headerRows.push(this.parent.element);\n\n    for (var _i = 0, headerRows_1 = headerRows; _i < headerRows_1.length; _i++) {\n      var row = headerRows_1[_i];\n      row.classList[action](resizeClassList.cursor);\n    }\n  };\n\n  Resize.prototype.refresh = function () {\n    this.column = null;\n    this.pageX = null;\n    this.element = null;\n    this.helper = null;\n  };\n\n  Resize.prototype.appendHelper = function () {\n    this.helper = this.parent.createElement('div', {\n      className: resizeClassList.helper\n    });\n    this.parent.element.appendChild(this.helper);\n    this.setHelperHeight();\n  };\n\n  Resize.prototype.setHelperHeight = function () {\n    var isFrozen = this.parent.isFrozenGrid();\n    var height = isFrozen ? this.parent.getContent().querySelector('.' + literals.content).offsetHeight : this.parent.getContent().offsetHeight - this.getScrollBarWidth();\n    var rect = closest(this.element, resizeClassList.header);\n    var tr = [].slice.call(this.parent.getHeaderContent().querySelectorAll('tr'));\n    var right = this.parent.getFrozenRightColumnsCount();\n\n    if (isFrozen) {\n      if (parentsUntil(rect, literals.movableHeader)) {\n        tr = [].slice.call(this.parent.getHeaderContent().querySelector('.' + literals.movableHeader).querySelectorAll('tr'));\n      } else if (right && parentsUntil(rect, 'e-frozen-right-header')) {\n        tr = [].slice.call(this.parent.getHeaderContent().querySelector('.e-frozen-right-header').querySelectorAll('tr'));\n      } else {\n        tr = [].slice.call(this.parent.getHeaderContent().querySelector('.e-frozen-left-header').querySelectorAll('tr'));\n      }\n    }\n\n    for (var i = tr.indexOf(rect.parentElement); i < tr.length && i > -1; i++) {\n      height += tr[i].offsetHeight;\n    }\n\n    var pos = this.calcPos(rect);\n\n    if (parentsUntil(rect, 'e-frozen-right-header')) {\n      pos.left += this.parent.enableRtl ? rect.offsetWidth - 2 : 0 - 1;\n    } else {\n      pos.left += this.parent.enableRtl ? 0 - 1 : rect.offsetWidth - 2;\n    }\n\n    this.helper.style.cssText = 'height: ' + height + 'px; top: ' + pos.top + 'px; left:' + Math.floor(pos.left) + 'px;';\n\n    if (this.parent.enableVirtualization) {\n      this.helper.classList.add('e-virtual-rhandler');\n    }\n  };\n\n  Resize.prototype.getScrollBarWidth = function (height) {\n    var ele = this.parent.getContent().firstChild;\n    return ele.scrollHeight > ele.clientHeight && height || ele.scrollWidth > ele.clientWidth ? getScrollBarWidth() : 0;\n  };\n\n  Resize.prototype.removeHelper = function (e) {\n    var cls = e.target.classList;\n\n    if (!(cls.contains(resizeClassList.root) || cls.contains(resizeClassList.icon)) && this.helper) {\n      EventHandler.remove(document, Browser.touchStartEvent, this.removeHelper);\n      EventHandler.remove(this.helper, Browser.touchStartEvent, this.resizeStart);\n      detach(this.helper);\n      this.refresh();\n    }\n  };\n\n  Resize.prototype.updateHelper = function () {\n    var rect = closest(this.element, resizeClassList.header);\n    var left;\n\n    if (parentsUntil(rect, 'e-frozen-right-header')) {\n      left = Math.floor(this.calcPos(rect).left + (this.parent.enableRtl ? rect.offsetWidth - 2 : 0 - 1));\n    } else {\n      left = Math.floor(this.calcPos(rect).left + (this.parent.enableRtl ? 0 - 1 : rect.offsetWidth - 2));\n    }\n\n    var borderWidth = 2; // to maintain the helper inside of grid element.\n\n    if (left > this.parentElementWidth) {\n      left = this.parentElementWidth - borderWidth;\n    }\n\n    if (this.parent.isFrozenGrid()) {\n      var table = closest(rect, '.' + literals.table);\n      var fLeft = table.offsetLeft;\n\n      if (left < fLeft) {\n        left = fLeft;\n      }\n    }\n\n    this.helper.style.left = left + 'px';\n  };\n\n  Resize.prototype.calcPos = function (elem) {\n    var parentOffset = {\n      top: 0,\n      left: 0\n    };\n    var offset = elem.getBoundingClientRect();\n    var doc = elem.ownerDocument;\n    var offsetParent = parentsUntil(elem, 'e-grid') || doc.documentElement;\n\n    while (offsetParent && (offsetParent === doc.body || offsetParent === doc.documentElement) && offsetParent.style.position === 'static') {\n      offsetParent = offsetParent.parentNode;\n    }\n\n    if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n      parentOffset = offsetParent.getBoundingClientRect();\n    }\n\n    return {\n      top: offset.top - parentOffset.top,\n      left: offset.left - parentOffset.left\n    };\n  };\n\n  Resize.prototype.doubleTapEvent = function (e) {\n    var _this = this;\n\n    if (this.getUserAgent() && this.isDblClk) {\n      if (!this.tapped) {\n        this.tapped = setTimeout(function () {\n          _this.tapped = null;\n        }, 300);\n      } else {\n        clearTimeout(this.tapped);\n        this.callAutoFit(e);\n        this.tapped = null;\n      }\n    }\n  };\n\n  Resize.prototype.getUserAgent = function () {\n    var userAgent = Browser.userAgent.toLowerCase();\n    return /iphone|ipod|ipad/.test(userAgent);\n  };\n\n  Resize.prototype.timeoutHandler = function () {\n    this.tapped = null;\n  };\n\n  return Resize;\n}();\n\nexport { Resize };","map":{"version":3,"sources":["/Users/zhouzhou/Desktop/lightfront/node_modules/@syncfusion/ej2-grids/src/grid/actions/resize.js"],"names":["EventHandler","detach","formatUnit","Browser","closest","Column","ColumnWidthService","events","getScrollBarWidth","parentsUntil","gridActionHandler","Global","isNullOrUndefined","literals","resizeClassList","root","suppress","icon","helper","header","cursor","Resize","parent","tapped","isDblClk","isDestroyed","widthService","addEventListener","prototype","autoFitColumns","fName","columnName","undefined","length","getColumns","map","x","field","findColumn","autoFit","newarray","filter","c","headerText","resizeSettings","mode","setWidthToTable","resizeColumn","index","id","gObj","tWidth","headerTable","contentTable","footerTable","headerDivTag","contentDivTag","gridContent","footerDivTag","gridFooter","indentWidth","uid","getUidByColumnField","columnIndex","getNormalizedColumnIndex","headerTextClone","contentTextClone","footerTextClone","columnIndexByField","getColumnIndexByField","left","getFrozenColumns","getFrozenLeftColumnsCount","movable","getMovableColumnsCount","getFooterContent","getFooterContentTable","isFrozenGrid","col","getColumnByField","getFreezeTableName","frozenLeft","getHeaderTable","getContentTable","querySelector","parentElement","cloneNode","querySelectorAll","getHeaderContent","movableHeader","children","getContent","movableContent","frozenRight","indentWidthClone","slice","call","getElementsByClassName","i","offsetWidth","detailsElement","detailTemplate","childGrid","contentText","footerText","wHeader","createTable","wContent","wFooter","columnbyindex","width","Math","max","colMaxWidth","maxWidth","parseFloat","toString","parseInt","setColumnWidth","result","some","element","visible","calcTableWidth","style","tableWidth","contentwidth","scrollWidth","classList","add","remove","destroy","gridElement","gridHeader","unwireEvents","removeEventListener","getModuleName","fieldName","column","table","text","tag","myTableDiv","createElement","className","cssText","mySubDiv","myTable","myTr","tr","appendChild","document","body","offsetWidthValue","getBoundingClientRect","removeChild","ceil","on","headerRefreshed","refreshHeight","initialEnd","wireEvents","contentReady","refreshHandlers","off","render","setHandlerHeight","getResizeHandlers","offsetHeight","height","touchStartEvent","touchResizeStart","dblclick","callAutoFit","e","target","contains","getTargetColumn","columns","timer","setTimeout","resizeStart","clearTimeout","_this","allowGrouping","groupSettings","_i","_a","refreshColumnWidth","refreshStackedColumnWidth","getVisibleFrozenColumns","mtbody","getMovableContentTbody","ftbody","getFrozenLeftContentTbody","frtbody","getFrozenRightContentTbody","mtr","ftr","frTr","getFrozenMode","leftRight","_loop_1","this_1","tableName","row","rowHeight","removeProperty","parentElementWidth","appendHelper","pageX","getPointX","enableRtl","minMove","minWidth","isDevice","removeHelper","args","trigger","cancel","isEdit","cancelResizeAction","touchEndEvent","resizeEnd","touchMoveEvent","resizing","updateCursor","removeEvents","refresh","getWidth","updateResizeEleHeight","elements","getColData","mousemove","allowTextWrap","setHelperHeight","colData","log","onResize","finalColumns","getSubColumns","calulateColumnsWidth","finalColumns_1","updateHelper","isUpdate","columns_1","totalWidth","colWidth","push","subColumns","allowResizing","content","cTable","scrollHeight","clientHeight","scrollModule","setPadding","overflowY","resizeStop","isFrozenColResized","notify","freezeRender","case","textWrapRefresh","doubleTapEvent","touches","apply","ele","_b","columns_2","getAttribute","getStackedColumns","stackedColumn","getStackedWidth","cell","getColumnByUid","action","headerRows","headerRows_1","isFrozen","rect","right","getFrozenRightColumnsCount","indexOf","pos","calcPos","top","floor","enableVirtualization","firstChild","clientWidth","cls","borderWidth","fLeft","offsetLeft","elem","parentOffset","offset","doc","ownerDocument","offsetParent","documentElement","position","parentNode","nodeType","getUserAgent","userAgent","toLowerCase","test","timeoutHandler"],"mappings":"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","sourcesContent":["import { EventHandler, detach, formatUnit, Browser, closest } from '@syncfusion/ej2-base';\nimport { Column } from '../models/column';\nimport { ColumnWidthService } from '../services/width-controller';\nimport * as events from '../base/constant';\nimport { getScrollBarWidth, parentsUntil, gridActionHandler, Global } from '../base/util';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as literals from '../base/string-literals';\nexport var resizeClassList = {\n    root: 'e-rhandler',\n    suppress: 'e-rsuppress',\n    icon: 'e-ricon',\n    helper: 'e-rhelper',\n    header: 'th.e-headercell',\n    cursor: 'e-rcursor'\n};\n/**\n * `Resize` module is used to handle Resize to fit for columns.\n *\n * @hidden\n * @private\n */\nvar Resize = /** @class */ (function () {\n    /**\n     * Constructor for the Grid resize module\n     *\n     * @param {IGrid} parent - specifies the IGrid\n     * @hidden\n     */\n    function Resize(parent) {\n        this.tapped = false;\n        this.isDblClk = true;\n        this.parent = parent;\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.widthService = new ColumnWidthService(parent);\n        this.addEventListener();\n    }\n    /**\n     * Resize by field names.\n     *\n     * @param  {string|string[]} fName - Defines the field name.\n     * @returns {void}\n     */\n    Resize.prototype.autoFitColumns = function (fName) {\n        var columnName = (fName === undefined || fName === null || fName.length <= 0) ?\n            this.parent.getColumns().map(function (x) { return x.field; }) : (typeof fName === 'string') ? [fName] : fName;\n        this.findColumn(columnName);\n    };\n    Resize.prototype.autoFit = function () {\n        var newarray = this.parent.getColumns().filter(function (c) { return c.autoFit === true; })\n            .map(function (c) { return c.field || c.headerText; });\n        if (newarray.length > 0) {\n            this.autoFitColumns(newarray);\n        }\n        if (this.parent.resizeSettings.mode === 'Auto') {\n            this.widthService.setWidthToTable();\n        }\n    };\n    Resize.prototype.resizeColumn = function (fName, index, id) {\n        var gObj = this.parent;\n        var tWidth = 0;\n        var headerTable;\n        var contentTable;\n        var footerTable;\n        var headerDivTag = 'e-gridheader';\n        var contentDivTag = literals.gridContent;\n        var footerDivTag = literals.gridFooter;\n        var indentWidth = 0;\n        var uid = id ? id : this.parent.getUidByColumnField(fName);\n        var columnIndex = this.parent.getNormalizedColumnIndex(uid);\n        var headerTextClone;\n        var contentTextClone;\n        var footerTextClone;\n        var columnIndexByField = this.parent.getColumnIndexByField(fName);\n        var left = gObj.getFrozenColumns() || gObj.getFrozenLeftColumnsCount();\n        var movable = gObj.getMovableColumnsCount();\n        if (!isNullOrUndefined(gObj.getFooterContent())) {\n            footerTable = gObj.getFooterContentTable();\n        }\n        if (gObj.isFrozenGrid()) {\n            var col = gObj.getColumnByField(fName);\n            if (col.getFreezeTableName() === literals.frozenLeft) {\n                headerTable = gObj.getHeaderTable();\n                contentTable = gObj.getContentTable();\n                headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n                contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \")\");\n                if (footerTable) {\n                    footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \")\");\n                }\n            }\n            else if (col.getFreezeTableName() === 'movable') {\n                headerTable = gObj.getHeaderContent().querySelector('.' + literals.movableHeader).children[0];\n                contentTable = gObj.getContent().querySelector('.' + literals.movableContent).children[0];\n                headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n                contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + ((columnIndex - left) + 1) + \")\");\n                if (footerTable) {\n                    footerTable = gObj.getFooterContent().querySelector('.e-movablefootercontent').children[0];\n                    footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + ((columnIndex - left) + 1) + \")\");\n                }\n            }\n            else if (col.getFreezeTableName() === literals.frozenRight) {\n                headerTable = gObj.getHeaderContent().querySelector('.e-frozen-right-header').children[0];\n                contentTable = gObj.getContent().querySelector('.e-frozen-right-content').children[0];\n                headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n                contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + ((columnIndex - (left + movable)) + 1) + \")\");\n                if (footerTable) {\n                    footerTable = gObj.getFooterContent().querySelector('.e-movablefootercontent').children[0];\n                    footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + ((columnIndex - (left + movable)) + 1) + \")\");\n                }\n            }\n        }\n        else {\n            headerTable = gObj.getHeaderTable();\n            contentTable = gObj.getContentTable();\n            headerTextClone = headerTable.querySelector('[e-mappinguid=\"' + uid + '\"]').parentElement.cloneNode(true);\n            contentTextClone = contentTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \"):not(.e-groupcaption)\");\n            if (footerTable) {\n                footerTextClone = footerTable.querySelectorAll(\"td:nth-child(\" + (columnIndex + 1) + \"):not(.e-groupcaption)\");\n            }\n        }\n        var indentWidthClone = [].slice.call(headerTable.querySelector('tr').getElementsByClassName('e-grouptopleftcell'));\n        if (indentWidthClone.length > 0) {\n            for (var i = 0; i < indentWidthClone.length; i++) {\n                indentWidth += indentWidthClone[i].offsetWidth;\n            }\n        }\n        var detailsElement = contentTable.querySelector('.e-detailrowcollapse') ||\n            contentTable.querySelector('.e-detailrowexpand');\n        if ((this.parent.detailTemplate || this.parent.childGrid) && detailsElement) {\n            indentWidth += detailsElement.offsetWidth;\n        }\n        var headerText = [headerTextClone];\n        var contentText = [];\n        var footerText = [];\n        if (footerTable) {\n            for (var i = 0; i < footerTextClone.length; i++) {\n                footerText[i] = footerTextClone[i].cloneNode(true);\n            }\n        }\n        for (var i = 0; i < contentTextClone.length; i++) {\n            contentText[i] = contentTextClone[i].cloneNode(true);\n        }\n        var wHeader = this.createTable(headerTable, headerText, headerDivTag);\n        var wContent = this.createTable(contentTable, contentText, contentDivTag);\n        var wFooter = null;\n        if (footerText.length) {\n            wFooter = this.createTable(footerTable, footerText, footerDivTag);\n        }\n        var columnbyindex = gObj.getColumns()[columnIndexByField];\n        var width = columnbyindex.width = formatUnit(Math.max(wHeader, wContent, wFooter));\n        var colMaxWidth = columnbyindex.maxWidth && parseFloat(columnbyindex.maxWidth.toString());\n        if (parseInt(width, 10) > colMaxWidth) {\n            columnbyindex.width = colMaxWidth;\n        }\n        this.widthService.setColumnWidth(gObj.getColumns()[columnIndexByField]);\n        var result = gObj.getColumns().some(function (x) { return x.width === null\n            || x.width === undefined || x.width.length <= 0; });\n        if (result === false) {\n            var element = gObj.getColumns();\n            for (var i = 0; i < element.length; i++) {\n                if (element[i].visible) {\n                    tWidth = tWidth + parseFloat(element[i].width);\n                }\n            }\n        }\n        var calcTableWidth = tWidth + indentWidth;\n        if (tWidth > 0 && !gObj.isFrozenGrid()) {\n            if (this.parent.detailTemplate || this.parent.childGrid) {\n                this.widthService.setColumnWidth(new Column({ width: '30px' }));\n            }\n            if (this.parent.resizeSettings.mode === 'Auto') {\n                calcTableWidth = '100%';\n            }\n            headerTable.style.width = formatUnit(calcTableWidth);\n            contentTable.style.width = formatUnit(calcTableWidth);\n            if (!isNullOrUndefined(footerTable)) {\n                footerTable.style.width = formatUnit(calcTableWidth);\n            }\n        }\n        var tableWidth = headerTable.offsetWidth;\n        var contentwidth = (gObj.getContent().scrollWidth);\n        if (contentwidth > tableWidth) {\n            headerTable.classList.add('e-tableborder');\n            contentTable.classList.add('e-tableborder');\n        }\n        else {\n            headerTable.classList.remove('e-tableborder');\n            contentTable.classList.remove('e-tableborder');\n        }\n        if (!isNullOrUndefined(footerTable)) {\n            footerTable.classList.add('e-tableborder');\n        }\n    };\n    /**\n     * To destroy the resize\n     *\n     * @returns {void}\n     * @hidden\n     */\n    Resize.prototype.destroy = function () {\n        var gridElement = this.parent.element;\n        if (!gridElement || (!gridElement.querySelector('.' + literals.gridHeader) && !gridElement.querySelector('.' + literals.gridContent))) {\n            return;\n        }\n        this.widthService = null;\n        this.unwireEvents();\n        this.removeEventListener();\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @returns {string} returns the module name\n     * @private\n     */\n    Resize.prototype.getModuleName = function () {\n        return 'resize';\n    };\n    Resize.prototype.findColumn = function (fName) {\n        for (var i = 0; i < fName.length; i++) {\n            var fieldName = fName[i];\n            var columnIndex = this.parent.getColumnIndexByField(fieldName);\n            var column = this.parent.getColumns()[columnIndex];\n            if (columnIndex > -1 && !isNullOrUndefined(column) && column.visible === true) {\n                this.resizeColumn(fieldName, columnIndex);\n            }\n        }\n    };\n    /**\n     * To create table for autofit\n     *\n     * @param {Element} table - specifies the table\n     * @param {Element[]} text - specifies the text\n     * @param {string} tag - specifies the tag name\n     * @returns {number} returns the number\n     * @hidden\n     */\n    Resize.prototype.createTable = function (table, text, tag) {\n        var myTableDiv = this.parent.createElement('div');\n        myTableDiv.className = this.parent.element.className;\n        myTableDiv.style.cssText = 'display: inline-block;visibility:hidden;position:absolute';\n        var mySubDiv = this.parent.createElement('div');\n        mySubDiv.className = tag;\n        var myTable = this.parent.createElement('table');\n        myTable.className = table.className;\n        myTable.classList.add('e-resizetable');\n        myTable.style.cssText = 'table-layout: auto;width: auto';\n        var myTr = this.parent.createElement('tr');\n        for (var i = 0; i < text.length; i++) {\n            var tr = myTr.cloneNode();\n            tr.className = table.querySelector('tr').className;\n            tr.appendChild(text[i]);\n            myTable.appendChild(tr);\n        }\n        mySubDiv.appendChild(myTable);\n        myTableDiv.appendChild(mySubDiv);\n        document.body.appendChild(myTableDiv);\n        var offsetWidthValue = myTable.getBoundingClientRect().width;\n        document.body.removeChild(myTableDiv);\n        return Math.ceil(offsetWidthValue);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Resize.prototype.addEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.on(events.headerRefreshed, this.refreshHeight, this);\n        this.parent.on(events.initialEnd, this.wireEvents, this);\n        this.parent.on(events.contentReady, this.autoFit, this);\n        this.parent.on(events.refreshHandlers, this.refreshHeight, this);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Resize.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.headerRefreshed, this.refreshHeight);\n        this.parent.off(events.initialEnd, this.wireEvents);\n        this.parent.off(events.refreshHandlers, this.refreshHeight);\n    };\n    /**\n     * @returns {void}\n     * @hidden\n     */\n    Resize.prototype.render = function () {\n        this.unwireEvents();\n        this.wireEvents();\n        this.setHandlerHeight();\n    };\n    Resize.prototype.refreshHeight = function () {\n        var element = this.getResizeHandlers();\n        for (var i = 0; i < element.length; i++) {\n            if (element[i].parentElement.offsetHeight > 0) {\n                element[i].style.height = element[i].parentElement.offsetHeight + 'px';\n            }\n        }\n        this.setHandlerHeight();\n    };\n    Resize.prototype.wireEvents = function () {\n        EventHandler.add(this.parent.getHeaderContent(), Browser.touchStartEvent, this.touchResizeStart, this);\n        EventHandler.add(this.parent.getHeaderContent(), events.dblclick, this.callAutoFit, this);\n    };\n    Resize.prototype.unwireEvents = function () {\n        EventHandler.remove(this.parent.getHeaderContent(), Browser.touchStartEvent, this.touchResizeStart);\n        EventHandler.remove(this.parent.getHeaderContent(), events.dblclick, this.callAutoFit);\n    };\n    Resize.prototype.getResizeHandlers = function () {\n        return this.parent.isFrozenGrid() ?\n            [].slice.call(this.parent.getHeaderContent().getElementsByClassName(resizeClassList.root))\n            : [].slice.call(this.parent.getHeaderTable().getElementsByClassName(resizeClassList.root));\n    };\n    Resize.prototype.setHandlerHeight = function () {\n        var element = [].slice.call(this.parent.getHeaderTable().getElementsByClassName(resizeClassList.suppress));\n        for (var i = 0; i < element.length; i++) {\n            element[i].style.height = element[i].parentElement.offsetHeight + 'px';\n        }\n    };\n    Resize.prototype.callAutoFit = function (e) {\n        if (e.target.classList.contains('e-rhandler')) {\n            var col = this.getTargetColumn(e);\n            if (col.columns) {\n                return;\n            }\n            this.resizeColumn(col.field, this.parent.getNormalizedColumnIndex(col.uid), col.uid);\n            var header = closest(e.target, resizeClassList.header);\n            header.classList.add('e-resized');\n        }\n    };\n    Resize.prototype.touchResizeStart = function (e) {\n        if (!Global.timer) {\n            Global.timer = setTimeout(function () {\n                Global.timer = null;\n            }, 300);\n            return this.resizeStart(e);\n        }\n        else {\n            clearTimeout(Global.timer);\n            Global.timer = null;\n            this.callAutoFit(e);\n        }\n    };\n    Resize.prototype.resizeStart = function (e) {\n        var _this = this;\n        if (e.target.classList.contains('e-rhandler')) {\n            if (!this.helper) {\n                if (this.getScrollBarWidth() === 0) {\n                    if (this.parent.allowGrouping) {\n                        for (var i = 0; i < this.parent.groupSettings.columns.length; i++) {\n                            this.widthService.setColumnWidth(new Column({ width: '30px' }), i);\n                        }\n                    }\n                    for (var _i = 0, _a = this.refreshColumnWidth(); _i < _a.length; _i++) {\n                        var col = _a[_i];\n                        this.widthService.setColumnWidth(col);\n                    }\n                    this.widthService.setWidthToTable();\n                }\n                this.refreshStackedColumnWidth();\n                this.element = e.target;\n                if (this.parent.getVisibleFrozenColumns()) {\n                    var mtbody = this.parent.getMovableContentTbody();\n                    var ftbody = this.parent.getFrozenLeftContentTbody();\n                    var frtbody = this.parent.getFrozenRightContentTbody();\n                    var mtr = [].slice.call(mtbody.querySelectorAll('tr'));\n                    var ftr = [].slice.call(ftbody.querySelectorAll('tr'));\n                    var frTr = [];\n                    if (this.parent.getFrozenMode() === literals.leftRight && frtbody) {\n                        frTr = [].slice.call(frtbody.querySelectorAll('tr'));\n                    }\n                    var _loop_1 = function (i) {\n                        gridActionHandler(this_1.parent, function (tableName, row) {\n                            if (_this.parent.rowHeight) {\n                                row[i].style.height = _this.parent.rowHeight + 'px';\n                            }\n                            else {\n                                row[i].style.removeProperty('height');\n                            }\n                        }, [ftr, mtr, frTr]);\n                    };\n                    var this_1 = this;\n                    for (var i = 0; i < mtr.length; i++) {\n                        _loop_1(i);\n                    }\n                }\n                this.parentElementWidth = this.parent.element.getBoundingClientRect().width;\n                this.appendHelper();\n                this.column = this.getTargetColumn(e);\n                this.pageX = this.getPointX(e);\n                if (this.column.getFreezeTableName() === literals.frozenRight) {\n                    if (this.parent.enableRtl) {\n                        this.minMove = (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0)\n                            - parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString());\n                    }\n                    else {\n                        this.minMove = parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString())\n                            - (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0);\n                    }\n                }\n                else if (this.parent.enableRtl) {\n                    this.minMove = parseFloat(this.column.width.toString())\n                        - (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0);\n                }\n                else {\n                    this.minMove = (this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 0)\n                        - parseFloat(isNullOrUndefined(this.column.width) ? '' : this.column.width.toString());\n                }\n                this.minMove += this.pageX;\n            }\n            if (Browser.isDevice && !this.helper.classList.contains(resizeClassList.icon)) {\n                this.helper.classList.add(resizeClassList.icon);\n                EventHandler.add(document, Browser.touchStartEvent, this.removeHelper, this);\n                EventHandler.add(this.helper, Browser.touchStartEvent, this.resizeStart, this);\n            }\n            else {\n                var args = { e: e, column: this.column };\n                this.parent.trigger(events.resizeStart, args, function (args) {\n                    if (args.cancel || _this.parent.isEdit) {\n                        _this.cancelResizeAction();\n                        return;\n                    }\n                    EventHandler.add(document, Browser.touchEndEvent, _this.resizeEnd, _this);\n                    EventHandler.add(_this.parent.element, Browser.touchMoveEvent, _this.resizing, _this);\n                    _this.updateCursor('add');\n                });\n            }\n        }\n    };\n    Resize.prototype.cancelResizeAction = function (removeEvents) {\n        if (removeEvents) {\n            EventHandler.remove(this.parent.element, Browser.touchMoveEvent, this.resizing);\n            EventHandler.remove(document, Browser.touchEndEvent, this.resizeEnd);\n            this.updateCursor('remove');\n        }\n        if (Browser.isDevice) {\n            EventHandler.remove(document, Browser.touchStartEvent, this.removeHelper);\n            EventHandler.remove(this.helper, Browser.touchStartEvent, this.resizeStart);\n        }\n        detach(this.helper);\n        this.refresh();\n    };\n    Resize.prototype.getWidth = function (width, minWidth, maxWidth) {\n        if (minWidth && width < minWidth) {\n            return minWidth;\n        }\n        else if ((maxWidth && width > maxWidth)) {\n            return maxWidth;\n        }\n        else {\n            return width;\n        }\n    };\n    Resize.prototype.updateResizeEleHeight = function () {\n        var elements = [].slice.call(this.parent.getHeaderContent().getElementsByClassName('e-rhandler'));\n        for (var i = 0; i < elements.length; i++) {\n            elements[i].style.height = this.element.parentElement.offsetHeight + 'px';\n        }\n    };\n    Resize.prototype.getColData = function (column, mousemove) {\n        return {\n            width: parseFloat(isNullOrUndefined(this.widthService.getWidth(column)) || this.widthService.getWidth(column) === 'auto' ? '0'\n                : this.widthService.getWidth(column).toString()) + mousemove,\n            minWidth: column.minWidth ? parseFloat(column.minWidth.toString()) : null,\n            maxWidth: column.maxWidth ? parseFloat(column.maxWidth.toString()) : null\n        };\n    };\n    Resize.prototype.resizing = function (e) {\n        if (isNullOrUndefined(this.column)) {\n            return;\n        }\n        var offsetWidth = 0;\n        if (isNullOrUndefined(this.column)) {\n            offsetWidth = parentsUntil(this.element, 'th').offsetWidth;\n        }\n        if (this.parent.allowTextWrap) {\n            this.updateResizeEleHeight();\n            this.setHelperHeight();\n        }\n        var pageX = this.getPointX(e);\n        var mousemove = this.parent.enableRtl ? -(pageX - this.pageX) : (pageX - this.pageX);\n        if (this.column.getFreezeTableName() === literals.frozenRight) {\n            mousemove = this.parent.enableRtl ? (pageX - this.pageX) : (this.pageX - pageX);\n        }\n        var colData = this.getColData(this.column, mousemove);\n        if (!colData.width) {\n            colData.width = closest(this.element, 'th').offsetWidth;\n        }\n        var width = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);\n        this.parent.log('resize_min_max', { column: this.column, width: width });\n        if (this.column.getFreezeTableName() === literals.frozenRight) {\n            if ((this.parent.enableRtl && this.minMove >= pageX) || (!this.parent.enableRtl && this.minMove <= pageX)) {\n                width = this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 10;\n                this.pageX = pageX = this.minMove;\n            }\n        }\n        if ((this.column.getFreezeTableName() !== literals.frozenRight\n            && ((!this.parent.enableRtl && this.minMove >= pageX) || (this.parent.enableRtl && this.minMove <= pageX)))\n            || (this.column.getFreezeTableName() === literals.frozenRight && ((this.parent.enableRtl && this.minMove >= pageX)\n                || (!this.parent.enableRtl && this.minMove <= pageX)))) {\n            width = this.column.minWidth ? parseFloat(this.column.minWidth.toString()) : 10;\n            this.pageX = pageX = this.minMove;\n        }\n        if (width !== parseFloat(isNullOrUndefined(this.column.width) || this.column.width === 'auto' ?\n            offsetWidth.toString() : this.column.width.toString())) {\n            this.pageX = pageX;\n            this.column.width = formatUnit(width);\n            var args = {\n                e: e,\n                column: this.column\n            };\n            this.parent.trigger(events.onResize, args);\n            if (args.cancel) {\n                this.cancelResizeAction(true);\n                return;\n            }\n            var columns = [this.column];\n            var finalColumns = [this.column];\n            if (this.column.columns) {\n                columns = this.getSubColumns(this.column, []);\n                columns = this.calulateColumnsWidth(columns, false, mousemove);\n                finalColumns = this.calulateColumnsWidth(columns, true, mousemove);\n            }\n            for (var _i = 0, finalColumns_1 = finalColumns; _i < finalColumns_1.length; _i++) {\n                var col = finalColumns_1[_i];\n                this.widthService.setColumnWidth(col, null, 'resize');\n            }\n            this.updateHelper();\n        }\n        this.isDblClk = false;\n    };\n    Resize.prototype.calulateColumnsWidth = function (columns, isUpdate, mousemove) {\n        var finalColumns = [];\n        for (var _i = 0, columns_1 = columns; _i < columns_1.length; _i++) {\n            var col = columns_1[_i];\n            var totalWidth = 0;\n            for (var i = 0; i < columns.length; i++) {\n                totalWidth += parseFloat(columns[i].width.toString());\n            }\n            var colData = this.getColData(col, (parseFloat(col.width)) * mousemove / totalWidth);\n            var colWidth = this.getWidth(colData.width, colData.minWidth, colData.maxWidth);\n            if ((colWidth !== parseFloat(col.width.toString()))) {\n                if (isUpdate) {\n                    col.width = formatUnit(colWidth < 1 ? 1 : colWidth);\n                }\n                finalColumns.push(col);\n            }\n        }\n        return finalColumns;\n    };\n    Resize.prototype.getSubColumns = function (column, subColumns) {\n        for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.visible !== false && col.allowResizing) {\n                if (col.columns) {\n                    this.getSubColumns(col, subColumns);\n                }\n                else {\n                    subColumns.push(col);\n                }\n            }\n        }\n        return subColumns;\n    };\n    Resize.prototype.resizeEnd = function (e) {\n        if (!this.helper || this.parent.isDestroyed) {\n            return;\n        }\n        EventHandler.remove(this.parent.element, Browser.touchMoveEvent, this.resizing);\n        EventHandler.remove(document, Browser.touchEndEvent, this.resizeEnd);\n        this.updateCursor('remove');\n        detach(this.helper);\n        var args = { e: e, column: this.column };\n        var content = this.parent.getContent().querySelector('.' + literals.content);\n        var cTable = content.querySelector('.' + literals.movableContent) ? content.querySelector('.' + literals.movableContent) : content;\n        if (cTable.scrollHeight > cTable.clientHeight) {\n            this.parent.scrollModule.setPadding();\n            cTable.style.overflowY = 'scroll';\n        }\n        this.parent.trigger(events.resizeStop, args);\n        closest(this.element, '.e-headercell').classList.add('e-resized');\n        if (parentsUntil(this.element, 'e-frozenheader')) {\n            this.isFrozenColResized = true;\n        }\n        else {\n            this.isFrozenColResized = false;\n        }\n        if (this.parent.isFrozenGrid()) {\n            this.parent.notify(events.freezeRender, { case: 'textwrap' });\n        }\n        if (this.parent.allowTextWrap) {\n            this.updateResizeEleHeight();\n            this.parent.notify(events.textWrapRefresh, { case: 'textwrap' });\n        }\n        this.refresh();\n        this.doubleTapEvent(e);\n        this.isDblClk = true;\n    };\n    Resize.prototype.getPointX = function (e) {\n        if (e.touches && e.touches.length) {\n            return e.touches[0].pageX;\n        }\n        else {\n            return e.pageX;\n        }\n    };\n    Resize.prototype.refreshColumnWidth = function () {\n        var columns = this.parent.getColumns();\n        for (var _i = 0, _a = [].slice.apply(this.parent.getHeaderContent().querySelectorAll('th.e-headercell')); _i < _a.length; _i++) {\n            var ele = _a[_i];\n            for (var _b = 0, columns_2 = columns; _b < columns_2.length; _b++) {\n                var column = columns_2[_b];\n                if (ele.querySelector('[e-mappinguid]') &&\n                    ele.querySelector('[e-mappinguid]').getAttribute('e-mappinguid') === column.uid && column.visible) {\n                    column.width = ele.getBoundingClientRect().width;\n                    break;\n                }\n            }\n        }\n        return columns;\n    };\n    Resize.prototype.refreshStackedColumnWidth = function () {\n        for (var _i = 0, _a = this.parent.getStackedColumns(this.parent.columns); _i < _a.length; _i++) {\n            var stackedColumn = _a[_i];\n            stackedColumn.width = this.getStackedWidth(stackedColumn, 0);\n        }\n    };\n    Resize.prototype.getStackedWidth = function (column, width) {\n        for (var _i = 0, _a = column.columns; _i < _a.length; _i++) {\n            var col = _a[_i];\n            if (col.visible !== false) {\n                if (col.columns) {\n                    this.getStackedWidth(col, width);\n                }\n                else {\n                    width += col.width;\n                }\n            }\n        }\n        return width;\n    };\n    Resize.prototype.getTargetColumn = function (e) {\n        var cell = closest(e.target, resizeClassList.header);\n        cell = cell.querySelector('.e-headercelldiv') || cell.querySelector('.e-stackedheadercelldiv');\n        var uid = cell.getAttribute('e-mappinguid');\n        return this.parent.getColumnByUid(uid);\n    };\n    Resize.prototype.updateCursor = function (action) {\n        var headerRows = [].slice.call(this.parent.getHeaderContent().querySelectorAll('th'));\n        headerRows.push(this.parent.element);\n        for (var _i = 0, headerRows_1 = headerRows; _i < headerRows_1.length; _i++) {\n            var row = headerRows_1[_i];\n            row.classList[action](resizeClassList.cursor);\n        }\n    };\n    Resize.prototype.refresh = function () {\n        this.column = null;\n        this.pageX = null;\n        this.element = null;\n        this.helper = null;\n    };\n    Resize.prototype.appendHelper = function () {\n        this.helper = this.parent.createElement('div', {\n            className: resizeClassList.helper\n        });\n        this.parent.element.appendChild(this.helper);\n        this.setHelperHeight();\n    };\n    Resize.prototype.setHelperHeight = function () {\n        var isFrozen = this.parent.isFrozenGrid();\n        var height = isFrozen ? this.parent.getContent().querySelector('.' + literals.content).offsetHeight\n            : this.parent.getContent().offsetHeight - this.getScrollBarWidth();\n        var rect = closest(this.element, resizeClassList.header);\n        var tr = [].slice.call(this.parent.getHeaderContent().querySelectorAll('tr'));\n        var right = this.parent.getFrozenRightColumnsCount();\n        if (isFrozen) {\n            if (parentsUntil(rect, literals.movableHeader)) {\n                tr = [].slice.call(this.parent.getHeaderContent().querySelector('.' + literals.movableHeader).querySelectorAll('tr'));\n            }\n            else if (right && parentsUntil(rect, 'e-frozen-right-header')) {\n                tr = [].slice.call(this.parent.getHeaderContent().querySelector('.e-frozen-right-header').querySelectorAll('tr'));\n            }\n            else {\n                tr = [].slice.call(this.parent.getHeaderContent().querySelector('.e-frozen-left-header').querySelectorAll('tr'));\n            }\n        }\n        for (var i = tr.indexOf(rect.parentElement); i < tr.length && i > -1; i++) {\n            height += tr[i].offsetHeight;\n        }\n        var pos = this.calcPos(rect);\n        if (parentsUntil(rect, 'e-frozen-right-header')) {\n            pos.left += (this.parent.enableRtl ? rect.offsetWidth - 2 : 0 - 1);\n        }\n        else {\n            pos.left += (this.parent.enableRtl ? 0 - 1 : rect.offsetWidth - 2);\n        }\n        this.helper.style.cssText = 'height: ' + height + 'px; top: ' + pos.top + 'px; left:' + Math.floor(pos.left) + 'px;';\n        if (this.parent.enableVirtualization) {\n            this.helper.classList.add('e-virtual-rhandler');\n        }\n    };\n    Resize.prototype.getScrollBarWidth = function (height) {\n        var ele = this.parent.getContent().firstChild;\n        return (ele.scrollHeight > ele.clientHeight && height) ||\n            ele.scrollWidth > ele.clientWidth ? getScrollBarWidth() : 0;\n    };\n    Resize.prototype.removeHelper = function (e) {\n        var cls = e.target.classList;\n        if (!(cls.contains(resizeClassList.root) || cls.contains(resizeClassList.icon)) && this.helper) {\n            EventHandler.remove(document, Browser.touchStartEvent, this.removeHelper);\n            EventHandler.remove(this.helper, Browser.touchStartEvent, this.resizeStart);\n            detach(this.helper);\n            this.refresh();\n        }\n    };\n    Resize.prototype.updateHelper = function () {\n        var rect = closest(this.element, resizeClassList.header);\n        var left;\n        if (parentsUntil(rect, 'e-frozen-right-header')) {\n            left = Math.floor(this.calcPos(rect).left + (this.parent.enableRtl ? rect.offsetWidth - 2 : 0 - 1));\n        }\n        else {\n            left = Math.floor(this.calcPos(rect).left + (this.parent.enableRtl ? 0 - 1 : rect.offsetWidth - 2));\n        }\n        var borderWidth = 2; // to maintain the helper inside of grid element.\n        if (left > this.parentElementWidth) {\n            left = this.parentElementWidth - borderWidth;\n        }\n        if (this.parent.isFrozenGrid()) {\n            var table = closest(rect, '.' + literals.table);\n            var fLeft = table.offsetLeft;\n            if (left < fLeft) {\n                left = fLeft;\n            }\n        }\n        this.helper.style.left = left + 'px';\n    };\n    Resize.prototype.calcPos = function (elem) {\n        var parentOffset = {\n            top: 0,\n            left: 0\n        };\n        var offset = elem.getBoundingClientRect();\n        var doc = elem.ownerDocument;\n        var offsetParent = parentsUntil(elem, 'e-grid') || doc.documentElement;\n        while (offsetParent &&\n            (offsetParent === doc.body || offsetParent === doc.documentElement) &&\n            offsetParent.style.position === 'static') {\n            offsetParent = offsetParent.parentNode;\n        }\n        if (offsetParent && offsetParent !== elem && offsetParent.nodeType === 1) {\n            parentOffset = offsetParent.getBoundingClientRect();\n        }\n        return {\n            top: offset.top - parentOffset.top,\n            left: offset.left - parentOffset.left\n        };\n    };\n    Resize.prototype.doubleTapEvent = function (e) {\n        var _this = this;\n        if (this.getUserAgent() && this.isDblClk) {\n            if (!this.tapped) {\n                this.tapped = setTimeout(function () {\n                    _this.tapped = null;\n                }, 300);\n            }\n            else {\n                clearTimeout(this.tapped);\n                this.callAutoFit(e);\n                this.tapped = null;\n            }\n        }\n    };\n    Resize.prototype.getUserAgent = function () {\n        var userAgent = Browser.userAgent.toLowerCase();\n        return /iphone|ipod|ipad/.test(userAgent);\n    };\n    Resize.prototype.timeoutHandler = function () {\n        this.tapped = null;\n    };\n    return Resize;\n}());\nexport { Resize };\n"]},"metadata":{},"sourceType":"module"}