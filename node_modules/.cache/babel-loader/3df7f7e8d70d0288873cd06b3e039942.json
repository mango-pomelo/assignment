{"ast":null,"code":"var __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n\n    return extendStatics(d, b);\n  };\n\n  return function (d, b) {\n    extendStatics(d, b);\n\n    function __() {\n      this.constructor = d;\n    }\n\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\n\nimport { Grid, VirtualScroll as GridVirtualScroll } from '@syncfusion/ej2-grids';\nimport { RenderType } from '@syncfusion/ej2-grids';\nimport { getValue, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { DataManager, Predicate, Query } from '@syncfusion/ej2-data';\nimport { getExpandStatus } from '../utils';\nimport { VirtualTreeContentRenderer } from '../renderer/virtual-tree-content-render';\n/**\n * TreeGrid Virtual Scroll module will handle Virtualization\n *\n * @hidden\n */\n\nvar VirtualScroll =\n/** @class */\nfunction () {\n  /**\n   * Constructor for VirtualScroll module\n   *\n   * @param {TreeGrid} parent - Tree Grid instance\n   */\n  function VirtualScroll(parent) {\n    this.prevstartIndex = -1;\n    this.prevendIndex = -1;\n    this.parent = parent;\n    Grid.Inject(TreeVirtual);\n    this.addEventListener();\n  }\n\n  VirtualScroll.prototype.returnVisualData = function (args) {\n    args.data = this.visualData;\n  };\n  /**\n   * For internal use only - Get the module name.\n   *\n   * @private\n   * @returns {string} - Returns VirtualScroll module name\n   */\n\n\n  VirtualScroll.prototype.getModuleName = function () {\n    return 'virtualScroll';\n  };\n  /**\n   * @hidden\n   * @returns {void}\n   */\n\n\n  VirtualScroll.prototype.addEventListener = function () {\n    this.parent.on(events.localPagedExpandCollapse, this.collapseExpandVirtualchilds, this);\n    this.parent.on(events.pagingActions, this.virtualPageAction, this);\n  };\n  /**\n   * @hidden\n   * @returns {void}\n   */\n\n\n  VirtualScroll.prototype.removeEventListener = function () {\n    if (this.parent.isDestroyed) {\n      return;\n    }\n\n    this.parent.off(events.localPagedExpandCollapse, this.collapseExpandVirtualchilds);\n    this.parent.off(events.pagingActions, this.virtualPageAction);\n  };\n\n  VirtualScroll.prototype.collapseExpandVirtualchilds = function (row) {\n    this.parent.grid.notify(events.virtualActionArgs, {\n      isExpandCollapse: true\n    });\n    this.expandCollapseRec = row.record;\n    row.record.expanded = row.action === 'collapse' ? false : true;\n    var ret = {\n      result: this.parent.flatData,\n      row: row.row,\n      action: row.action,\n      record: row.record,\n      count: this.parent.flatData.length\n    };\n    this.parent.grid.clearSelection();\n    var requestType = getValue('isCollapseAll', this.parent) ? 'collapseAll' : 'refresh';\n    getValue('grid.renderModule', this.parent).dataManagerSuccess(ret, {\n      requestType: requestType\n    });\n  };\n\n  VirtualScroll.prototype.virtualPageAction = function (pageingDetails) {\n    var _this = this;\n\n    var dm = new DataManager(pageingDetails.result);\n    var expanded = new Predicate('expanded', 'notequal', null).or('expanded', 'notequal', undefined);\n    var parents = dm.executeLocal(new Query().where(expanded));\n    var visualData = parents.filter(function (e) {\n      return getExpandStatus(_this.parent, e, parents);\n    });\n    this.visualData = visualData;\n    this.parent.grid.notify(events.dataListener, {\n      data: visualData\n    });\n    var counts = {\n      startIndex: -1,\n      endIndex: -1,\n      count: pageingDetails.count\n    };\n    this.parent.grid.notify(events.indexModifier, counts);\n    var startIndex = counts.startIndex;\n    var endIndex = counts.endIndex;\n    pageingDetails.count = visualData.length;\n\n    if (startIndex === -1 && endIndex === -1) {\n      var query = new Query();\n      var size = this.parent.grid.pageSettings.pageSize;\n      var current = this.parent.grid.pageSettings.currentPage;\n      var skip = size * (current - 1);\n      query = query.skip(skip).take(size);\n      dm.dataSource.json = visualData;\n      pageingDetails.result = dm.executeLocal(query);\n    } else {\n      var requestType = pageingDetails.actionArgs.requestType;\n\n      if (requestType === 'filtering' || requestType === 'collapseAll' || requestType === 'refresh' && this.parent.enableCollapseAll && endIndex > visualData.length) {\n        startIndex = 0;\n        endIndex = this.parent.grid.pageSettings.pageSize - 1;\n        this.parent.grid.getContent().firstElementChild.scrollTop = 0;\n        this.parent.grid.notify(events.virtualActionArgs, {\n          setTop: true\n        });\n      } //if ((this.prevendIndex !== -1 && this.prevstartIndex !== -1) &&\n      //this.prevendIndex === endIndex && this.prevstartIndex === startIndex) {\n\n\n      if (!isNullOrUndefined(this.expandCollapseRec)) {\n        var resourceCount = this.parent.getRows();\n        var sIndex = visualData.indexOf(this.expandCollapseRec);\n        var tempdata = visualData.slice(sIndex, sIndex + resourceCount.length);\n\n        if (tempdata.length < resourceCount.length && sIndex >= 0) {\n          sIndex = visualData.length - resourceCount.length;\n          sIndex = sIndex > 0 ? sIndex : 0;\n          startIndex = sIndex;\n          endIndex = visualData.length;\n        } else if (getValue('isCollapseAll', this.parent)) {\n          startIndex = 0;\n          endIndex = this.parent.grid.pageSettings.pageSize - 1;\n          this.parent.grid.notify(events.virtualActionArgs, {\n            setTop: true\n          });\n        }\n\n        this.expandCollapseRec = null;\n      } //}\n\n\n      pageingDetails.result = visualData.slice(startIndex, endIndex);\n      this.prevstartIndex = startIndex;\n      this.prevendIndex = endIndex;\n    }\n\n    this.parent.notify('updateAction', pageingDetails);\n  };\n  /**\n   * To destroy the virtualScroll module\n   *\n   * @returns {void}\n   * @hidden\n   */\n\n\n  VirtualScroll.prototype.destroy = function () {\n    this.removeEventListener();\n  };\n\n  return VirtualScroll;\n}();\n\nexport { VirtualScroll };\n\nvar TreeVirtual =\n/** @class */\nfunction (_super) {\n  __extends(TreeVirtual, _super);\n\n  function TreeVirtual(parent, locator) {\n    var _this = _super.call(this, parent, locator) || this;\n\n    getValue('parent', _this).off('initial-load', getValue('instantiateRenderer', _this), _this);\n    getValue('parent', _this).on('initial-load', _this.instantiateRenderers, _this);\n    return _this;\n  }\n\n  TreeVirtual.prototype.getModuleName = function () {\n    return 'treeVirtualScroll';\n  };\n\n  TreeVirtual.prototype.instantiateRenderers = function () {\n    getValue('parent', this).log(['limitation', 'virtual_height'], 'virtualization');\n    var renderer = getValue('locator', this).getService('rendererFactory');\n    getValue('addRenderer', renderer).apply(renderer, [RenderType.Content, new VirtualTreeContentRenderer(getValue('parent', this), getValue('locator', this))]); //renderer.addRenderer(RenderType.Content, new VirtualTreeContentRenderer(getValue('parent', this), getValue('locator', this)));\n\n    this.ensurePageSize();\n  };\n\n  TreeVirtual.prototype.ensurePageSize = function () {\n    var parentGrid = getValue('parent', this);\n    var rowHeight = parentGrid.getRowHeight();\n\n    if (!isNullOrUndefined(parentGrid.height) && typeof parentGrid.height === 'string' && parentGrid.height.indexOf('%') !== -1) {\n      parentGrid.element.style.height = parentGrid.height;\n    }\n\n    var vHeight = parentGrid.height.toString().indexOf('%') < 0 ? parentGrid.height : parentGrid.element.getBoundingClientRect().height;\n    var blockSize = ~~(vHeight / rowHeight);\n    var height = blockSize * 2;\n    var size = parentGrid.pageSettings.pageSize;\n    parentGrid.setProperties({\n      pageSettings: {\n        pageSize: size < height ? height : size\n      }\n    }, true);\n  };\n\n  return TreeVirtual;\n}(GridVirtualScroll);\n\nexport { TreeVirtual };","map":{"version":3,"sources":["/Users/zhouzhou/Desktop/lightfront/node_modules/@syncfusion/ej2-treegrid/src/treegrid/actions/virtual-scroll.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","constructor","prototype","create","Grid","VirtualScroll","GridVirtualScroll","RenderType","getValue","isNullOrUndefined","events","DataManager","Predicate","Query","getExpandStatus","VirtualTreeContentRenderer","parent","prevstartIndex","prevendIndex","Inject","TreeVirtual","addEventListener","returnVisualData","args","data","visualData","getModuleName","on","localPagedExpandCollapse","collapseExpandVirtualchilds","pagingActions","virtualPageAction","removeEventListener","isDestroyed","off","row","grid","notify","virtualActionArgs","isExpandCollapse","expandCollapseRec","record","expanded","action","ret","result","flatData","count","length","clearSelection","requestType","dataManagerSuccess","pageingDetails","_this","dm","or","undefined","parents","executeLocal","where","filter","e","dataListener","counts","startIndex","endIndex","indexModifier","query","size","pageSettings","pageSize","current","currentPage","skip","take","dataSource","json","actionArgs","enableCollapseAll","getContent","firstElementChild","scrollTop","setTop","resourceCount","getRows","sIndex","indexOf","tempdata","slice","destroy","_super","locator","call","instantiateRenderers","log","renderer","getService","apply","Content","ensurePageSize","parentGrid","rowHeight","getRowHeight","height","element","style","vHeight","toString","getBoundingClientRect","blockSize","setProperties"],"mappings":"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","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nimport { Grid, VirtualScroll as GridVirtualScroll } from '@syncfusion/ej2-grids';\nimport { RenderType } from '@syncfusion/ej2-grids';\nimport { getValue, isNullOrUndefined } from '@syncfusion/ej2-base';\nimport * as events from '../base/constant';\nimport { DataManager, Predicate, Query } from '@syncfusion/ej2-data';\nimport { getExpandStatus } from '../utils';\nimport { VirtualTreeContentRenderer } from '../renderer/virtual-tree-content-render';\n/**\n * TreeGrid Virtual Scroll module will handle Virtualization\n *\n * @hidden\n */\nvar VirtualScroll = /** @class */ (function () {\n    /**\n     * Constructor for VirtualScroll module\n     *\n     * @param {TreeGrid} parent - Tree Grid instance\n     */\n    function VirtualScroll(parent) {\n        this.prevstartIndex = -1;\n        this.prevendIndex = -1;\n        this.parent = parent;\n        Grid.Inject(TreeVirtual);\n        this.addEventListener();\n    }\n    VirtualScroll.prototype.returnVisualData = function (args) {\n        args.data = this.visualData;\n    };\n    /**\n     * For internal use only - Get the module name.\n     *\n     * @private\n     * @returns {string} - Returns VirtualScroll module name\n     */\n    VirtualScroll.prototype.getModuleName = function () {\n        return 'virtualScroll';\n    };\n    /**\n     * @hidden\n     * @returns {void}\n     */\n    VirtualScroll.prototype.addEventListener = function () {\n        this.parent.on(events.localPagedExpandCollapse, this.collapseExpandVirtualchilds, this);\n        this.parent.on(events.pagingActions, this.virtualPageAction, this);\n    };\n    /**\n     * @hidden\n     * @returns {void}\n     */\n    VirtualScroll.prototype.removeEventListener = function () {\n        if (this.parent.isDestroyed) {\n            return;\n        }\n        this.parent.off(events.localPagedExpandCollapse, this.collapseExpandVirtualchilds);\n        this.parent.off(events.pagingActions, this.virtualPageAction);\n    };\n    VirtualScroll.prototype.collapseExpandVirtualchilds = function (row) {\n        this.parent.grid.notify(events.virtualActionArgs, { isExpandCollapse: true });\n        this.expandCollapseRec = row.record;\n        row.record.expanded = row.action === 'collapse' ? false : true;\n        var ret = {\n            result: this.parent.flatData,\n            row: row.row,\n            action: row.action,\n            record: row.record,\n            count: this.parent.flatData.length\n        };\n        this.parent.grid.clearSelection();\n        var requestType = getValue('isCollapseAll', this.parent) ? 'collapseAll' : 'refresh';\n        getValue('grid.renderModule', this.parent).dataManagerSuccess(ret, { requestType: requestType });\n    };\n    VirtualScroll.prototype.virtualPageAction = function (pageingDetails) {\n        var _this = this;\n        var dm = new DataManager(pageingDetails.result);\n        var expanded = new Predicate('expanded', 'notequal', null).or('expanded', 'notequal', undefined);\n        var parents = dm.executeLocal(new Query().where(expanded));\n        var visualData = parents.filter(function (e) {\n            return getExpandStatus(_this.parent, e, parents);\n        });\n        this.visualData = visualData;\n        this.parent.grid.notify(events.dataListener, { data: visualData });\n        var counts = { startIndex: -1, endIndex: -1, count: pageingDetails.count };\n        this.parent.grid.notify(events.indexModifier, counts);\n        var startIndex = counts.startIndex;\n        var endIndex = counts.endIndex;\n        pageingDetails.count = visualData.length;\n        if (startIndex === -1 && endIndex === -1) {\n            var query = new Query();\n            var size = this.parent.grid.pageSettings.pageSize;\n            var current = this.parent.grid.pageSettings.currentPage;\n            var skip = size * (current - 1);\n            query = query.skip(skip).take(size);\n            dm.dataSource.json = visualData;\n            pageingDetails.result = dm.executeLocal(query);\n        }\n        else {\n            var requestType = pageingDetails.actionArgs.requestType;\n            if (requestType === 'filtering' || requestType === 'collapseAll' ||\n                (requestType === 'refresh' && this.parent.enableCollapseAll && endIndex > visualData.length)) {\n                startIndex = 0;\n                endIndex = this.parent.grid.pageSettings.pageSize - 1;\n                this.parent.grid.getContent().firstElementChild.scrollTop = 0;\n                this.parent.grid.notify(events.virtualActionArgs, { setTop: true });\n            }\n            //if ((this.prevendIndex !== -1 && this.prevstartIndex !== -1) &&\n            //this.prevendIndex === endIndex && this.prevstartIndex === startIndex) {\n            if (!isNullOrUndefined(this.expandCollapseRec)) {\n                var resourceCount = this.parent.getRows();\n                var sIndex = visualData.indexOf(this.expandCollapseRec);\n                var tempdata = visualData.slice(sIndex, sIndex + resourceCount.length);\n                if (tempdata.length < resourceCount.length && sIndex >= 0) {\n                    sIndex = visualData.length - resourceCount.length;\n                    sIndex = sIndex > 0 ? sIndex : 0;\n                    startIndex = sIndex;\n                    endIndex = visualData.length;\n                }\n                else if (getValue('isCollapseAll', this.parent)) {\n                    startIndex = 0;\n                    endIndex = this.parent.grid.pageSettings.pageSize - 1;\n                    this.parent.grid.notify(events.virtualActionArgs, { setTop: true });\n                }\n                this.expandCollapseRec = null;\n            }\n            //}\n            pageingDetails.result = visualData.slice(startIndex, endIndex);\n            this.prevstartIndex = startIndex;\n            this.prevendIndex = endIndex;\n        }\n        this.parent.notify('updateAction', pageingDetails);\n    };\n    /**\n     * To destroy the virtualScroll module\n     *\n     * @returns {void}\n     * @hidden\n     */\n    VirtualScroll.prototype.destroy = function () {\n        this.removeEventListener();\n    };\n    return VirtualScroll;\n}());\nexport { VirtualScroll };\nvar TreeVirtual = /** @class */ (function (_super) {\n    __extends(TreeVirtual, _super);\n    function TreeVirtual(parent, locator) {\n        var _this = _super.call(this, parent, locator) || this;\n        getValue('parent', _this).off('initial-load', getValue('instantiateRenderer', _this), _this);\n        getValue('parent', _this).on('initial-load', _this.instantiateRenderers, _this);\n        return _this;\n    }\n    TreeVirtual.prototype.getModuleName = function () {\n        return 'treeVirtualScroll';\n    };\n    TreeVirtual.prototype.instantiateRenderers = function () {\n        getValue('parent', this).log(['limitation', 'virtual_height'], 'virtualization');\n        var renderer = getValue('locator', this).getService('rendererFactory');\n        getValue('addRenderer', renderer)\n            .apply(renderer, [RenderType.Content, new VirtualTreeContentRenderer(getValue('parent', this), getValue('locator', this))]);\n        //renderer.addRenderer(RenderType.Content, new VirtualTreeContentRenderer(getValue('parent', this), getValue('locator', this)));\n        this.ensurePageSize();\n    };\n    TreeVirtual.prototype.ensurePageSize = function () {\n        var parentGrid = getValue('parent', this);\n        var rowHeight = parentGrid.getRowHeight();\n        if (!isNullOrUndefined(parentGrid.height) && typeof (parentGrid.height) === 'string' && parentGrid.height.indexOf('%') !== -1) {\n            parentGrid.element.style.height = parentGrid.height;\n        }\n        var vHeight = parentGrid.height.toString().indexOf('%') < 0 ? parentGrid.height :\n            parentGrid.element.getBoundingClientRect().height;\n        var blockSize = ~~(vHeight / rowHeight);\n        var height = blockSize * 2;\n        var size = parentGrid.pageSettings.pageSize;\n        parentGrid.setProperties({ pageSettings: { pageSize: size < height ? height : size } }, true);\n    };\n    return TreeVirtual;\n}(GridVirtualScroll));\nexport { TreeVirtual };\n"]},"metadata":{},"sourceType":"module"}